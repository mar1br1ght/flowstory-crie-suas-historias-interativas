<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowStory</title>
    <style>
        :root {
            --lilac: #e6e6fa;
            --orange-pastel: #ffd8b1;
            --yellow-pastel: #fffacd;
            --pink-pastel: #ffd1dc;
            --mint: #b5e7a0;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
            --purple: #8a2be2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            height: 100vh;
            overflow: hidden;
        }

        /* Menu Principal */
        .main-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--purple);
            cursor: pointer;
        }

        .menu-buttons {
            display: flex;
            gap: 15px;
        }

        .menu-btn {
            padding: 8px 15px;
            border: none;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .menu-btn:hover {
            background-color: #e0e0e0;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        /* √Årea de Trabalho */
        .workspace {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Painel de Abas */
        .tab-panel {
            width: 200px;
            background-color: white;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .tab-category {
            margin-bottom: 20px;
        }

        .tab-category h3 {
            font-size: 14px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .tab-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
        }

        .tab-item:hover {
            background-color: #f5f5f5;
        }

        .esqueleto { background-color: var(--lilac); }
        .aparencia { background-color: var(--orange-pastel); }
        .bolhas-filhas { background-color: var(--orange-pastel); }
        .cenas-esqueleto { background-color: var(--yellow-pastel); }
        .cenas { background-color: var(--pink-pastel); }
        .menu-bolhas { background-color: var(--mint); }

        /* Mesa de Trabalho */
        .work-table {
            flex: 1;
            background-color: #f9f9f9;
            position: relative;
            overflow: auto;
            padding: 20px;
        }

        .bubble {
            position: absolute;
            min-width: 150px;
            min-height: 80px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 10px;
            cursor: move;
            user-select: none;
            z-index: 10;
        }

        .bubble-header {
            font-weight: bold;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .bubble-actions {
            display: flex;
            gap: 5px;
        }

        .bubble-action {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }

        .bubble-content {
            font-size: 12px;
        }

        .bubble-image {
            max-width: 100%;
            max-height: 150px;
            display: block;
            margin: 5px auto;
            border-radius: 5px;
        }

        .connection-point {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--purple);
            position: absolute;
            cursor: crosshair;
        }

        .connection-point.top {
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connection-point.bottom {
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .connection-point.left {
            left: -5px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connection-point.right {
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
        }

        .connection-line {
            position: absolute;
            background-color: var(--purple);
            height: 2px;
            transform-origin: 0 0;
            z-index: 5;
            pointer-events: none;
        }

        /* Editor de Texto */
        .text-editor {
            width: 400px;
            background-color: white;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .editor-header {
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .editor-area {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            resize: none;
            outline: none;
        }

        .editor-actions {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .save-btn {
            background-color: #4CAF50;
            color: white;
        }

        .clear-btn {
            background-color: #f44336;
            color: white;
        }

        .upload-btn {
            background-color: #2196F3;
            color: white;
        }

        /* Modal de Login */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
        }

        .modal-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Sistema de Upload */
        .upload-system {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .upload-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .upload-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .upload-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .upload-area:hover {
            border-color: var(--purple);
        }

        .upload-area.dragover {
            border-color: var(--purple);
            background-color: #f0f0ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 10px;
        }

        .file-input {
            display: none;
        }

        .uploaded-files {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .file-preview {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            margin-right: 15px;
            object-fit: cover;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .file-size {
            color: #666;
            font-size: 12px;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .rename-input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
        }

        /* Sistema de Perfis */
        .profile-system {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .profile-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .profile-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .profile-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        /* FlowSocial */
        .flowsocial {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .flowsocial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .flowsocial-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
        }

        .flowsocial-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .flowsocial-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .social-post {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 10px;
        }

        .post-author {
            font-weight: bold;
        }

        .post-content {
            margin-bottom: 10px;
        }

        .post-actions {
            display: flex;
            gap: 15px;
        }

        .post-action {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
        }

        /* Preview */
        .preview {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .preview-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .preview-scene {
            width: 80%;
            height: 400px;
            background-color: #f0f0f0;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .preview-character {
            width: 100px;
            height: 200px;
            background-color: #ddd;
            border-radius: 10px;
        }

        .preview-dialog {
            width: 80%;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Configura√ß√µes */
        .settings {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .settings-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .settings-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .settings-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group h3 {
            margin-bottom: 10px;
        }

        .setting-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }

        /* Pesquisa de Bolhas */
        .search-bubbles {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .search-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
        }

        .search-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .search-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .search-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .search-result {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        /* Nova Hist√≥ria */
        .new-story {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .new-story-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .new-story-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .story-option {
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
        }

        .story-option:hover {
            background-color: #e9e9e9;
        }

        /* Convite */
        .invite {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .invite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .invite-content {
            max-width: 500px;
            margin: 0 auto;
        }

        /* Aviso de Atalho */
        .shortcut-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--purple);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .shortcut-hint.show {
            opacity: 1;
        }

        /* Sistema de Novas Bolhas */
        .new-bubbles-system {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 900;
            padding: 20px;
            overflow-y: auto;
        }

        .new-bubbles-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .new-bubbles-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            height: calc(100vh - 100px);
        }

        .new-bubbles-sidebar {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .new-bubbles-main {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }

        .bubble-types {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bubble-type {
            padding: 12px;
            background-color: white;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .bubble-type:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .bubble-type.active {
            border-color: var(--purple);
            background-color: #f0f0ff;
        }

        .bubble-type.esqueleto { background-color: var(--lilac); }
        .bubble-type.aparencia { background-color: var(--orange-pastel); }
        .bubble-type.acao { background-color: var(--yellow-pastel); }
        .bubble-type.variavel { background-color: var(--pink-pastel); }
        .bubble-type.logica { background-color: var(--mint); }

        .bubble-creator {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .creator-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group.full {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .parameters-list {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .parameter-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }

        .parameter-item input {
            flex: 1;
        }

        .remove-param {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            font-size: 18px;
        }

        .add-param {
            background-color: var(--purple);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .code-preview {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }

        .created-bubbles {
            margin-top: 20px;
        }

        .created-bubbles-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .created-bubble {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bubble-info h4 {
            margin-bottom: 5px;
        }

        .bubble-info .bubble-type-label {
            font-size: 12px;
            color: #666;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .bubble-actions {
            display: flex;
            gap: 5px;
        }

        .test-bubble {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .use-bubble {
            background-color: var(--purple);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-bubble {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Bubble Runner - Para testar bolhas criadas */
        .bubble-runner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 950;
            padding: 20px;
        }

        .runner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .runner-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .runner-console {
            width: 80%;
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .runner-output {
            white-space: pre-wrap;
        }

        .runner-input-area {
            width: 80%;
            display: flex;
            gap: 10px;
        }

        .runner-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .runner-run {
            background-color: var(--purple);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .runner-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Aviso de Atalho -->
    <div class="shortcut-hint" id="shortcut-hint">Enter: SaveRote</div>

    <!-- Menu Principal -->
    <div class="main-menu">
        <div class="logo" id="logo">FlowStory</div>
        <div class="menu-buttons">
            <button class="menu-btn" id="new-story-btn">Nova Hist√≥ria Interativa</button>
            <button class="menu-btn" id="new-bubble-btn">Criar Bolhas</button>
            <button class="menu-btn" id="new-webseries">Nova Webs√©rie</button>
            <button class="menu-btn" id="settings-btn">Configura√ß√£o</button>
            <button class="menu-btn" id="login-btn">Login</button>
            <button class="menu-btn" id="invite-btn">Convite-se</button>
            <button class="menu-btn" id="search-bubbles-btn">Pesquisar Bolhas</button>
            <button class="menu-btn" id="preview-btn">Preview</button>
            <button class="menu-btn upload-btn" id="upload-btn">Upload</button>
        </div>
        <div class="user-actions">
            <button class="menu-btn" id="save-point">SavePoint</button>
            <button class="menu-btn" id="save-rote">SaveRote</button>
            <button class="menu-btn" id="save-scene">SaveScene</button>
        </div>
    </div>

    <!-- √Årea de Trabalho -->
    <div class="workspace">
        <!-- Painel de Abas -->
        <div class="tab-panel">
            <div class="tab-category">
                <h3>Esqueleto da Hist√≥ria</h3>
                <div class="tab-item esqueleto" data-type="se">Se</div>
                <div class="tab-item esqueleto" data-type="contexto">Contexto</div>
                <div class="tab-item esqueleto" data-type="entao">Ent√£o</div>
                <div class="tab-item esqueleto" data-type="senao">Sen√£o</div>
            </div>
            
            <div class="tab-category">
                <h3>Apar√™ncia</h3>
                <div class="tab-item aparencia" data-type="mover-personagem">Mover Personagem</div>
                <div class="tab-item aparencia" data-type="mudar-foco">Mudar Foco</div>
                <div class="tab-item aparencia" data-type="cenario">Cen√°rio</div>
                <div class="tab-item aparencia" data-type="esconder-personagem">Esconder Personagem</div>
                <div class="tab-item aparencia" data-type="sair-tela">Sair da Tela</div>
                <div class="tab-item aparencia" data-type="desaparecer">Desaparecer</div>
            </div>
            
            <div class="tab-category">
                <h3>Bolhas Filhas</h3>
                <div class="tab-item bolhas-filhas" data-type="personagem">Personagem()</div>
                <div class="tab-item bolhas-filhas" data-type="cenario">Cen√°rio()</div>
                <div class="tab-item bolhas-filhas" data-type="mudar-expressao">Mudar Express√£o</div>
                <div class="tab-item bolhas-filhas" data-type="trazer-personagem">Trazer Personagem</div>
                <div class="tab-item bolhas-filhas" data-type="esquerda">Esquerda</div>
                <div class="tab-item bolhas-filhas" data-type="direita">Direita</div>
                <div class="tab-item bolhas-filhas" data-type="centro">Centro</div>
                <div class="tab-item bolhas-filhas" data-type="canto-sup-dir">Canto Sup. Dir</div>
                <div class="tab-item bolhas-filhas" data-type="canto-sup-esq">Canto Sup. Esq</div>
                <div class="tab-item bolhas-filhas" data-type="canto-inf-dir">Canto Inf. Dir</div>
                <div class="tab-item bolhas-filhas" data-type="canto-inf-esq">Canto Inf. Esq</div>
            </div>
            
            <div class="tab-category">
                <h3>Cenas Esqueleto</h3>
                <div class="tab-item cenas-esqueleto" data-type="novo-capitulo">Novo Cap√≠tulo</div>
                <div class="tab-item cenas-esqueleto" data-type="criar-rota">Criar Rota</div>
                <div class="tab-item cenas-esqueleto" data-type="dialogo">Di√°logo</div>
            </div>
            
            <div class="tab-category">
                <h3>Cenas</h3>
                <div class="tab-item cenas" data-type="tempo-slide">Tempo de Slide</div>
                <div class="tab-item cenas" data-type="transicao-subita">Transi√ß√£o S√∫bita</div>
                <div class="tab-item cenas" data-type="mudar-expressao">Mudar Express√£o</div>
                <div class="tab-item cenas" data-type="cena">Cena</div>
            </div>
            
            <div class="tab-category">
                <h3>Fim</h3>
                <div class="tab-item" data-type="parar-tudo">Parar Tudo</div>
            </div>
            
            <div class="tab-category">
                <h3>Menu Bolhas</h3>
                <div class="tab-item menu-bolhas" data-type="onde-parei">Onde Parei</div>
                <div class="tab-item menu-bolhas" data-type="savepoint">SavePoint</div>
                <div class="tab-item menu-bolhas" data-type="newpoint">NewPoint</div>
                <div class="tab-item menu-bolhas" data-type="settar">Settar</div>
            </div>
        </div>

        <!-- Mesa de Trabalho -->
        <div class="work-table" id="work-table">
            <!-- Bolhas ser√£o adicionadas aqui dinamicamente -->
        </div>

        <!-- Editor de Texto -->
        <div class="text-editor">
            <div class="editor-header">Editor de Texto de Bolhas</div>
            <textarea class="editor-area" id="editor-area" placeholder="Escreva o c√≥digo da bolha aqui..."></textarea>
            <div class="editor-actions">
                <button class="action-btn clear-btn" id="clear-editor">Limpar</button>
                <button class="action-btn save-btn" id="save-editor">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Sistema de Upload -->
    <div class="upload-system" id="upload-system">
        <div class="upload-header">
            <h2>Sistema de Upload</h2>
            <button class="close-btn" id="close-upload">√ó</button>
        </div>
        <div class="upload-content">
            <div class="upload-sidebar">
                <h3>Op√ß√µes</h3>
                <div class="tab-item" id="upload-images">Imagens</div>
                <div class="tab-item" id="upload-audio">√Åudio</div>
                <div class="tab-item" id="upload-templates">Templates</div>
            </div>
            <div class="upload-main">
                <h3>Upload de Imagens</h3>
                <p>Formatos aceitos: PNG, JPG, JPEG</p>
                
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">üìÅ</div>
                    <p>Arraste e solte arquivos aqui ou clique para selecionar</p>
                    <input type="file" id="file-input" class="file-input" multiple accept=".png,.jpg,.jpeg">
                </div>
                
                <div class="uploaded-files" id="uploaded-files">
                    <h4>Arquivos Carregados</h4>
                    <!-- Arquivos ser√£o listados aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Login -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">Login</div>
            <div class="form-group">
                <label for="username">Nick ou Email:</label>
                <input type="text" id="username">
            </div>
            <div class="form-group">
                <label for="password">Senha ou C√≥digo:</label>
                <input type="password" id="password">
            </div>
            <div class="modal-actions">
                <button class="action-btn" id="cancel-login">Cancelar</button>
                <button class="action-btn save-btn" id="confirm-login">Entrar</button>
            </div>
        </div>
    </div>

    <!-- Sistema de Perfis -->
    <div class="profile-system" id="profile-system">
        <div class="profile-header">
            <h2>Minha Banca</h2>
            <button class="close-btn" id="close-profile">√ó</button>
        </div>
        <div class="profile-content">
            <div class="profile-sidebar">
                <h3>Menu</h3>
                <div class="tab-item" id="profile-stories">Suas Hist√≥rias</div>
                <div class="tab-item" id="profile-chat">Bate Papo</div>
                <div class="tab-item" id="profile-updates">Atualiza√ß√µes</div>
                <div class="tab-item" id="profile-explore">Explorar Bancas</div>
            </div>
            <div class="profile-main">
                <h3 id="profile-main-title">Suas Hist√≥rias</h3>
                <div id="profile-main-content">
                    <p>√Årea para exibir o conte√∫do selecionado no menu lateral.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- FlowSocial -->
    <div class="flowsocial" id="flowsocial">
        <div class="flowsocial-header">
            <h2>FlowSocial</h2>
            <button class="close-btn" id="close-flowsocial">√ó</button>
        </div>
        <div class="flowsocial-content">
            <div class="flowsocial-sidebar">
                <h3>Menu</h3>
                <div class="tab-item" id="social-feed">Feed</div>
                <div class="tab-item" id="social-groups">Grupos</div>
                <div class="tab-item" id="social-jams">Jams</div>
                <div class="tab-item" id="social-wikis">Wikis</div>
                <div class="tab-item" id="social-cafe">Caf√© Liter√°rio</div>
            </div>
            <div class="flowsocial-main">
                <h3 id="social-main-title">Feed</h3>
                <div id="social-main-content">
                    <div class="social-post">
                        <div class="post-header">
                            <div class="post-avatar"></div>
                            <div class="post-author">CriativaFlow</div>
                        </div>
                        <div class="post-content">
                            Acabei de publicar minha nova hist√≥ria interativa! Venham conferir!
                        </div>
                        <div class="post-actions">
                            <button class="post-action">Curtir</button>
                            <button class="post-action">Comentar</button>
                            <button class="post-action">Compartilhar</button>
                        </div>
                    </div>
                    <div class="social-post">
                        <div class="post-header">
                            <div class="post-avatar"></div>
                            <div class="post-author">StoryMaker</div>
                        </div>
                        <div class="post-content">
                            Estou participando da Jam de Outono! Quem mais vai participar?
                        </div>
                        <div class="post-actions">
                            <button class="post-action">Curtir</button>
                            <button class="post-action">Comentar</button>
                            <button class="post-action">Compartilhar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview -->
    <div class="preview" id="preview">
        <div class="preview-header">
            <h2>Preview</h2>
            <button class="close-btn" id="close-preview">√ó</button>
        </div>
        <div class="preview-content">
            <div class="preview-scene">
                <div class="preview-character"></div>
            </div>
            <div class="preview-dialog">
                <p>Esta √© uma pr√©via da sua hist√≥ria. Aqui voc√™ pode testar como ficar√° o jogo.</p>
            </div>
            <button class="action-btn">Pr√≥xima Cena</button>
        </div>
    </div>

    <!-- Configura√ß√µes -->
    <div class="settings" id="settings">
        <div class="settings-header">
            <h2>Configura√ß√µes</h2>
            <button class="close-btn" id="close-settings">√ó</button>
        </div>
        <div class="settings-content">
            <div class="settings-sidebar">
                <h3>Op√ß√µes</h3>
                <div class="tab-item" id="settings-general">Geral</div>
                <div class="tab-item" id="settings-export">Exporta√ß√£o</div>
                <div class="tab-item" id="settings-account">Conta</div>
            </div>
            <div class="settings-main">
                <h3 id="settings-main-title">Configura√ß√µes Gerais</h3>
                <div id="settings-main-content">
                    <div class="setting-group">
                        <h3>Salvamento Autom√°tico</h3>
                        <div class="setting-option">
                            <span>Intervalo de salvamento autom√°tico</span>
                            <select>
                                <option>15 segundos</option>
                                <option>30 segundos</option>
                                <option>1 minuto</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-group">
                        <h3>Interface</h3>
                        <div class="setting-option">
                            <span>Tema</span>
                            <select>
                                <option>Claro</option>
                                <option>Escuro</option>
                                <option>Autom√°tico</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pesquisa de Bolhas -->
    <div class="search-bubbles" id="search-bubbles">
        <div class="search-header">
            <h2>Pesquisar Bolhas</h2>
            <button class="close-btn" id="close-search">√ó</button>
        </div>
        <div class="search-content">
            <div class="search-sidebar">
                <h3>Filtros</h3>
                <div class="form-group">
                    <label for="search-type">Tipo:</label>
                    <select id="search-type">
                        <option>Todos</option>
                        <option>Esqueleto</option>
                        <option>Apar√™ncia</option>
                        <option>Bolhas Filhas</option>
                    </select>
                </div>
            </div>
            <div class="search-main">
                <div class="form-group">
                    <input type="text" placeholder="Digite para pesquisar...">
                </div>
                <div class="search-results">
                    <div class="search-result">
                        <div class="bubble-header">Se</div>
                        <div class="bubble-content">Condicional para verificar uma condi√ß√£o</div>
                    </div>
                    <div class="search-result">
                        <div class="bubble-header">Personagem()</div>
                        <div class="bubble-content">Define um personagem na cena</div>
                    </div>
                    <div class="search-result">
                        <div class="bubble-header">Cen√°rio</div>
                        <div class="bubble-content">Altera o cen√°rio da cena</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nova Hist√≥ria -->
    <div class="new-story" id="new-story">
        <div class="new-story-header">
            <h2>Nova Hist√≥ria Interativa</h2>
            <button class="close-btn" id="close-new-story">√ó</button>
        </div>
        <div class="new-story-content">
            <div class="story-option" id="blank-story">
                <h3>Hist√≥ria em Branco</h3>
                <p>Comece do zero com uma hist√≥ria vazia</p>
            </div>
            <div class="story-option" id="template-story">
                <h3>Usar Template</h3>
                <p>Comece com um template pr√©-definido</p>
            </div>
            <div class="story-option" id="import-story">
                <h3>Importar Hist√≥ria</h3>
                <p>Importe uma hist√≥ria existente</p>
            </div>
        </div>
    </div>

    <!-- Convite -->
    <div class="invite" id="invite">
        <div class="invite-header">
            <h2>Convite-se</h2>
            <button class="close-btn" id="close-invite">√ó</button>
        </div>
        <div class="invite-content">
            <div class="form-group">
                <label for="invite-nick">Nick desejado:</label>
                <input type="text" id="invite-nick">
            </div>
            <div class="form-group">
                <label for="invite-password">Senha:</label>
                <input type="password" id="invite-password">
            </div>
            <div class="form-group">
                <label for="invite-email">Email:</label>
                <input type="email" id="invite-email">
            </div>
            <div class="modal-actions">
                <button class="action-btn" id="cancel-invite">Cancelar</button>
                <button class="action-btn save-btn" id="confirm-invite">Enviar Convite</button>
            </div>
        </div>
    </div>

    <!-- Sistema de Novas Bolhas -->
    <div class="new-bubbles-system" id="new-bubbles-system">
        <div class="new-bubbles-header">
            <h2>Criador de Novas Bolhas</h2>
            <button class="close-btn" id="close-new-bubbles">√ó</button>
        </div>
        <div class="new-bubbles-content">
            <div class="new-bubbles-sidebar">
                <div class="bubble-types">
                    <div class="bubble-type esqueleto active" data-type="esqueleto">
                        <strong>Esqueleto</strong>
                        <p>Condicionais e estrutura</p>
                    </div>
                    <div class="bubble-type aparencia" data-type="aparencia">
                        <strong>Apar√™ncia</strong>
                        <p>Visual e anima√ß√£o</p>
                    </div>
                    <div class="bubble-type acao" data-type="acao">
                        <strong>A√ß√£o</strong>
                        <p>A√ß√µes do personagem</p>
                    </div>
                    <div class="bubble-type variavel" data-type="variavel">
                        <strong>Vari√°vel</strong>
                        <p>Manipula√ß√£o de dados</p>
                    </div>
                    <div class="bubble-type logica" data-type="logica">
                        <strong>L√≥gica</strong>
                        <p>Opera√ß√µes l√≥gicas</p>
                    </div>
                </div>
                
                <div class="created-bubbles">
                    <h3>Bolhas Criadas</h3>
                    <div class="created-bubbles-list" id="created-bubbles-list">
                        <!-- Bolhas criadas aparecer√£o aqui -->
                    </div>
                </div>
            </div>
            
            <div class="new-bubbles-main">
                <div class="bubble-creator">
                    <div class="creator-form">
                        <h3>Criar Nova Bolha</h3>
                        <div class="form-row">
                            <div class="form-group full">
                                <label for="bubble-name">Nome da Bolha:</label>
                                <input type="text" id="bubble-name" placeholder="Ex: Verificar Item">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full">
                                <label for="bubble-description">Descri√ß√£o:</label>
                                <input type="text" id="bubble-description" placeholder="Ex: Verifica se o jogador possui um item espec√≠fico">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full">
                                <label for="bubble-code">C√≥digo da Fun√ß√£o:</label>
                                <textarea id="bubble-code" placeholder="function minhaFuncao(parametro1, parametro2) {
    // Sua l√≥gica aqui
    return resultado;
}"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Par√¢metros:</label>
                            <div class="parameters-list" id="parameters-list">
                                <div class="parameter-item">
                                    <input type="text" placeholder="Nome do par√¢metro" class="param-name">
                                    <input type="text" placeholder="Tipo (ex: string, number)" class="param-type">
                                    <input type="text" placeholder="Valor padr√£o" class="param-default">
                                    <button class="remove-param">√ó</button>
                                </div>
                            </div>
                            <button class="add-param" id="add-param">+ Adicionar Par√¢metro</button>
                        </div>
                        
                        <div class="form-group">
                            <label for="bubble-color">Cor da Bolha:</label>
                            <input type="color" id="bubble-color" value="#e6e6fa">
                        </div>
                    </div>
                    
                    <div class="code-preview" id="code-preview">
                        // Pr√©-visualiza√ß√£o do c√≥digo aparecer√° aqui
                    </div>
                    
                    <div class="editor-actions" style="margin-top: auto;">
                        <button class="action-btn clear-btn" id="clear-creator">Limpar</button>
                        <button class="action-btn" id="test-bubble">Testar Bolha</button>
                        <button class="action-btn save-btn" id="save-bubble">Criar Bolha</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bubble Runner para testar bolhas -->
    <div class="bubble-runner" id="bubble-runner">
        <div class="runner-header">
            <h2>Testador de Bolhas</h2>
            <button class="close-btn" id="close-runner">√ó</button>
        </div>
        <div class="runner-content">
            <div class="runner-console">
                <div class="runner-output" id="runner-output">
                    Aguardando teste da bolha...
                </div>
            </div>
            <div class="runner-input-area">
                <input type="text" class="runner-input" id="runner-input" placeholder="Digite os par√¢metros (separados por v√≠rgula)">
                <button class="runner-run" id="run-bubble">Executar</button>
            </div>
            <div class="runner-actions">
                <button class="action-btn" id="back-to-creator">Voltar ao Criador</button>
                <button class="action-btn save-btn" id="save-from-runner">Usar Bolha</button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let bubbles = [];
        let selectedBubble = null;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let isConnecting = false;
        let connectionStart = null;
        let uploadedFiles = [];
        let customBubbles = JSON.parse(localStorage.getItem('customBubbles')) || [];
        let currentBubbleData = null;

        // Elementos DOM
        const workTable = document.getElementById('work-table');
        const editorArea = document.getElementById('editor-area');
        const loginModal = document.getElementById('login-modal');
        const profileSystem = document.getElementById('profile-system');
        const flowsocial = document.getElementById('flowsocial');
        const preview = document.getElementById('preview');
        const settings = document.getElementById('settings');
        const searchBubbles = document.getElementById('search-bubbles');
        const newStory = document.getElementById('new-story');
        const invite = document.getElementById('invite');
        const uploadSystem = document.getElementById('upload-system');
        const newBubblesSystem = document.getElementById('new-bubbles-system');
        const bubbleRunner = document.getElementById('bubble-runner');
        const shortcutHint = document.getElementById('shortcut-hint');
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadedFilesContainer = document.getElementById('uploaded-files');

        // Event Listeners para abas
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => {
                const type = tab.getAttribute('data-type');
                const title = tab.textContent;
                createBubble(type, title);
            });
        });

        // Event Listeners para bot√µes do menu
        document.getElementById('login-btn').addEventListener('click', () => {
            loginModal.style.display = 'flex';
        });

        document.getElementById('cancel-login').addEventListener('click', () => {
            loginModal.style.display = 'none';
        });

        document.getElementById('confirm-login').addEventListener('click', () => {
            // Simula√ß√£o de login bem-sucedido
            loginModal.style.display = 'none';
            profileSystem.style.display = 'block';
        });

        document.getElementById('close-profile').addEventListener('click', () => {
            profileSystem.style.display = 'none';
        });

        // FlowSocial
        document.getElementById('logo').addEventListener('click', () => {
            flowsocial.style.display = 'block';
        });

        document.getElementById('close-flowsocial').addEventListener('click', () => {
            flowsocial.style.display = 'none';
        });

        // Preview
        document.getElementById('preview-btn').addEventListener('click', () => {
            preview.style.display = 'block';
        });

        document.getElementById('close-preview').addEventListener('click', () => {
            preview.style.display = 'none';
        });

        // Configura√ß√µes
        document.getElementById('settings-btn').addEventListener('click', () => {
            settings.style.display = 'block';
        });

        document.getElementById('close-settings').addEventListener('click', () => {
            settings.style.display = 'none';
        });

        // Pesquisa de Bolhas
        document.getElementById('search-bubbles-btn').addEventListener('click', () => {
            searchBubbles.style.display = 'block';
        });

        document.getElementById('close-search').addEventListener('click', () => {
            searchBubbles.style.display = 'none';
        });

        // Nova Hist√≥ria
        document.getElementById('new-story-btn').addEventListener('click', () => {
            newStory.style.display = 'block';
        });

        document.getElementById('close-new-story').addEventListener('click', () => {
            newStory.style.display = 'none';
        });

        document.getElementById('blank-story').addEventListener('click', () => {
            // Limpar a mesa de trabalho
            workTable.innerHTML = '';
            bubbles = [];
            selectedBubble = null;
            editorArea.value = '';
            newStory.style.display = 'none';
            alert('Nova hist√≥ria em branco criada!');
        });

        // Convite
        document.getElementById('invite-btn').addEventListener('click', () => {
            invite.style.display = 'block';
        });

        document.getElementById('close-invite').addEventListener('click', () => {
            invite.style.display = 'none';
        });

        document.getElementById('cancel-invite').addEventListener('click', () => {
            invite.style.display = 'none';
        });

        document.getElementById('confirm-invite').addEventListener('click', () => {
            const nick = document.getElementById('invite-nick').value;
            if (nick) {
                invite.style.display = 'none';
                alert(`Convite enviado para ${nick}! Verifique seu email.`);
            } else {
                alert('Por favor, insira um nick!');
            }
        });

        // Sistema de Upload
        document.getElementById('upload-btn').addEventListener('click', () => {
            uploadSystem.style.display = 'block';
        });

        document.getElementById('close-upload').addEventListener('click', () => {
            uploadSystem.style.display = 'none';
        });

        // Eventos para upload de arquivos
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Fun√ß√£o para lidar com arquivos carregados
        function handleFiles(files) {
            for (let file of files) {
                // Verificar se √© uma imagem
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const fileData = {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: formatFileSize(file.size),
                            data: e.target.result,
                            type: file.type
                        };
                        
                        uploadedFiles.push(fileData);
                        displayUploadedFiles();
                    };
                    
                    reader.readAsDataURL(file);
                } else {
                    alert(`Formato n√£o suportado: ${file.name}. Apenas PNG, JPG e JPEG s√£o aceitos.`);
                }
            }
        }

        // Fun√ß√£o para formatar tamanho do arquivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Fun√ß√£o para exibir arquivos carregados
        function displayUploadedFiles() {
            uploadedFilesContainer.innerHTML = '<h4>Arquivos Carregados</h4>';
            
            if (uploadedFiles.length === 0) {
                uploadedFilesContainer.innerHTML += '<p>Nenhum arquivo carregado</p>';
                return;
            }
            
            uploadedFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <img src="${file.data}" class="file-preview" alt="${file.name}">
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${file.size}</div>
                    </div>
                    <div class="file-actions">
                        <button class="action-btn" onclick="renameFile('${file.id}')">Renomear</button>
                        <button class="action-btn" onclick="useFile('${file.id}')">Usar</button>
                        <button class="action-btn clear-btn" onclick="deleteFile('${file.id}')">Excluir</button>
                    </div>
                `;
                uploadedFilesContainer.appendChild(fileItem);
            });
        }

        // Fun√ß√£o para renomear arquivo
        function renameFile(fileId) {
            const file = uploadedFiles.find(f => f.id == fileId);
            if (!file) return;
            
            const newName = prompt('Digite o novo nome do arquivo:', file.name);
            if (newName && newName.trim() !== '') {
                file.name = newName.trim();
                displayUploadedFiles();
                alert('Arquivo renomeado com sucesso!');
            }
        }

        // Fun√ß√£o para usar arquivo em uma bolha
        function useFile(fileId) {
            const file = uploadedFiles.find(f => f.id == fileId);
            if (!file) return;
            
            // Criar uma bolha especial para a imagem
            const bubble = createBubble('imagem', `Imagem: ${file.name}`);
            bubble.querySelector('.bubble-content').innerHTML = `<img src="${file.data}" class="bubble-image" alt="${file.name}">`;
            
            uploadSystem.style.display = 'none';
            alert('Imagem adicionada √† mesa de trabalho!');
        }

        // Fun√ß√£o para excluir arquivo
        function deleteFile(fileId) {
            if (confirm('Tem certeza que deseja excluir este arquivo?')) {
                uploadedFiles = uploadedFiles.filter(f => f.id != fileId);
                displayUploadedFiles();
            }
        }

        // Tornar fun√ß√µes globais para uso nos event listeners
        window.renameFile = renameFile;
        window.useFile = useFile;
        window.deleteFile = deleteFile;

        // Salvamento
        document.getElementById('save-point').addEventListener('click', () => {
            alert('SavePoint realizado com sucesso!');
        });

        document.getElementById('save-rote').addEventListener('click', () => {
            showSaveRoteOptions();
        });

        document.getElementById('save-scene').addEventListener('click', () => {
            alert('SaveScene realizado com sucesso!');
        });

        document.getElementById('clear-editor').addEventListener('click', () => {
            editorArea.value = '';
        });

        document.getElementById('save-editor').addEventListener('click', () => {
            if (selectedBubble) {
                selectedBubble.querySelector('.bubble-content').textContent = editorArea.value;
                alert('Conte√∫do da bolha salvo!');
            } else {
                alert('Selecione uma bolha para editar!');
            }
        });

        // Fun√ß√£o para mostrar op√ß√µes de SaveRote
        function showSaveRoteOptions() {
            alert('Op√ß√µes de exporta√ß√£o:\n- HTML com CSS, JavaScript, JSON\n- APK\n- EXE\n- GitHub\n- Itch.io');
        }

        // Fun√ß√£o para criar bolhas
        function createBubble(type, title) {
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.setAttribute('data-type', type);
            
            // Posi√ß√£o aleat√≥ria na mesa de trabalho
            const x = Math.floor(Math.random() * (workTable.offsetWidth - 200));
            const y = Math.floor(Math.random() * (workTable.offsetHeight - 100));
            
            bubble.style.left = `${x}px`;
            bubble.style.top = `${y}px`;
            
            bubble.innerHTML = `
                <div class="bubble-header">
                    <span>${title}</span>
                    <div class="bubble-actions">
                        <button class="bubble-action" title="Conectar">üîó</button>
                        <button class="bubble-action" title="Duplicar">‚éò</button>
                        <button class="bubble-action" title="Excluir">‚úï</button>
                    </div>
                </div>
                <div class="bubble-content">Conte√∫do da bolha ${title}</div>
                <div class="connection-point top"></div>
                <div class="connection-point bottom"></div>
                <div class="connection-point left"></div>
                <div class="connection-point right"></div>
            `;
            
            // Adicionar eventos
            bubble.addEventListener('mousedown', startDrag);
            bubble.addEventListener('click', selectBubble);
            
            // Eventos para os bot√µes da bolha
            const buttons = bubble.querySelectorAll('.bubble-action');
            buttons[0].addEventListener('click', (e) => {
                e.stopPropagation();
                startConnection(bubble);
            });
            
            buttons[1].addEventListener('click', (e) => {
                e.stopPropagation();
                duplicateBubble(bubble);
            });
            
            buttons[2].addEventListener('click', (e) => {
                e.stopPropagation();
                deleteBubble(bubble);
            });
            
            // Eventos para pontos de conex√£o
            const connectionPoints = bubble.querySelectorAll('.connection-point');
            connectionPoints.forEach(point => {
                point.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    startConnection(bubble, point.classList[1]);
                });
            });
            
            workTable.appendChild(bubble);
            bubbles.push(bubble);
            
            return bubble;
        }

        // Fun√ß√£o para selecionar bolha
        function selectBubble(e) {
            if (selectedBubble) {
                selectedBubble.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
            }
            
            selectedBubble = e.currentTarget;
            selectedBubble.style.boxShadow = '0 0 0 2px #8a2be2';
            
            // Preencher editor com conte√∫do da bolha
            const contentElement = selectedBubble.querySelector('.bubble-content');
            if (contentElement.querySelector('img')) {
                // Se for uma imagem, n√£o preencher o editor de texto
                editorArea.value = '[Imagem]';
            } else {
                editorArea.value = contentElement.textContent;
            }
        }

        // Fun√ß√µes para arrastar bolhas
        function startDrag(e) {
            if (e.button !== 0) return; // Apenas bot√£o esquerdo
            
            isDragging = true;
            const bubble = e.currentTarget;
            const rect = bubble.getBoundingClientRect();
            const tableRect = workTable.getBoundingClientRect();
            
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            e.preventDefault();
        }

        function drag(e) {
            if (!isDragging) return;
            
            const bubble = selectedBubble || document.elementFromPoint(e.clientX, e.clientY).closest('.bubble');
            if (!bubble) return;
            
            const tableRect = workTable.getBoundingClientRect();
            const x = e.clientX - tableRect.left - dragOffset.x;
            const y = e.clientY - tableRect.top - dragOffset.y;
            
            bubble.style.left = `${Math.max(0, x)}px`;
            bubble.style.top = `${Math.max(0, y)}px`;
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Fun√ß√£o para duplicar bolha
        function duplicateBubble(bubble) {
            const type = bubble.getAttribute('data-type');
            const title = bubble.querySelector('.bubble-header span').textContent;
            const content = bubble.querySelector('.bubble-content').innerHTML;
            
            const newBubble = createBubble(type, title);
            newBubble.querySelector('.bubble-content').innerHTML = content;
            
            // Posicionar pr√≥ximo √† bolha original
            const rect = bubble.getBoundingClientRect();
            const tableRect = workTable.getBoundingClientRect();
            
            newBubble.style.left = `${rect.left - tableRect.left + 20}px`;
            newBubble.style.top = `${rect.top - tableRect.top + 20}px`;
        }

        // Fun√ß√£o para excluir bolha
        function deleteBubble(bubble) {
            if (confirm('Tem certeza que deseja excluir esta bolha?')) {
                bubble.remove();
                bubbles = bubbles.filter(b => b !== bubble);
                
                if (selectedBubble === bubble) {
                    selectedBubble = null;
                    editorArea.value = '';
                }
            }
        }

        // Fun√ß√µes para conectar bolhas
        function startConnection(bubble, direction) {
            isConnecting = true;
            connectionStart = { bubble, direction };
            
            document.addEventListener('mousemove', drawConnection);
            document.addEventListener('click', finishConnection);
            
            // Mudar cursor para indicar modo de conex√£o
            document.body.style.cursor = 'crosshair';
        }

        function drawConnection(e) {
            if (!isConnecting) return;
            
            // Limpar linhas de conex√£o existentes
            const existingLines = document.querySelectorAll('.connection-line-temp');
            existingLines.forEach(line => line.remove());
            
            // Calcular ponto de in√≠cio
            const startRect = connectionStart.bubble.getBoundingClientRect();
            const tableRect = workTable.getBoundingClientRect();
            
            let startX, startY;
            
            switch (connectionStart.direction) {
                case 'top':
                    startX = startRect.left + startRect.width / 2 - tableRect.left;
                    startY = startRect.top - tableRect.top;
                    break;
                case 'bottom':
                    startX = startRect.left + startRect.width / 2 - tableRect.left;
                    startY = startRect.bottom - tableRect.top;
                    break;
                case 'left':
                    startX = startRect.left - tableRect.left;
                    startY = startRect.top + startRect.height / 2 - tableRect.top;
                    break;
                case 'right':
                    startX = startRect.right - tableRect.left;
                    startY = startRect.top + startRect.height / 2 - tableRect.top;
                    break;
                default:
                    startX = startRect.left + startRect.width / 2 - tableRect.left;
                    startY = startRect.top + startRect.height / 2 - tableRect.top;
            }
            
            // Calcular ponto final (posi√ß√£o do mouse)
            const endX = e.clientX - tableRect.left;
            const endY = e.clientY - tableRect.top;
            
            // Calcular dist√¢ncia e √¢ngulo
            const dx = endX - startX;
            const dy = endY - startY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            // Criar linha tempor√°ria
            const line = document.createElement('div');
            line.className = 'connection-line connection-line-temp';
            line.style.left = `${startX}px`;
            line.style.top = `${startY}px`;
            line.style.width = `${distance}px`;
            line.style.transform = `rotate(${angle}deg)`;
            
            workTable.appendChild(line);
        }

        function finishConnection(e) {
            if (!isConnecting) return;
            
            isConnecting = false;
            document.removeEventListener('mousemove', drawConnection);
            document.removeEventListener('click', finishConnection);
            
            // Restaurar cursor
            document.body.style.cursor = 'default';
            
            // Remover linha tempor√°ria
            const tempLines = document.querySelectorAll('.connection-line-temp');
            tempLines.forEach(line => line.remove());
            
            // Verificar se o clique foi em uma bolha
            const targetBubble = e.target.closest('.bubble');
            if (targetBubble && targetBubble !== connectionStart.bubble) {
                // Criar conex√£o permanente
                createPermanentConnection(connectionStart.bubble, targetBubble);
            }
        }

        function createPermanentConnection(bubble1, bubble2) {
            // Calcular pontos de conex√£o
            const rect1 = bubble1.getBoundingClientRect();
            const rect2 = bubble2.getBoundingClientRect();
            const tableRect = workTable.getBoundingClientRect();
            
            const startX = rect1.left + rect1.width / 2 - tableRect.left;
            const startY = rect1.top + rect1.height / 2 - tableRect.top;
            
            const endX = rect2.left + rect2.width / 2 - tableRect.left;
            const endY = rect2.top + rect2.height / 2 - tableRect.top;
            
            // Calcular dist√¢ncia e √¢ngulo
            const dx = endX - startX;
            const dy = endY - startY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            // Criar linha permanente
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.style.left = `${startX}px`;
            line.style.top = `${startY}px`;
            line.style.width = `${distance}px`;
            line.style.transform = `rotate(${angle}deg)`;
            
            workTable.appendChild(line);
            
            alert(`Bolhas "${bubble1.querySelector('.bubble-header span').textContent}" e "${bubble2.querySelector('.bubble-header span').textContent}" conectadas!`);
        }

        // Sistema de Novas Bolhas
        document.getElementById('new-bubble-btn').addEventListener('click', () => {
            newBubblesSystem.style.display = 'block';
            loadCreatedBubbles();
        });

        document.getElementById('close-new-bubbles').addEventListener('click', () => {
            newBubblesSystem.style.display = 'none';
        });

        // Tipos de bolha
        document.querySelectorAll('.bubble-type').forEach(type => {
            type.addEventListener('click', () => {
                document.querySelectorAll('.bubble-type').forEach(t => t.classList.remove('active'));
                type.classList.add('active');
            });
        });

        // Adicionar par√¢metro
        document.getElementById('add-param').addEventListener('click', () => {
            const paramItem = document.createElement('div');
            paramItem.className = 'parameter-item';
            paramItem.innerHTML = `
                <input type="text" placeholder="Nome do par√¢metro" class="param-name">
                <input type="text" placeholder="Tipo (ex: string, number)" class="param-type">
                <input type="text" placeholder="Valor padr√£o" class="param-default">
                <button class="remove-param">√ó</button>
            `;
            document.getElementById('parameters-list').appendChild(paramItem);
            
            paramItem.querySelector('.remove-param').addEventListener('click', () => {
                paramItem.remove();
            });
        });

        // Limpar criador
        document.getElementById('clear-creator').addEventListener('click', () => {
            document.getElementById('bubble-name').value = '';
            document.getElementById('bubble-description').value = '';
            document.getElementById('bubble-code').value = '';
            document.getElementById('parameters-list').innerHTML = `
                <div class="parameter-item">
                    <input type="text" placeholder="Nome do par√¢metro" class="param-name">
                    <input type="text" placeholder="Tipo (ex: string, number)" class="param-type">
                    <input type="text" placeholder="Valor padr√£o" class="param-default">
                    <button class="remove-param">√ó</button>
                </div>
            `;
            document.getElementById('code-preview').textContent = '// Pr√©-visualiza√ß√£o do c√≥digo aparecer√° aqui';
        });

        // Salvar bolha
        document.getElementById('save-bubble').addEventListener('click', () => {
            const name = document.getElementById('bubble-name').value.trim();
            const description = document.getElementById('bubble-description').value.trim();
            const code = document.getElementById('bubble-code').value.trim();
            const color = document.getElementById('bubble-color').value;
            const type = document.querySelector('.bubble-type.active').getAttribute('data-type');
            
            if (!name || !code) {
                alert('Por favor, preencha pelo menos o nome e o c√≥digo da bolha!');
                return;
            }
            
            // Coletar par√¢metros
            const parameters = [];
            document.querySelectorAll('.parameter-item').forEach(item => {
                const paramName = item.querySelector('.param-name').value.trim();
                const paramType = item.querySelector('.param-type').value.trim();
                const paramDefault = item.querySelector('.param-default').value.trim();
                
                if (paramName) {
                    parameters.push({
                        name: paramName,
                        type: paramType || 'any',
                        default: paramDefault
                    });
                }
            });
            
            const bubbleData = {
                id: Date.now() + Math.random(),
                name,
                description,
                code,
                type,
                color,
                parameters,
                createdAt: new Date().toISOString()
            };
            
            customBubbles.push(bubbleData);
            localStorage.setItem('customBubbles', JSON.stringify(customBubbles));
            
            alert('Bolha criada com sucesso!');
            loadCreatedBubbles();
            clearCreator();
        });

        // Testar bolha
        document.getElementById('test-bubble').addEventListener('click', () => {
            const name = document.getElementById('bubble-name').value.trim();
            const code = document.getElementById('bubble-code').value.trim();
            
            if (!name || !code) {
                alert('Por favor, preencha pelo menos o nome e o c√≥digo da bolha!');
                return;
            }
            
            // Coletar dados da bolha
            const parameters = [];
            document.querySelectorAll('.parameter-item').forEach(item => {
                const paramName = item.querySelector('.param-name').value.trim();
                const paramType = item.querySelector('.param-type').value.trim();
                const paramDefault = item.querySelector('.param-default').value.trim();
                
                if (paramName) {
                    parameters.push({
                        name: paramName,
                        type: paramType || 'any',
                        default: paramDefault
                    });
                }
            });
            
            currentBubbleData = {
                name,
                code,
                parameters
            };
            
            newBubblesSystem.style.display = 'none';
            bubbleRunner.style.display = 'block';
            
            // Mostrar informa√ß√µes da bolha no runner
            document.getElementById('runner-output').innerHTML = `
                <strong>Testando bolha:</strong> ${name}<br><br>
                <strong>C√≥digo:</strong><br>
                <pre style="color: #ccc">${code}</pre><br>
                <strong>Par√¢metros necess√°rios:</strong><br>
                ${parameters.map(p => `${p.name} (${p.type}) = ${p.default || 'sem valor padr√£o'}`).join('<br>')}<br><br>
                Digite os valores dos par√¢metros no campo abaixo, separados por v√≠rgula.
            `;
        });

        // Executar bolha no runner
        document.getElementById('run-bubble').addEventListener('click', () => {
            if (!currentBubbleData) return;
            
            const input = document.getElementById('runner-input').value.trim();
            let params = [];
            
            if (input) {
                params = input.split(',').map(p => p.trim());
            }
            
            try {
                // Criar fun√ß√£o a partir do c√≥digo
                const func = new Function('return ' + currentBubbleData.code)();
                
                // Executar fun√ß√£o com par√¢metros
                const result = func(...params);
                
                document.getElementById('runner-output').innerHTML += `
                    <br><br>
                    <strong>Resultado da execu√ß√£o:</strong><br>
                    <pre style="color: #4CAF50">${JSON.stringify(result, null, 2)}</pre><br>
                    <strong>Tipo do retorno:</strong> ${typeof result}
                `;
            } catch (error) {
                document.getElementById('runner-output').innerHTML += `
                    <br><br>
                    <strong style="color: #ff4444">Erro na execu√ß√£o:</strong><br>
                    <pre style="color: #ff4444">${error.message}</pre>
                `;
            }
        });

        // Voltar ao criador
        document.getElementById('back-to-creator').addEventListener('click', () => {
            bubbleRunner.style.display = 'none';
            newBubblesSystem.style.display = 'block';
        });

        // Usar bolha a partir do runner
        document.getElementById('save-from-runner').addEventListener('click', () => {
            bubbleRunner.style.display = 'none';
            
            // Coletar dados do formul√°rio
            const name = document.getElementById('bubble-name').value.trim();
            const description = document.getElementById('bubble-description').value.trim();
            const code = document.getElementById('bubble-code').value.trim();
            const color = document.getElementById('bubble-color').value;
            const type = document.querySelector('.bubble-type.active').getAttribute('data-type');
            
            const bubbleData = {
                id: Date.now() + Math.random(),
                name,
                description,
                code,
                type,
                color,
                parameters: currentBubbleData.parameters,
                createdAt: new Date().toISOString()
            };
            
            customBubbles.push(bubbleData);
            localStorage.setItem('customBubbles', JSON.stringify(customBubbles));
            
            // Criar bolha na mesa de trabalho
            createCustomBubble(bubbleData);
            
            alert('Bolha criada e adicionada √† mesa de trabalho!');
        });

        // Fechar runner
        document.getElementById('close-runner').addEventListener('click', () => {
            bubbleRunner.style.display = 'none';
            newBubblesSystem.style.display = 'block';
        });

        // Carregar bolhas criadas
        function loadCreatedBubbles() {
            const container = document.getElementById('created-bubbles-list');
            container.innerHTML = '';
            
            if (customBubbles.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhuma bolha criada ainda</p>';
                return;
            }
            
            customBubbles.forEach(bubble => {
                const bubbleElement = document.createElement('div');
                bubbleElement.className = 'created-bubble';
                bubbleElement.innerHTML = `
                    <div class="bubble-info">
                        <h4>${bubble.name}</h4>
                        <p style="font-size: 12px; color: #666; margin: 5px 0;">${bubble.description}</p>
                        <span class="bubble-type-label" style="background-color: ${bubble.color}">${bubble.type}</span>
                    </div>
                    <div class="bubble-actions">
                        <button class="test-bubble" data-id="${bubble.id}">Testar</button>
                        <button class="use-bubble" data-id="${bubble.id}">Usar</button>
                        <button class="delete-bubble" data-id="${bubble.id}">√ó</button>
                    </div>
                `;
                
                container.appendChild(bubbleElement);
                
                // Event listeners para os bot√µes
                bubbleElement.querySelector('.test-bubble').addEventListener('click', () => {
                    testCustomBubble(bubble);
                });
                
                bubbleElement.querySelector('.use-bubble').addEventListener('click', () => {
                    createCustomBubble(bubble);
                });
                
                bubbleElement.querySelector('.delete-bubble').addEventListener('click', () => {
                    if (confirm(`Tem certeza que deseja excluir a bolha "${bubble.name}"?`)) {
                        customBubbles = customBubbles.filter(b => b.id !== bubble.id);
                        localStorage.setItem('customBubbles', JSON.stringify(customBubbles));
                        loadCreatedBubbles();
                    }
                });
            });
        }

        // Testar bolha customizada
        function testCustomBubble(bubble) {
            currentBubbleData = {
                name: bubble.name,
                code: bubble.code,
                parameters: bubble.parameters
            };
            
            newBubblesSystem.style.display = 'none';
            bubbleRunner.style.display = 'block';
            
            document.getElementById('runner-output').innerHTML = `
                <strong>Testando bolha:</strong> ${bubble.name}<br><br>
                <strong>C√≥digo:</strong><br>
                <pre style="color: #ccc">${bubble.code}</pre><br>
                <strong>Par√¢metros necess√°rios:</strong><br>
                ${bubble.parameters.map(p => `${p.name} (${p.type}) = ${p.default || 'sem valor padr√£o'}`).join('<br>')}<br><br>
                Digite os valores dos par√¢metros no campo abaixo, separados por v√≠rgula.
            `;
            document.getElementById('runner-input').value = '';
        }

        // Criar bolha customizada na mesa de trabalho
        function createCustomBubble(bubble) {
            const bubbleElement = document.createElement('div');
            bubbleElement.className = 'bubble';
            bubbleElement.setAttribute('data-type', 'custom');
            bubbleElement.setAttribute('data-custom-id', bubble.id);
            
            // Posi√ß√£o aleat√≥ria
            const x = Math.floor(Math.random() * (workTable.offsetWidth - 200));
            const y = Math.floor(Math.random() * (workTable.offsetHeight - 100));
            
            bubbleElement.style.left = `${x}px`;
            bubbleElement.style.top = `${y}px`;
            bubbleElement.style.backgroundColor = bubble.color;
            
            // Construir descri√ß√£o dos par√¢metros
            const paramsDesc = bubble.parameters.map(p => 
                `${p.name}${p.default ? `=${p.default}` : ''}`
            ).join(', ');
            
            bubbleElement.innerHTML = `
                <div class="bubble-header">
                    <span>${bubble.name}</span>
                    <div class="bubble-actions">
                        <button class="bubble-action" title="Conectar">üîó</button>
                        <button class="bubble-action" title="Settar">‚öô</button>
                        <button class="bubble-action" title="Duplicar">‚éò</button>
                        <button class="bubble-action" title="Excluir">‚úï</button>
                    </div>
                </div>
                <div class="bubble-content">
                    <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                        ${bubble.description}
                    </div>
                    <pre style="font-size: 10px; background: #f5f5f5; padding: 5px; border-radius: 3px; margin: 5px 0;">
${bubble.name}(${paramsDesc})
                    </pre>
                    <div style="font-size: 11px; color: #666;">
                        Clique em ‚öô para configurar
                    </div>
                </div>
                <div class="connection-point top"></div>
                <div class="connection-point bottom"></div>
                <div class="connection-point left"></div>
                <div class="connection-point right"></div>
            `;
            
            // Adicionar eventos
            bubbleElement.addEventListener('mousedown', startDrag);
            bubbleElement.addEventListener('click', selectBubble);
            
            // Eventos para os bot√µes da bolha
            const buttons = bubbleElement.querySelectorAll('.bubble-action');
            buttons[0].addEventListener('click', (e) => {
                e.stopPropagation();
                startConnection(bubbleElement);
            });
            
            buttons[1].addEventListener('click', (e) => {
                e.stopPropagation();
                settarBubble(bubbleElement, bubble);
            });
            
            buttons[2].addEventListener('click', (e) => {
                e.stopPropagation();
                duplicateCustomBubble(bubbleElement, bubble);
            });
            
            buttons[3].addEventListener('click', (e) => {
                e.stopPropagation();
                deleteBubble(bubbleElement);
            });
            
            // Eventos para pontos de conex√£o
            const connectionPoints = bubbleElement.querySelectorAll('.connection-point');
            connectionPoints.forEach(point => {
                point.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    startConnection(bubbleElement, point.classList[1]);
                });
            });
            
            workTable.appendChild(bubbleElement);
            bubbles.push(bubbleElement);
            
            newBubblesSystem.style.display = 'none';
        }

        // Settar (configurar) bolha customizada
        function settarBubble(bubbleElement, bubbleData) {
            const customId = bubbleElement.getAttribute('data-custom-id');
            const bubble = customBubbles.find(b => b.id == customId);
            
            if (!bubble) return;
            
            // Criar modal de configura√ß√£o
            const settarModal = document.createElement('div');
            settarModal.className = 'modal';
            settarModal.style.display = 'flex';
            
            let inputsHTML = '';
            bubble.parameters.forEach((param, index) => {
                inputsHTML += `
                    <div class="form-group">
                        <label for="param-${index}">${param.name} (${param.type}):</label>
                        <input type="text" id="param-${index}" 
                               value="${param.default || ''}" 
                               placeholder="Digite o valor para ${param.name}">
                    </div>
                `;
            });
            
            settarModal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">Configurar: ${bubble.name}</div>
                    <div style="margin-bottom: 15px; font-size: 14px; color: #666;">
                        ${bubble.description}
                    </div>
                    ${inputsHTML}
                    <div class="modal-actions">
                        <button class="action-btn" id="cancel-settar">Cancelar</button>
                        <button class="action-btn save-btn" id="apply-settar">Aplicar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(settarModal);
            
            // Event listeners para o modal
            settarModal.querySelector('#cancel-settar').addEventListener('click', () => {
                document.body.removeChild(settarModal);
            });
            
            settarModal.querySelector('#apply-settar').addEventListener('click', () => {
                const paramValues = [];
                bubble.parameters.forEach((param, index) => {
                    const value = settarModal.querySelector(`#param-${index}`).value;
                    paramValues.push(value || param.default || '');
                });
                
                // Atualizar conte√∫do da bolha
                const contentElement = bubbleElement.querySelector('.bubble-content');
                const paramsString = paramValues.map((v, i) => 
                    `${bubble.parameters[i].name}="${v}"`
                ).join(', ');
                
                contentElement.innerHTML = `
                    <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                        ${bubble.description}
                    </div>
                    <pre style="font-size: 10px; background: #f5f5f5; padding: 5px; border-radius: 3px; margin: 5px 0;">
${bubble.name}(${paramsString})
                    </pre>
                    <div style="font-size: 11px; color: #4CAF50; margin-top: 5px;">
                        ‚úì Configurada com valores personalizados
                    </div>
                `;
                
                document.body.removeChild(settarModal);
                alert('Bolha configurada com sucesso!');
            });
        }

        // Duplicar bolha customizada
        function duplicateCustomBubble(bubbleElement, bubbleData) {
            const newBubble = createCustomBubble(bubbleData);
            
            // Posicionar pr√≥ximo √† bolha original
            const rect = bubbleElement.getBoundingClientRect();
            const tableRect = workTable.getBoundingClientRect();
            
            newBubble.style.left = `${rect.left - tableRect.left + 20}px`;
            newBubble.style.top = `${rect.top - tableRect.top + 20}px`;
            
            // Copiar configura√ß√µes se existirem
            const content = bubbleElement.querySelector('.bubble-content').innerHTML;
            newBubble.querySelector('.bubble-content').innerHTML = content;
        }

        // Limpar criador
        function clearCreator() {
            document.getElementById('bubble-name').value = '';
            document.getElementById('bubble-description').value = '';
            document.getElementById('bubble-code').value = '';
            document.getElementById('parameters-list').innerHTML = `
                <div class="parameter-item">
                    <input type="text" placeholder="Nome do par√¢metro" class="param-name">
                    <input type="text" placeholder="Tipo (ex: string, number)" class="param-type">
                    <input type="text" placeholder="Valor padr√£o" class="param-default">
                    <button class="remove-param">√ó</button>
                </div>
            `;
            document.getElementById('code-preview').textContent = '// Pr√©-visualiza√ß√£o do c√≥digo aparecer√° aqui';
        }

        // Atualizar pr√©-visualiza√ß√£o do c√≥digo
        document.getElementById('bubble-code').addEventListener('input', () => {
            const code = document.getElementById('bubble-code').value;
            const name = document.getElementById('bubble-name').value || 'minhaBolha';
            
            const params = [];
            document.querySelectorAll('.parameter-item').forEach(item => {
                const paramName = item.querySelector('.param-name').value.trim();
                if (paramName) {
                    params.push(paramName);
                }
            });
            
            const paramsString = params.join(', ');
            const preview = `function ${name}(${paramsString}) {\n    ${code}\n}`;
            
            document.getElementById('code-preview').textContent = preview;
        });

        // Atalhos de teclado
        document.addEventListener('keydown', (e) => {
            // Ctrl+Z para desfazer
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                alert('A√ß√£o desfeita!');
            }
            
            // Ctrl+Y para refazer
            if (e.ctrlKey && e.key === 'y') {
                e.preventDefault();
                alert('A√ß√£o refeita!');
            }
            
            // Enter para SaveRote
            if (e.key === 'Enter' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                // Verificar se n√£o est√° em um campo de entrada
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    showSaveRoteOptions();
                    showShortcutHint('Enter: SaveRote');
                }
            }
            
            // Delete para apagar bolha selecionada
            if (e.key === 'Delete' && selectedBubble) {
                deleteBubble(selectedBubble);
            }
            
            // ESC para fechar modais
            if (e.key === 'Escape') {
                if (loginModal.style.display === 'flex') {
                    loginModal.style.display = 'none';
                }
                if (profileSystem.style.display === 'block') {
                    profileSystem.style.display = 'none';
                }
                if (flowsocial.style.display === 'block') {
                    flowsocial.style.display = 'none';
                }
                if (preview.style.display === 'block') {
                    preview.style.display = 'none';
                }
                if (settings.style.display === 'block') {
                    settings.style.display = 'none';
                }
                if (searchBubbles.style.display === 'block') {
                    searchBubbles.style.display = 'none';
                }
                if (newStory.style.display === 'block') {
                    newStory.style.display = 'none';
                }
                if (invite.style.display === 'block') {
                    invite.style.display = 'none';
                }
                if (uploadSystem.style.display === 'block') {
                    uploadSystem.style.display = 'none';
                }
                if (newBubblesSystem.style.display === 'block') {
                    newBubblesSystem.style.display = 'none';
                }
                if (bubbleRunner.style.display === 'block') {
                    bubbleRunner.style.display = 'none';
                }
            }
        });

        // Fun√ß√£o para mostrar dica de atalho
        function showShortcutHint(message) {
            shortcutHint.textContent = message;
            shortcutHint.classList.add('show');
            
            setTimeout(() => {
                shortcutHint.classList.remove('show');
            }, 2000);
        }

        // Simular salvamento autom√°tico a cada 15 segundos
        setInterval(() => {
            console.log('Salvamento autom√°tico realizado');
        }, 15000);

        // Carregar bolhas criadas ao iniciar
        window.addEventListener('load', () => {
            loadCreatedBubbles();
        });
		
		// Adicionar comandos organizados como bolhas personalizadas
const flowCommands = {
    // Comando 1: Organiza√ß√£o
    organizar: [
        {
            name: "organizar_ui",
            description: "Organizar a interface do usu√°rio (menu)",
            code: `function organizar_ui() {
    // Organiza o menu da interface
    console.log("Organizando menu...");
    // L√≥gica para organizar UI
    return "UI organizada";
}`,
            type: "organizacao",
            color: "#e6e6fa",
            parameters: []
        },
        {
            name: "organizar_sprites",
            description: "Organizar sprites dos personagens",
            code: `function organizar_sprites() {
    // Organiza os sprites dos personagens
    console.log("Organizando sprites de personagens...");
    // L√≥gica para organizar sprites
    return "Sprites organizados";
}`,
            type: "organizacao",
            color: "#e6e6fa",
            parameters: []
        },
        {
            name: "obj_sprite",
            description: "Organizar sprites de objetos",
            code: `function obj_sprite() {
    // Organiza sprites de objetos
    console.log("Organizando sprites de objetos...");
    // L√≥gica para organizar objetos
    return "Objetos organizados";
}`,
            type: "organizacao",
            color: "#e6e6fa",
            parameters: []
        },
        {
            name: "cena_org",
            description: "Organizar elementos da cena",
            code: `function cena_org() {
    // Organiza os elementos da cena
    console.log("Organizando cena...");
    // L√≥gica para organizar cena
    return "Cena organizada";
}`,
            type: "organizacao",
            color: "#e6e6fa",
            parameters: []
        },
        {
            name: "fundo_org",
            description: "Organizar fundo da cena",
            code: `function fundo_org() {
    // Organiza o fundo da cena
    console.log("Organizando fundo...");
    // L√≥gica para organizar fundo
    return "Fundo organizado";
}`,
            type: "organizacao",
            color: "#e6e6fa",
            parameters: []
        }
    ],

    // Comando 2: Ativa√ß√£o e Posicionamento
    ativacao: [
        {
            name: "start_",
            description: "Ativar bot√£o iniciar",
            code: `function start_(callback) {
    // Ativa o bot√£o de iniciar
    console.log("Ativando bot√£o iniciar...");
    
    // Cria elemento do bot√£o
    const botaoIniciar = document.createElement('button');
    botaoIniciar.id = 'botao-iniciar';
    botaoIniciar.textContent = 'Iniciar';
    botaoIniciar.style.cssText = \`
        padding: 15px 30px;
        font-size: 18px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    \`;
    
    // Adiciona evento de clique
    botaoIniciar.addEventListener('click', function() {
        console.log("Jogo iniciado!");
        if (callback) callback();
    });
    
    // Adiciona ao documento
    document.body.appendChild(botaoIniciar);
    
    return botaoIniciar;
}`,
            type: "ativacao",
            color: "#ffd8b1",
            parameters: [
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "volta_aqui_",
            description: "Ativar bot√£o retornar ao menu",
            code: `function volta_aqui_(callback) {
    // Ativa o bot√£o de retornar ao menu
    console.log("Ativando bot√£o voltar ao menu...");
    
    const botaoVoltar = document.createElement('button');
    botaoVoltar.id = 'botao-voltar';
    botaoVoltar.textContent = 'Voltar ao Menu';
    botaoVoltar.style.cssText = \`
        padding: 10px 20px;
        font-size: 16px;
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
    \`;
    
    botaoVoltar.addEventListener('click', function() {
        console.log("Retornando ao menu...");
        if (callback) callback();
    });
    
    document.body.appendChild(botaoVoltar);
    return botaoVoltar;
}`,
            type: "ativacao",
            color: "#ffd8b1",
            parameters: [
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "lembrando_aqui_",
            description: "Ativar bot√£o save point",
            code: `function lembrando_aqui_(id, callback) {
    // Ativa o bot√£o de save point
    console.log("Ativando bot√£o save point...");
    
    const saveId = id || 'save_' + Date.now();
    const botaoSave = document.createElement('button');
    botaoSave.id = 'botao-save-' + saveId;
    botaoSave.textContent = 'Salvar Progresso';
    botaoSave.style.cssText = \`
        padding: 10px 20px;
        font-size: 16px;
        background-color: #FF9800;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
    \`;
    
    botaoSave.addEventListener('click', function() {
        console.log("Salvando progresso no ponto: " + saveId);
        // Salvar dados do jogo
        const saveData = {
            id: saveId,
            timestamp: Date.now(),
            progresso: getProgressoAtual()
        };
        
        localStorage.setItem('save_' + saveId, JSON.stringify(saveData));
        
        if (callback) callback(saveData);
    });
    
    document.body.appendChild(botaoSave);
    return botaoSave;
}`,
            type: "ativacao",
            color: "#ffd8b1",
            parameters: [
                { name: "id", type: "string", default: "'save_default'" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "diga_ai_",
            description: "Ativar bot√£o di√°logo",
            code: `function diga_ai_(texto, callback) {
    // Ativa o bot√£o de di√°logo
    console.log("Ativando bot√£o de di√°logo...");
    
    const dialogText = texto || "Clique para continuar...";
    const botaoDialogo = document.createElement('button');
    botaoDialogo.id = 'botao-dialogo';
    botaoDialogo.textContent = dialogText;
    botaoDialogo.style.cssText = \`
        padding: 12px 24px;
        font-size: 16px;
        background-color: #9C27B0;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
    \`;
    
    botaoDialogo.addEventListener('click', function() {
        console.log("Di√°logo avan√ßado");
        if (callback) callback();
    });
    
    document.body.appendChild(botaoDialogo);
    return botaoDialogo;
}`,
            type: "ativacao",
            color: "#ffd8b1",
            parameters: [
                { name: "texto", type: "string", default: "'Continuar'" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "spt_comp_",
            description: "Comparecer personagem na posi√ß√£o",
            code: `function spt_comp_(personagem, posX, posY) {
    // Faz o personagem comparecer na posi√ß√£o especificada
    console.log("Personagem " + personagem + " comparecendo em (" + posX + ", " + posY + ")");
    
    // Criar elemento do personagem
    const elementoPersonagem = document.createElement('div');
    elementoPersonagem.className = 'personagem-' + personagem;
    elementoPersonagem.style.cssText = \`
        position: absolute;
        left: \${posX}px;
        top: \${posY}px;
        width: 100px;
        height: 200px;
        background-color: #ddd;
        border-radius: 10px;
        transition: all 0.5s ease;
    \`;
    
    // Adicionar ao container da cena
    const cenaContainer = document.getElementById('cena-container') || document.body;
    cenaContainer.appendChild(elementoPersonagem);
    
    return elementoPersonagem;
}`,
            type: "posicionamento",
            color: "#fffacd",
            parameters: [
                { name: "personagem", type: "string", default: "'protagonista'" },
                { name: "posX", type: "number", default: "100" },
                { name: "posY", type: "number", default: "100" }
            ]
        },
        {
            name: "obj_comp_",
            description: "Comparecer objetos e bot√µes na posi√ß√£o",
            code: `function obj_comp_(tipo, posX, posY, config) {
    // Faz objeto ou bot√£o comparecer na posi√ß√£o
    console.log(tipo + " comparecendo em (" + posX + ", " + posY + ")");
    
    const elemento = document.createElement('div');
    elemento.className = 'objeto-' + tipo;
    elemento.style.cssText = \`
        position: absolute;
        left: \${posX}px;
        top: \${posY}px;
        width: 80px;
        height: 80px;
        background-color: #bbb;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    \`;
    
    elemento.textContent = tipo;
    
    // Aplicar configura√ß√µes adicionais
    if (config && config.cor) {
        elemento.style.backgroundColor = config.cor;
    }
    
    document.body.appendChild(elemento);
    return elemento;
}`,
            type: "posicionamento",
            color: "#fffacd",
            parameters: [
                { name: "tipo", type: "string", default: "'objeto'" },
                { name: "posX", type: "number", default: "200" },
                { name: "posY", type: "number", default: "200" },
                { name: "config", type: "object", default: "{}" }
            ]
        },
        {
            name: "fundo_comp_",
            description: "Comparecer fundo na posi√ß√£o",
            code: `function fundo_comp_(imagemUrl, posX, posY) {
    // Coloca o fundo na posi√ß√£o especificada
    console.log("Fundo colocado em (" + posX + ", " + posY + ")");
    
    const fundo = document.createElement('div');
    fundo.id = 'fundo-cena';
    fundo.style.cssText = \`
        position: absolute;
        left: \${posX}px;
        top: \${posY}px;
        width: 100%;
        height: 100%;
        background-image: url('\${imagemUrl}');
        background-size: cover;
        background-position: center;
        z-index: -1;
    \`;
    
    document.body.appendChild(fundo);
    return fundo;
}`,
            type: "posicionamento",
            color: "#fffacd",
            parameters: [
                { name: "imagemUrl", type: "string", default: "'https://example.com/fundo.jpg'" },
                { name: "posX", type: "number", default: "0" },
                { name: "posY", type: "number", default: "0" }
            ]
        }
    ],

    // Comando 3: Interface e A√ß√µes
    interface: [
        {
            name: "criar_botao",
            description: "Criar bot√£o personalizado",
            code: `function criar_botao(texto, cor, tamanho, callback) {
    // Cria um bot√£o personalizado
    console.log("Criando bot√£o: " + texto);
    
    const botao = document.createElement('button');
    botao.className = 'botao-personalizado';
    botao.textContent = texto;
    
    // Definir tamanho
    const tamanhos = {
        pequeno: '8px 16px',
        medio: '12px 24px',
        grande: '16px 32px'
    };
    
    const padding = tamanhos[tamanho] || tamanhos.medio;
    
    botao.style.cssText = \`
        padding: \${padding};
        font-size: 16px;
        background-color: \${cor || '#2196F3'};
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
        transition: transform 0.2s, background-color 0.2s;
    \`;
    
    // Efeitos hover
    botao.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05)';
        this.style.backgroundColor = darkenColor(cor || '#2196F3', 20);
    });
    
    botao.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
        this.style.backgroundColor = cor || '#2196F3';
    });
    
    // Evento de clique
    botao.addEventListener('click', function() {
        console.log("Bot√£o clicado: " + texto);
        if (callback) callback();
    });
    
    document.body.appendChild(botao);
    return botao;
}

function darkenColor(color, percent) {
    // Fun√ß√£o auxiliar para escurecer cor
    const num = parseInt(color.replace("#", ""), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) - amt;
    const G = (num >> 8 & 0x00FF) - amt;
    const B = (num & 0x0000FF) - amt;
    
    return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
}`,
            type: "interface",
            color: "#ffd1dc",
            parameters: [
                { name: "texto", type: "string", default: "'Bot√£o'" },
                { name: "cor", type: "string", default: "'#2196F3'" },
                { name: "tamanho", type: "string", default: "'medio'" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "fundo_do_botao",
            description: "Definir cor do fundo do bot√£o",
            code: `function fundo_do_botao(botao, cor) {
    // Define a cor do fundo de um bot√£o
    console.log("Alterando fundo do bot√£o para: " + cor);
    
    if (typeof botao === 'string') {
        // Se for um seletor
        const elemento = document.querySelector(botao);
        if (elemento) {
            elemento.style.backgroundColor = cor;
            return elemento;
        }
    } else if (botao && botao.style) {
        // Se for um elemento DOM
        botao.style.backgroundColor = cor;
        return botao;
    }
    
    console.error("Bot√£o n√£o encontrado");
    return null;
}`,
            type: "interface",
            color: "#ffd1dc",
            parameters: [
                { name: "botao", type: "mixed", default: "'.botao-personalizado'" },
                { name: "cor", type: "string", default: "'#4CAF50'" }
            ]
        },
        {
            name: "fazer_escolha",
            description: "Sistema de escolhas para protagonista",
            code: `function fazer_escolha(opcoes, callback) {
    // Cria um sistema de escolhas para o protagonista
    console.log("Criando sistema de escolhas...");
    
    const containerEscolhas = document.createElement('div');
    containerEscolhas.id = 'container-escolhas';
    containerEscolhas.style.cssText = \`
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-width: 300px;
        max-width: 500px;
        z-index: 1000;
    \`;
    
    const titulo = document.createElement('h3');
    titulo.textContent = "O que voc√™ quer fazer?";
    titulo.style.color = "white";
    titulo.style.margin = "0 0 15px 0";
    titulo.style.textAlign = "center";
    containerEscolhas.appendChild(titulo);
    
    opcoes.forEach((opcao, index) => {
        const botaoEscolha = document.createElement('button');
        botaoEscolha.textContent = opcao.texto || "Op√ß√£o " + (index + 1);
        botaoEscolha.style.cssText = \`
            padding: 12px;
            background-color: #6200EA;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        \`;
        
        botaoEscolha.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#3700B3';
        });
        
        botaoEscolha.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#6200EA';
        });
        
        botaoEscolha.addEventListener('click', function() {
            console.log("Escolha selecionada: " + opcao.texto);
            if (callback) callback(opcao);
            document.body.removeChild(containerEscolhas);
        });
        
        containerEscolhas.appendChild(botaoEscolha);
    });
    
    document.body.appendChild(containerEscolhas);
    return containerEscolhas;
}`,
            type: "interface",
            color: "#ffd1dc",
            parameters: [
                { name: "opcoes", type: "array", default: "[{texto: 'Op√ß√£o 1'}, {texto: 'Op√ß√£o 2'}]" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "Cutucar_",
            description: "A√ß√£o de cutucar/interagir",
            code: `function Cutucar_(alvo, callback) {
    // A√ß√£o de cutucar/interagir com algo
    console.log("Cutucando: " + alvo);
    
    // Efeito visual
    const elemento = document.querySelector(alvo);
    if (elemento) {
        elemento.style.transform = 'scale(0.95)';
        elemento.style.transition = 'transform 0.1s';
        
        setTimeout(() => {
            elemento.style.transform = 'scale(1)';
        }, 100);
        
        // Efeito sonoro (simulado)
        console.log("Som de cutucar tocado");
    }
    
    if (callback) callback(alvo);
    return alvo;
}`,
            type: "acao",
            color: "#b5e7a0",
            parameters: [
                { name: "alvo", type: "string", default: "'.personagem'" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "botao_de_acao",
            description: "Bot√£o para a√ß√µes espec√≠ficas",
            code: `function botao_de_acao(acao, texto, posicao) {
    // Cria bot√£o para a√ß√µes espec√≠ficas
    console.log("Criando bot√£o de a√ß√£o: " + acao);
    
    const botao = document.createElement('button');
    botao.className = 'botao-acao-' + acao;
    botao.textContent = texto || acao;
    
    // Posi√ß√µes pr√©-definidas
    const posicoes = {
        canto_inferior_direito: \`
            position: fixed;
            bottom: 20px;
            right: 20px;
        \`,
        canto_superior_esquerdo: \`
            position: fixed;
            top: 20px;
            left: 20px;
        \`,
        centro: \`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        \`
    };
    
    botao.style.cssText = \`
        \${posicoes[posicao] || posicoes.canto_inferior_direito}
        padding: 15px 25px;
        font-size: 16px;
        background-color: #FF5722;
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        z-index: 1000;
    \`;
    
    // A√ß√µes espec√≠ficas
    botao.addEventListener('click', function() {
        switch(acao) {
            case 'atacar':
                console.log("Ataque realizado!");
                // L√≥gica de ataque
                break;
            case 'defender':
                console.log("Defesa ativada!");
                // L√≥gica de defesa
                break;
            case 'interagir':
                console.log("Intera√ß√£o realizada!");
                // L√≥gica de intera√ß√£o
                break;
            case 'inventario':
                console.log("Invent√°rio aberto!");
                // Abrir invent√°rio
                break;
            default:
                console.log("A√ß√£o: " + acao);
        }
    });
    
    document.body.appendChild(botao);
    return botao;
}`,
            type: "acao",
            color: "#b5e7a0",
            parameters: [
                { name: "acao", type: "string", default: "'interagir'" },
                { name: "texto", type: "string", default: "null" },
                { name: "posicao", type: "string", default: "'canto_inferior_direito'" }
            ]
        },
        {
            name: "Caminhar_",
            description: "Mudar de cen√°rio",
            code: `function Caminhar_(novoCenario, transicao) {
    // Muda para um novo cen√°rio
    console.log("Caminhando para: " + novoCenario);
    
    const transicoes = {
        fade: 'fadeOut 0.5s ease',
        slide: 'slideOut 0.5s ease',
        instant: 'none'
    };
    
    // Aplicar transi√ß√£o de sa√≠da
    const cenaAtual = document.getElementById('cena-atual');
    if (cenaAtual) {
        cenaAtual.style.animation = transicoes[transicao] || transicoes.fade;
        
        setTimeout(() => {
            // Remover cena atual
            if (cenaAtual.parentNode) {
                cenaAtual.parentNode.removeChild(cenaAtual);
            }
            
            // Carregar novo cen√°rio
            carregarCenario(novoCenario);
            
        }, 500);
    } else {
        // Se n√£o houver cena atual, apenas carrega a nova
        carregarCenario(novoCenario);
    }
    
    function carregarCenario(nomeCenario) {
        const novaCena = document.createElement('div');
        novaCena.id = 'cena-atual';
        novaCena.className = 'cena-' + nomeCenario;
        novaCena.style.cssText = \`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
            z-index: 1;
            animation: fadeIn 0.5s ease;
        \`;
        
        const tituloCena = document.createElement('h2');
        tituloCena.textContent = "Cen√°rio: " + nomeCenario;
        tituloCena.style.cssText = \`
            position: absolute;
            top: 20px;
            left: 20px;
            color: #333;
            font-family: Arial, sans-serif;
        \`;
        
        novaCena.appendChild(tituloCena);
        document.body.appendChild(novaCena);
        
        console.log("Cen√°rio carregado: " + nomeCenario);
    }
    
    return novoCenario;
}

// Definir anima√ß√µes CSS
const style = document.createElement('style');
style.textContent = \`
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideOut {
        from { transform: translateX(0); }
        to { transform: translateX(-100%); }
    }
\`;
document.head.appendChild(style);`,
            type: "acao",
            color: "#b5e7a0",
            parameters: [
                { name: "novoCenario", type: "string", default: "'floresta'" },
                { name: "transicao", type: "string", default: "'fade'" }
            ]
        }
    ],

    // Comando 4: Navega√ß√£o e Efeitos
    navegacao: [
        {
            name: "ir_para",
            description: "Ir para uma cena espec√≠fica",
            code: `function ir_para(cena, dados) {
    // Navega para uma cena espec√≠fica
    console.log("Indo para cena: " + cena);
    
    // Salvar dados atuais se necess√°rio
    if (dados && dados.salvar) {
        const estadoAtual = {
            cenaAtual: getCenaAtual(),
            tempo: Date.now(),
            progresso: getProgresso()
        };
        localStorage.setItem('estado_temporario', JSON.stringify(estadoAtual));
    }
    
    // Redirecionar para a cena
    // Na implementa√ß√£o real, isso carregaria a cena
    console.log("Cena carregada: " + cena);
    
    // Simular carregamento
    setTimeout(() => {
        console.log("Navega√ß√£o conclu√≠da para: " + cena);
        if (dados && dados.callback) {
            dados.callback(cena);
        }
    }, 1000);
    
    return cena;
}`,
            type: "navegacao",
            color: "#8a2be2",
            parameters: [
                { name: "cena", type: "string", default: "'menu_principal'" },
                { name: "dados", type: "object", default: "{}" }
            ]
        },
        {
            name: "Salvar_aqui_",
            description: "Salvar progresso no ponto atual",
            code: `function Salvar_aqui_(nomeSave, dadosExtras) {
    // Salva o progresso no ponto atual
    console.log("Salvando progresso como: " + nomeSave);
    
    const saveData = {
        nome: nomeSave,
        timestamp: Date.now(),
        cenaAtual: getCenaAtual(),
        inventario: getInventario(),
        variaveis: getVariaveis(),
        dadosExtras: dadosExtras || {}
    };
    
    // Salvar no localStorage
    try {
        localStorage.setItem('save_' + nomeSave, JSON.stringify(saveData));
        console.log("Progresso salvo com sucesso!");
        
        // Feedback visual
        mostrarFeedback("Progresso salvo: " + nomeSave, "success");
        
        return saveData;
    } catch (error) {
        console.error("Erro ao salvar:", error);
        mostrarFeedback("Erro ao salvar!", "error");
        return null;
    }
    
    function mostrarFeedback(mensagem, tipo) {
        const feedback = document.createElement('div');
        feedback.textContent = mensagem;
        feedback.style.cssText = \`
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: \${tipo === 'success' ? '#4CAF50' : '#F44336'};
            color: white;
            border-radius: 5px;
            z-index: 10000;
            animation: slideInRight 0.3s ease, fadeOut 3s ease 2.7s;
        \`;
        
        document.body.appendChild(feedback);
        
        // Remover ap√≥s anima√ß√£o
        setTimeout(() => {
            if (feedback.parentNode) {
                feedback.parentNode.removeChild(feedback);
            }
        }, 3000);
    }
}`,
            type: "navegacao",
            color: "#8a2be2",
            parameters: [
                { name: "nomeSave", type: "string", default: "'save_1'" },
                { name: "dadosExtras", type: "object", default: "{}" }
            ]
        },
        {
            name: "onde_parei_",
            description: "Ir para parte espec√≠fica salva",
            code: `function onde_parei_(nomeSave) {
    // Carrega um save espec√≠fico
    console.log("Carregando save: " + nomeSave);
    
    const saveKey = nomeSave.startsWith('save_') ? nomeSave : 'save_' + nomeSave;
    const saveData = localStorage.getItem(saveKey);
    
    if (!saveData) {
        console.error("Save n√£o encontrado: " + nomeSave);
        mostrarFeedback("Save n√£o encontrado!", "error");
        return null;
    }
    
    try {
        const dados = JSON.parse(saveData);
        console.log("Save carregado:", dados);
        
        // Restaurar estado do jogo
        restaurarEstado(dados);
        
        mostrarFeedback("Save carregado: " + dados.nome, "success");
        return dados;
    } catch (error) {
        console.error("Erro ao carregar save:", error);
        mostrarFeedback("Erro ao carregar save!", "error");
        return null;
    }
    
    function mostrarFeedback(mensagem, tipo) {
        // Fun√ß√£o de feedback (mesma da anterior)
        const feedback = document.createElement('div');
        feedback.textContent = mensagem;
        feedback.style.cssText = \`
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: \${tipo === 'success' ? '#4CAF50' : '#F44336'};
            color: white;
            border-radius: 5px;
            z-index: 10000;
            animation: slideInRight 0.3s ease, fadeOut 3s ease 2.7s;
        \`;
        
        document.body.appendChild(feedback);
        
        setTimeout(() => {
            if (feedback.parentNode) {
                feedback.parentNode.removeChild(feedback);
            }
        }, 3000);
    }
}`,
            type: "navegacao",
            color: "#8a2be2",
            parameters: [
                { name: "nomeSave", type: "string", default: "'save_1'" }
            ]
        },
        {
            name: "escolhe_ai_",
            description: "Sistema de escolha m√∫ltipla",
            code: `function escolhe_ai_(pergunta, opcoes, callback) {
    // Sistema avan√ßado de escolhas
    console.log("Pergunta: " + pergunta);
    
    const modal = document.createElement('div');
    modal.id = 'modal-escolhas';
    modal.style.cssText = \`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    \`;
    
    const content = document.createElement('div');
    content.style.cssText = \`
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    \`;
    
    const titulo = document.createElement('h2');
    titulo.textContent = pergunta;
    titulo.style.cssText = \`
        margin-bottom: 20px;
        color: #333;
        text-align: center;
    \`;
    
    const containerOpcoes = document.createElement('div');
    containerOpcoes.style.cssText = \`
        display: flex;
        flex-direction: column;
        gap: 10px;
    \`;
    
    opcoes.forEach((opcao, index) => {
        const botaoOpcao = document.createElement('button');
        botaoOpcao.textContent = opcao.texto;
        botaoOpcao.dataset.valor = opcao.valor || index;
        botaoOpcao.style.cssText = \`
            padding: 15px;
            background-color: \${opcao.cor || '#6200EA'};
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        \`;
        
        botaoOpcao.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        });
        
        botaoOpcao.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'none';
        });
        
        botaoOpcao.addEventListener('click', function() {
            const valorSelecionado = this.dataset.valor;
            const opcaoSelecionada = opcoes.find(o => 
                (o.valor || opcoes.indexOf(o).toString()) === valorSelecionado
            );
            
            console.log("Escolha selecionada:", opcaoSelecionada);
            
            if (callback) callback(opcaoSelecionada);
            
            // Fechar modal
            document.body.removeChild(modal);
        });
        
        containerOpcoes.appendChild(botaoOpcao);
    });
    
    content.appendChild(titulo);
    content.appendChild(containerOpcoes);
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    return modal;
}`,
            type: "navegacao",
            color: "#8a2be2",
            parameters: [
                { name: "pergunta", type: "string", default: "'O que voc√™ quer fazer?'" },
                { name: "opcoes", type: "array", default: "[{texto: 'Op√ß√£o 1', valor: 1}, {texto: 'Op√ß√£o 2', valor: 2}]" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "Acabou_ai_",
            description: "Finalizar cena/jogo",
            code: `function Acabou_ai_(tipo, dados) {
    // Finaliza a cena ou o jogo
    console.log("Finalizando: " + tipo);
    
    switch(tipo) {
        case 'cena':
            // Finalizar cena atual
            finalizarCena(dados);
            break;
        case 'jogo':
            // Finalizar jogo
            finalizarJogo(dados);
            break;
        case 'capitulo':
            // Finalizar cap√≠tulo
            finalizarCapitulo(dados);
            break;
        default:
            console.log("Finaliza√ß√£o padr√£o");
    }
    
    function finalizarCena(dados) {
        // Efeitos de transi√ß√£o
        const cenaAtual = document.getElementById('cena-atual');
        if (cenaAtual) {
            cenaAtual.style.animation = 'fadeOut 1s ease';
            
            setTimeout(() => {
                if (dados && dados.proximaCena) {
                    console.log("Indo para pr√≥xima cena: " + dados.proximaCena);
                    // Carregar pr√≥xima cena
                } else {
                    console.log("Cena finalizada");
                }
            }, 1000);
        }
    }
    
    function finalizarJogo(dados) {
        // Tela de fim de jogo
        const telaFim = document.createElement('div');
        telaFim.id = 'tela-fim-jogo';
        telaFim.style.cssText = \`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 1s ease;
        \`;
        
        const titulo = document.createElement('h1');
        titulo.textContent = dados && dados.titulo ? dados.titulo : "Fim do Jogo";
        titulo.style.cssText = \`
            font-size: 48px;
            margin-bottom: 30px;
            color: #FFD700;
        \`;
        
        const mensagem = document.createElement('p');
        mensagem.textContent = dados && dados.mensagem ? dados.mensagem : "Obrigado por jogar!";
        mensagem.style.cssText = \`
            font-size: 24px;
            margin-bottom: 50px;
            text-align: center;
            max-width: 600px;
            line-height: 1.5;
        \`;
        
        const botaoVoltar = document.createElement('button');
        botaoVoltar.textContent = "Voltar ao Menu Principal";
        botaoVoltar.style.cssText = \`
            padding: 15px 30px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        \`;
        
        botaoVoltar.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#388E3C';
        });
        
        botaoVoltar.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#4CAF50';
        });
        
        botaoVoltar.addEventListener('click', function() {
            console.log("Voltando ao menu principal...");
            // L√≥gica para voltar ao menu
        });
        
        telaFim.appendChild(titulo);
        telaFim.appendChild(mensagem);
        telaFim.appendChild(botaoVoltar);
        document.body.appendChild(telaFim);
    }
    
    function finalizarCapitulo(dados) {
        console.log("Cap√≠tulo finalizado: " + (dados && dados.numero ? dados.numero : "Desconhecido"));
        // L√≥gica espec√≠fica para finalizar cap√≠tulo
    }
    
    return tipo;
}`,
            type: "navegacao",
            color: "#8a2be2",
            parameters: [
                { name: "tipo", type: "string", default: "'cena'" },
                { name: "dados", type: "object", default: "{}" }
            ]
        },
        {
            name: "solta_o_som_",
            description: "Reproduzir efeito sonoro",
            code: `function solta_o_som_(nomeSom, volume, loop) {
    // Reproduz um efeito sonoro
    console.log("Tocando som: " + nomeSom);
    
    // Simula√ß√£o - na implementa√ß√£o real usaria Audio API
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    // Sons pr√©-definidos
    const sons = {
        clique: 800,
        erro: 400,
        sucesso: 1000,
        transicao: 600,
        magia: 1200
    };
    
    const frequencia = sons[nomeSom] || 440; // 440Hz = L√°
    
    // Criar oscilador
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    // Configurar som
    oscillator.frequency.value = frequencia;
    oscillator.type = 'sine';
    
    gainNode.gain.value = volume || 0.1;
    
    // Configurar envelope
    const now = audioContext.currentTime;
    gainNode.gain.setValueAtTime(0, now);
    gainNode.gain.linearRampToValueAtTime(volume || 0.1, now + 0.01);
    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
    
    // Tocar
    oscillator.start(now);
    oscillator.stop(now + 0.5);
    
    // Se for loop, recriar o som
    if (loop) {
        setInterval(() => {
            solta_o_som_(nomeSom, volume, false);
        }, 500);
    }
    
    return { nome: nomeSom, frequencia: frequencia };
}`,
            type: "efeito",
            color: "#9C27B0",
            parameters: [
                { name: "nomeSom", type: "string", default: "'clique'" },
                { name: "volume", type: "number", default: "0.1" },
                { name: "loop", type: "boolean", default: "false" }
            ]
        },
        {
            name: "barulho_",
            description: "Efeito sonoro aleat√≥rio/ambiente",
            code: `function barulho_(tipo, intensidade) {
    // Cria efeitos sonoros ambientais
    console.log("Criando barulho: " + tipo + " (intensidade: " + intensidade + ")");
    
    // Tipos de barulho
    const barulhos = {
        floresta: ['vento', 'passaros', 'insetos', 'folhas'],
        cidade: ['carros', 'gente', 'sirenes', 'construcao'],
        casa: ['relogio', 'vento', 'passos', 'porta'],
        fantasia: ['magia', 'espadas', 'drag√£o', 'elfos']
    };
    
    const sonsTipo = barulhos[tipo] || barulhos.floresta;
    const somAleatorio = sonsTipo[Math.floor(Math.random() * sonsTipo.length)];
    
    // Criar elemento visual para o som
    const indicadorSom = document.createElement('div');
    indicadorSom.className = 'indicador-som';
    indicadorSom.textContent = "üîä " + somAleatorio;
    indicadorSom.style.cssText = \`
        position: fixed;
        bottom: 10px;
        left: 10px;
        padding: 5px 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border-radius: 3px;
        font-size: 12px;
        opacity: \${intensidade || 0.5};
        z-index: 1000;
        animation: fadeInOut 3s ease;
    \`;
    
    // Adicionar e remover ap√≥s anima√ß√£o
    document.body.appendChild(indicadorSom);
    
    setTimeout(() => {
        if (indicadorSom.parentNode) {
            indicadorSom.parentNode.removeChild(indicadorSom);
        }
    }, 3000);
    
    return { tipo: tipo, som: somAleatorio, intensidade: intensidade };
}

// Adicionar anima√ß√£o CSS
if (!document.querySelector('#animacao-som')) {
    const style = document.createElement('style');
    style.id = 'animacao-som';
    style.textContent = \`
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
    \`;
    document.head.appendChild(style);
}`,
            type: "efeito",
            color: "#9C27B0",
            parameters: [
                { name: "tipo", type: "string", default: "'floresta'" },
                { name: "intensidade", type: "number", default: "0.5" }
            ]
        },
        {
            name: "mudar_mood_",
            description: "Mudar o clima/atmosfera da cena",
            code: `function mudar_mood_(mood, duracao) {
    // Muda o clima/atmosfera da cena
    console.log("Mudando mood para: " + mood);
    
    // Configura√ß√µes de mood
    const moods = {
        feliz: {
            cor: '#FFEB3B',
            brilho: 'brightness(1.2)',
            satura√ß√£o: 'saturate(1.3)'
        },
        triste: {
            cor: '#2196F3',
            brilho: 'brightness(0.8)',
            satura√ß√£o: 'saturate(0.7)',
            blur: 'blur(1px)'
        },
        tenso: {
            cor: '#F44336',
            brilho: 'brightness(1.1)',
            contraste: 'contrast(1.3)',
            tremor: '0.5px'
        },
        calmo: {
            cor: '#4CAF50',
            brilho: 'brightness(0.9)',
            satura√ß√£o: 'saturate(0.9)',
            blur: 'blur(0.5px)'
        },
        misterioso: {
            cor: '#9C27B0',
            brilho: 'brightness(0.7)',
            contraste: 'contrast(1.5)'
        }
    };
    
    const config = moods[mood] || moods.calmo;
    
    // Criar overlay para o mood
    let overlay = document.getElementById('mood-overlay');
    
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'mood-overlay';
        overlay.style.cssText = \`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: overlay;
            transition: all 1s ease;
        \`;
        document.body.appendChild(overlay);
    }
    
    // Aplicar efeitos
    overlay.style.backgroundColor = config.cor;
    overlay.style.opacity = '0.3';
    
    // Aplicar filtros ao corpo
    let filtros = '';
    if (config.brilho) filtros += config.brilho + ' ';
    if (config.satura√ß√£o) filtros += config.satura√ß√£o + ' ';
    if (config.contraste) filtros += config.contraste + ' ';
    if (config.blur) filtros += config.blur + ' ';
    
    document.body.style.filter = filtros || 'none';
    
    // Efeito de tremor (para mood tenso)
    if (config.tremor) {
        let tremorAtivo = true;
        const intervalo = setInterval(() => {
            if (tremorAtivo) {
                document.body.style.transform = \`translateX(\${config.tremor})\`;
            } else {
                document.body.style.transform = \`translateX(-\${config.tremor})\`;
            }
            tremorAtivo = !tremorAtivo;
        }, 50);
        
        // Parar tremor ap√≥s dura√ß√£o
        if (duracao) {
            setTimeout(() => {
                clearInterval(intervalo);
                document.body.style.transform = 'translateX(0)';
            }, duracao);
        }
    }
    
    // Remover ap√≥s dura√ß√£o (se especificada)
    if (duracao) {
        setTimeout(() => {
            document.body.style.filter = 'none';
            document.body.style.transform = 'translateX(0)';
            if (overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
        }, duracao);
    }
    
    return { mood: mood, config: config, duracao: duracao };
}`,
            type: "efeito",
            color: "#9C27B0",
            parameters: [
                { name: "mood", type: "string", default: "'calmo'" },
                { name: "duracao", type: "number", default: "null" }
            ]
        }
    ],

    // Mini Game: Fazendinha
    minigame: [
        {
            name: "plantar_",
            description: "Plantar semente na fazendinha",
            code: `function plantar_(tipoSemente, quantidade, local) {
    // Plantar sementes no minigame da fazendinha
    console.log("Plantando " + quantidade + " sementes de " + tipoSemente + " em " + local);
    
    const sementes = {
        trigo: { tempo: 30000, rendimento: 2, experiencia: 10 },
        milho: { tempo: 45000, rendimento: 3, experiencia: 15 },
        batata: { tempo: 60000, rendimento: 4, experiencia: 20 },
        cenoura: { tempo: 75000, rendimento: 5, experiencia: 25 },
        flor: { tempo: 90000, rendimento: 1, experiencia: 30 }
    };
    
    const semente = sementes[tipoSemente] || sementes.trigo;
    
    // Verificar se tem sementes suficientes
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    if (!inventario.sementes || inventario.sementes[tipoSemente] < quantidade) {
        console.error("Sementes insuficientes!");
        return null;
    }
    
    // Deduzir sementes do invent√°rio
    inventario.sementes[tipoSemente] -= quantidade;
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Criar planta√ß√£o
    const plantacao = {
        id: Date.now(),
        tipo: tipoSemente,
        quantidade: quantidade,
        local: local || 'campo_1',
        plantadoEm: Date.now(),
        tempoCrescimento: semente.tempo,
        pronto: false
    };
    
    // Salvar planta√ß√£o
    const plantacoes = JSON.parse(localStorage.getItem('plantacoes_ativas') || '[]');
    plantacoes.push(plantacao);
    localStorage.setItem('plantacoes_ativas', JSON.stringify(plantacoes));
    
    // Feedback visual
    mostrarFeedback("Plantado: " + quantidade + "x " + tipoSemente, "success");
    
    // Iniciar contador de crescimento
    setTimeout(() => {
        plantacao.pronto = true;
        localStorage.setItem('plantacoes_ativas', JSON.stringify(plantacoes));
        mostrarFeedback("Planta√ß√£o de " + tipoSemente + " est√° pronta para colheita!", "info");
    }, semente.tempo);
    
    return plantacao;
}`,
            type: "minigame",
            color: "#4CAF50",
            parameters: [
                { name: "tipoSemente", type: "string", default: "'trigo'" },
                { name: "quantidade", type: "number", default: "1" },
                { name: "local", type: "string", default: "'campo_1'" }
            ]
        },
        {
            name: "regar_",
            description: "Regar planta√ß√µes",
            code: `function regar_(idPlantacao, usarFertilizante) {
    // Regar uma planta√ß√£o espec√≠fica
    console.log("Regando planta√ß√£o ID: " + idPlantacao);
    
    const plantacoes = JSON.parse(localStorage.getItem('plantacoes_ativas') || '[]');
    const plantacao = plantacoes.find(p => p.id == idPlantacao);
    
    if (!plantacao) {
        console.error("Planta√ß√£o n√£o encontrada!");
        return null;
    }
    
    // Verificar se j√° foi regada recentemente
    if (plantacao.regada && Date.now() - plantacao.regada < 3600000) { // 1 hora
        console.log("Planta√ß√£o j√° foi regada recentemente");
        return plantacao;
    }
    
    // Registrar rega
    plantacao.regada = Date.now();
    
    // Efeito do fertilizante
    if (usarFertilizante) {
        const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
        if (inventario.fertilizante && inventario.fertilizante > 0) {
            inventario.fertilizante--;
            plantacao.tempoCrescimento *= 0.7; // Reduz tempo em 30%
            plantacao.rendimento = plantacao.rendimento ? plantacao.rendimento * 1.5 : 1.5;
            localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
            console.log("Fertilizante aplicado!");
        }
    }
    
    // Salvar altera√ß√µes
    localStorage.setItem('plantacoes_ativas', JSON.stringify(plantacoes));
    
    // Feedback visual
    mostrarFeedback("Planta√ß√£o regada" + (usarFertilizante ? " com fertilizante" : ""), "success");
    
    return plantacao;
}`,
            type: "minigame",
            color: "#4CAF50",
            parameters: [
                { name: "idPlantacao", type: "number", default: "null" },
                { name: "usarFertilizante", type: "boolean", default: "false" }
            ]
        },
        {
            name: "tempo_",
            description: "Controlar tempo no minigame",
            code: `function tempo_(acao, parametro) {
    // Controlar o tempo no minigame da fazendinha
    console.log("Controlando tempo: " + acao);
    
    switch(acao) {
        case 'acelerar':
            // Acelerar o tempo das planta√ß√µes
            const aceleracao = parametro || 2;
            console.log("Acelerando tempo em " + aceleracao + "x");
            
            const plantacoes = JSON.parse(localStorage.getItem('plantacoes_ativas') || '[]');
            plantacoes.forEach(plantacao => {
                if (!plantacao.pronto) {
                    const tempoDecorrido = Date.now() - plantacao.plantadoEm;
                    const tempoRestante = plantacao.tempoCrescimento - tempoDecorrido;
                    plantacao.tempoCrescimento = tempoDecorrido + (tempoRestante / aceleracao);
                }
            });
            
            localStorage.setItem('plantacoes_ativas', JSON.stringify(plantacoes));
            mostrarFeedback("Tempo acelerado " + aceleracao + "x", "info");
            break;
            
        case 'pausar':
            // Pausar o tempo
            console.log("Tempo pausado");
            localStorage.setItem('tempo_pausado', 'true');
            mostrarFeedback("Tempo pausado", "warning");
            break;
            
        case 'continuar':
            // Continuar o tempo
            console.log("Tempo continuado");
            localStorage.removeItem('tempo_pausado');
            mostrarFeedback("Tempo continuado", "info");
            break;
            
        case 'verificar':
            // Verificar tempo restante
            const plantacoesAtivas = JSON.parse(localStorage.getItem('plantacoes_ativas') || '[]');
            const tempos = plantacoesAtivas.map(p => {
                if (p.pronto) {
                    return { id: p.id, status: "Pronto para colheita" };
                } else {
                    const tempoRestante = p.tempoCrescimento - (Date.now() - p.plantadoEm);
                    const minutos = Math.floor(tempoRestante / 60000);
                    const segundos = Math.floor((tempoRestante % 60000) / 1000);
                    return { 
                        id: p.id, 
                        status: minutos + "m " + segundos + "s restantes" 
                    };
                }
            });
            
            console.log("Tempos:", tempos);
            return tempos;
    }
    
    return acao;
}`,
            type: "minigame",
            color: "#4CAF50",
            parameters: [
                { name: "acao", type: "string", default: "'verificar'" },
                { name: "parametro", type: "mixed", default: "null" }
            ]
        },
        {
            name: "colheita_",
            description: "Colher planta√ß√µes prontas",
            code: `function colheita_(idPlantacao) {
    // Colher uma planta√ß√£o pronta
    console.log("Colhendo planta√ß√£o ID: " + idPlantacao);
    
    const plantacoes = JSON.parse(localStorage.getItem('plantacoes_ativas') || '[]');
    const plantacaoIndex = plantacoes.findIndex(p => p.id == idPlantacao);
    
    if (plantacaoIndex === -1) {
        console.error("Planta√ß√£o n√£o encontrada!");
        return null;
    }
    
    const plantacao = plantacoes[plantacaoIndex];
    
    // Verificar se est√° pronta
    if (!plantacao.pronto) {
        const tempoRestante = plantacao.tempoCrescimento - (Date.now() - plantacao.plantadoEm);
        if (tempoRestante > 0) {
            console.error("Planta√ß√£o ainda n√£o est√° pronta!");
            mostrarFeedback("Ainda n√£o est√° pronta!", "warning");
            return plantacao;
        } else {
            plantacao.pronto = true;
        }
    }
    
    // Calcular rendimento
    const sementes = {
        trigo: { produto: "trigo", base: 2 },
        milho: { produto: "milho", base: 3 },
        batata: { produto: "batata", base: 4 },
        cenoura: { produto: "cenoura", base: 5 },
        flor: { produto: "flor", base: 1 }
    };
    
    const semente = sementes[plantacao.tipo] || sementes.trigo;
    let rendimento = semente.base * plantacao.quantidade;
    
    // B√¥nus por rega
    if (plantacao.regada) {
        rendimento = Math.floor(rendimento * 1.2);
    }
    
    // Adicionar ao invent√°rio
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    if (!inventario.produtos) inventario.produtos = {};
    if (!inventario.produtos[semente.produto]) inventario.produtos[semente.produto] = 0;
    
    inventario.produtos[semente.produto] += rendimento;
    
    // Adicionar experi√™ncia
    if (!inventario.experiencia) inventario.experiencia = 0;
    inventario.experiencia += (10 * plantacao.quantidade);
    
    // Salvar invent√°rio
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Remover planta√ß√£o
    plantacoes.splice(plantacaoIndex, 1);
    localStorage.setItem('plantacoes_ativas', JSON.stringify(plantacoes));
    
    // Feedback
    mostrarFeedback("Colhido: " + rendimento + "x " + semente.produto + " (+" + (10 * plantacao.quantidade) + " XP)", "success");
    
    return {
        produto: semente.produto,
        quantidade: rendimento,
        experiencia: 10 * plantacao.quantidade,
        inventarioAtual: inventario
    };
}`,
            type: "minigame",
            color: "#4CAF50",
            parameters: [
                { name: "idPlantacao", type: "number", default: "null" }
            ]
        },
        {
            name: "semente_",
            description: "Adquirir ou usar sementes",
            code: `function semente_(acao, tipo, quantidade) {
    // Gerenciar sementes no minigame
    console.log("Gerenciando sementes: " + acao + " " + quantidade + "x " + tipo);
    
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    if (!inventario.sementes) inventario.sementes = {};
    
    switch(acao) {
        case 'comprar':
            // Comprar sementes
            const precoSementes = {
                trigo: 10,
                milho: 20,
                batata: 30,
                cenoura: 40,
                flor: 50
            };
            
            const preco = precoSementes[tipo] * quantidade;
            
            // Verificar moedas
            if (!inventario.moedas || inventario.moedas < preco) {
                console.error("Moedas insuficientes!");
                mostrarFeedback("Moedas insuficientes!", "error");
                return null;
            }
            
            // Deduzir moedas e adicionar sementes
            inventario.moedas -= preco;
            if (!inventario.sementes[tipo]) inventario.sementes[tipo] = 0;
            inventario.sementes[tipo] += quantidade;
            
            mostrarFeedback("Comprado: " + quantidade + "x sementes de " + tipo, "success");
            break;
            
        case 'usar':
            // Usar sementes (j√° tratado na fun√ß√£o plantar)
            if (!inventario.sementes[tipo] || inventario.sementes[tipo] < quantidade) {
                console.error("Sementes insuficientes!");
                mostrarFeedback("Sementes insuficientes!", "error");
                return null;
            }
            break;
            
        case 'ver':
            // Ver quantidade de sementes
            return inventario.sementes[tipo] || 0;
            
        case 'adicionar':
            // Adicionar sementes (para debug/testes)
            if (!inventario.sementes[tipo]) inventario.sementes[tipo] = 0;
            inventario.sementes[tipo] += quantidade;
            console.log("Sementes adicionadas: " + tipo + " +" + quantidade);
            break;
    }
    
    // Salvar invent√°rio
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    return inventario.sementes[tipo] || 0;
}`,
            type: "minigame",
            color: "#4CAF50",
            parameters: [
                { name: "acao", type: "string", default: "'ver'" },
                { name: "tipo", type: "string", default: "'trigo'" },
                { name: "quantidade", type: "number", default: "1" }
            ]
        },
        {
            name: "adicionar_moedas",
            description: "Adicionar moedas ao invent√°rio",
            code: `function adicionar_moedas(quantidade, motivo) {
    // Adicionar moedas ao invent√°rio da fazendinha
    console.log("Adicionando " + quantidade + " moedas. Motivo: " + (motivo || "sem motivo"));
    
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    if (!inventario.moedas) inventario.moedas = 0;
    
    inventario.moedas += quantidade;
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Feedback visual
    mostrarFeedback("+" + quantidade + " moedas", "success");
    
    // Log de transa√ß√£o
    const transacoes = JSON.parse(localStorage.getItem('transacoes_fazenda') || '[]');
    transacoes.push({
        tipo: 'entrada',
        quantidade: quantidade,
        motivo: motivo || 'adicionado',
        timestamp: Date.now()
    });
    localStorage.setItem('transacoes_fazenda', JSON.stringify(transacoes));
    
    return inventario.moedas;
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "quantidade", type: "number", default: "100" },
                { name: "motivo", type: "string", default: "'recompensa'" }
            ]
        },
        {
            name: "subtrair_moedas",
            description: "Subtrair moedas do invent√°rio",
            code: `function subtrair_moedas(quantidade, motivo) {
    // Subtrair moedas do invent√°rio da fazendinha
    console.log("Subtraindo " + quantidade + " moedas. Motivo: " + (motivo || "sem motivo"));
    
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    if (!inventario.moedas) inventario.moedas = 0;
    
    // Verificar se tem moedas suficientes
    if (inventario.moedas < quantidade) {
        console.error("Moedas insuficientes!");
        mostrarFeedback("Moedas insuficientes!", "error");
        return inventario.moedas;
    }
    
    inventario.moedas -= quantidade;
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Feedback visual
    mostrarFeedback("-" + quantidade + " moedas", "warning");
    
    // Log de transa√ß√£o
    const transacoes = JSON.parse(localStorage.getItem('transacoes_fazenda') || '[]');
    transacoes.push({
        tipo: 'saida',
        quantidade: quantidade,
        motivo: motivo || 'gasto',
        timestamp: Date.now()
    });
    localStorage.setItem('transacoes_fazenda', JSON.stringify(transacoes));
    
    return inventario.moedas;
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "quantidade", type: "number", default: "50" },
                { name: "motivo", type: "string", default: "'compra'" }
            ]
        },
        {
            name: "adicionar_item",
            description: "Adicionar item ao invent√°rio",
            code: `function adicionar_item(item, quantidade, qualidade) {
    // Adicionar item ao invent√°rio da fazendinha
    console.log("Adicionando " + quantidade + "x " + item + " (qualidade: " + (qualidade || "normal") + ")");
    
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    
    // Inicializar estrutura do invent√°rio se necess√°rio
    if (!inventario.itens) inventario.itens = {};
    if (!inventario.itens[item]) inventario.itens[item] = { quantidade: 0, qualidade: [] };
    
    // Adicionar quantidade
    inventario.itens[item].quantidade += quantidade;
    
    // Adicionar qualidade
    for (let i = 0; i < quantidade; i++) {
        inventario.itens[item].qualidade.push(qualidade || "normal");
    }
    
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Feedback
    mostrarFeedback("Adicionado: " + quantidade + "x " + item, "success");
    
    return inventario.itens[item];
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "item", type: "string", default: "'fertilizante'" },
                { name: "quantidade", type: "number", default: "1" },
                { name: "qualidade", type: "string", default: "'normal'" }
            ]
        },
        {
            name: "remover_item",
            description: "Remover item do invent√°rio",
            code: `function remover_item(item, quantidade) {
    // Remover item do invent√°rio da fazendinha
    console.log("Removendo " + quantidade + "x " + item);
    
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    
    // Verificar se o item existe e tem quantidade suficiente
    if (!inventario.itens || !inventario.itens[item] || inventario.itens[item].quantidade < quantidade) {
        console.error("Item insuficiente ou n√£o encontrado!");
        mostrarFeedback("Item insuficiente!", "error");
        return null;
    }
    
    // Remover quantidade
    inventario.itens[item].quantidade -= quantidade;
    
    // Remover qualidade correspondente (os mais antigos primeiro)
    inventario.itens[item].qualidade.splice(0, quantidade);
    
    // Se quantidade chegar a zero, remover item
    if (inventario.itens[item].quantidade <= 0) {
        delete inventario.itens[item];
    }
    
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Feedback
    mostrarFeedback("Removido: " + quantidade + "x " + item, "info");
    
    return inventario.itens[item] || null;
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "item", type: "string", default: "'fertilizante'" },
                { name: "quantidade", type: "number", default: "1" }
            ]
        },
        {
            name: "iniciar_minigame",
            description: "Iniciar minigame da fazendinha",
            code: `function iniciar_minigame(dificuldade, callback) {
    // Iniciar o minigame da fazendinha
    console.log("Iniciando minigame da fazendinha (dificuldade: " + dificuldade + ")");
    
    // Configura√ß√µes baseadas na dificuldade
    const config = {
        facil: { tempo: 60000, objetivo: 100, recursos: 500 },
        medio: { tempo: 45000, objetivo: 150, recursos: 300 },
        dificil: { tempo: 30000, objetivo: 200, recursos: 200 }
    };
    
    const configJogo = config[dificuldade] || config.medio;
    
    // Criar interface do minigame
    const interfaceMinigame = criarInterfaceMinigame(configJogo);
    
    // Iniciar timer
    let tempoRestante = configJogo.tempo;
    const timer = setInterval(() => {
        tempoRestante -= 1000;
        
        // Atualizar display do tempo
        const tempoDisplay = document.getElementById('tempo-minigame');
        if (tempoDisplay) {
            const minutos = Math.floor(tempoRestante / 60000);
            const segundos = Math.floor((tempoRestante % 60000) / 1000);
            tempoDisplay.textContent = \`\${minutos.toString().padStart(2, '0')}:\${segundos.toString().padStart(2, '0')}\`;
        }
        
        // Verificar fim do tempo
        if (tempoRestante <= 0) {
            clearInterval(timer);
            finalizarMinigame(false, "Tempo esgotado!");
        }
    }, 1000);
    
    // Fun√ß√£o para criar interface
    function criarInterfaceMinigame(config) {
        const container = document.createElement('div');
        container.id = 'minigame-fazenda';
        container.style.cssText = \`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #8BC34A;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        \`;
        
        // Cabe√ßalho
        const cabecalho = document.createElement('div');
        cabecalho.style.cssText = \`
            position: absolute;
            top: 20px;
            width: 90%;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 20px;
            font-weight: bold;
        \`;
        
        const tempo = document.createElement('div');
        tempo.id = 'tempo-minigame';
        tempo.textContent = "01:00";
        
        const objetivo = document.createElement('div');
        objetivo.textContent = "Objetivo: " + config.objetivo + " pontos";
        
        const recursos = document.createElement('div');
        recursos.id = 'recursos-minigame';
        recursos.textContent = "Recursos: " + config.recursos;
        
        cabecalho.appendChild(tempo);
        cabecalho.appendChild(objetivo);
        cabecalho.appendChild(recursos);
        
        // √Årea do jogo
        const areaJogo = document.createElement('div');
        areaJogo.id = 'area-jogo-fazenda';
        areaJogo.style.cssText = \`
            width: 80%;
            height: 60%;
            background-color: #689F38;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            padding: 20px;
        \`;
        
        // Criar campos
        for (let i = 1; i <= 12; i++) {
            const campo = document.createElement('div');
            campo.className = 'campo-fazenda';
            campo.dataset.id = i;
            campo.style.cssText = \`
                background-color: #558B2F;
                border-radius: 5px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: white;
            \`;
            campo.textContent = "üå±";
            
            campo.addEventListener('click', function() {
                // L√≥gica de clique no campo
                const acoes = ['plantar', 'regar', 'colher'];
                const acao = acoes[Math.floor(Math.random() * acoes.length)];
                
                switch(acao) {
                    case 'plantar':
                        this.textContent = "üå±";
                        this.style.backgroundColor = "#558B2F";
                        break;
                    case 'regar':
                        this.textContent = "üíß";
                        this.style.backgroundColor = "#0288D1";
                        break;
                    case 'colher':
                        this.textContent = "üåæ";
                        this.style.backgroundColor = "#FF9800";
                        
                        // Adicionar pontos
                        const pontosAtuais = parseInt(localStorage.getItem('pontos_minigame') || '0');
                        localStorage.setItem('pontos_minigame', (pontosAtuais + 10).toString());
                        
                        // Atualizar display
                        const pontosDisplay = document.getElementById('pontos-minigame');
                        if (pontosDisplay) {
                            pontosDisplay.textContent = "Pontos: " + (pontosAtuais + 10);
                        }
                        
                        // Verificar objetivo
                        if (pontosAtuais + 10 >= config.objetivo) {
                            finalizarMinigame(true, "Objetivo alcan√ßado!");
                        }
                        break;
                }
            });
            
            areaJogo.appendChild(campo);
        }
        
        // Controles
        const controles = document.createElement('div');
        controles.style.cssText = \`
            display: flex;
            gap: 20px;
            margin-top: 30px;
        \`;
        
        const botaoPlantar = document.createElement('button');
        botaoPlantar.textContent = "üå± Plantar";
        botaoPlantar.style.cssText = \`
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        \`;
        
        const botaoRegar = document.createElement('button');
        botaoRegar.textContent = "üíß Regar";
        botaoRegar.style.cssText = \`
            padding: 10px 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        \`;
        
        const botaoColher = document.createElement('button');
        botaoColher.textContent = "üåæ Colher";
        botaoColher.style.cssText = \`
            padding: 10px 20px;
            background-color: #FF9800;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        \`;
        
        const pontosDisplay = document.createElement('div');
        pontosDisplay.id = 'pontos-minigame';
        pontosDisplay.textContent = "Pontos: 0";
        pontosDisplay.style.cssText = \`
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-left: 20px;
        \`;
        
        controles.appendChild(botaoPlantar);
        controles.appendChild(botaoRegar);
        controles.appendChild(botaoColher);
        controles.appendChild(pontosDisplay);
        
        container.appendChild(cabecalho);
        container.appendChild(areaJogo);
        container.appendChild(controles);
        document.body.appendChild(container);
        
        return container;
    }
    
    // Fun√ß√£o para finalizar minigame
    function finalizarMinigame(sucesso, mensagem) {
        clearInterval(timer);
        
        const pontosFinais = parseInt(localStorage.getItem('pontos_minigame') || '0');
        
        // Remover interface
        const interfaceAtual = document.getElementById('minigame-fazenda');
        if (interfaceAtual) {
            document.body.removeChild(interfaceAtual);
        }
        
        // Mostrar resultados
        const resultado = document.createElement('div');
        resultado.id = 'resultado-minigame';
        resultado.style.cssText = \`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            color: white;
            text-align: center;
        \`;
        
        const titulo = document.createElement('h1');
        titulo.textContent = sucesso ? "üéâ Vit√≥ria!" : "üíÄ Fim de Jogo";
        titulo.style.cssText = \`
            font-size: 48px;
            margin-bottom: 20px;
            color: \${sucesso ? '#4CAF50' : '#F44336'};
        \`;
        
        const mensagemElem = document.createElement('p');
        mensagemElem.textContent = mensagem;
        mensagemElem.style.fontSize = '24px';
        
        const pontosElem = document.createElement('p');
        pontosElem.textContent = "Pontua√ß√£o final: " + pontosFinais;
        pontosElem.style.fontSize = '20px';
        pontosElem.style.margin = '10px 0';
        
        const recompensaElem = document.createElement('p');
        let recompensa = 0;
        
        if (sucesso) {
            recompensa = Math.floor(pontosFinais * 0.5);
            recompensaElem.textContent = "Recompensa: " + recompensa + " moedas";
            recompensaElem.style.color = '#FFD700';
            
            // Adicionar recompensa
            adicionar_moedas(recompensa, "recompensa_minigame");
        } else {
            recompensaElem.textContent = "Tente novamente!";
        }
        
        const botaoFechar = document.createElement('button');
        botaoFechar.textContent = "Fechar";
        botaoFechar.style.cssText = \`
            padding: 15px 30px;
            font-size: 18px;
            background-color: #9C27B0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 30px;
        \`;
        
        botaoFechar.addEventListener('click', function() {
            document.body.removeChild(resultado);
            if (callback) callback({ sucesso: sucesso, pontos: pontosFinais, recompensa: recompensa });
        });
        
        resultado.appendChild(titulo);
        resultado.appendChild(mensagemElem);
        resultado.appendChild(pontosElem);
        resultado.appendChild(recompensaElem);
        resultado.appendChild(botaoFechar);
        document.body.appendChild(resultado);
        
        // Limpar pontos
        localStorage.removeItem('pontos_minigame');
        
        return { sucesso: sucesso, pontos: pontosFinais, recompensa: recompensa };
    }
    
    // Limpar pontos anteriores
    localStorage.removeItem('pontos_minigame');
    
    return interfaceMinigame;
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "dificuldade", type: "string", default: "'medio'" },
                { name: "callback", type: "function", default: "null" }
            ]
        },
        {
            name: "fim_minigame",
            description: "Finalizar minigame manualmente",
            code: `function fim_minigame(forcarResultado) {
    // Finalizar minigame manualmente
    console.log("Finalizando minigame manualmente");
    
    // Remover interface do minigame
    const interfaceAtual = document.getElementById('minigame-fazenda');
    if (interfaceAtual) {
        document.body.removeChild(interfaceAtual);
    }
    
    // Remover resultado se existir
    const resultadoAtual = document.getElementById('resultado-minigame');
    if (resultadoAtual) {
        document.body.removeChild(resultadoAtual);
    }
    
    // Obter pontos atuais
    const pontosFinais = parseInt(localStorage.getItem('pontos_minigame') || '0');
    
    // Limpar pontos
    localStorage.removeItem('pontos_minigame');
    
    // Retornar resultado for√ßado ou atual
    if (forcarResultado !== undefined) {
        return { 
            sucesso: forcarResultado.sucesso || false, 
            pontos: forcarResultado.pontos || pontosFinais,
            mensagem: forcarResultado.mensagem || "Finalizado manualmente"
        };
    }
    
    return { sucesso: false, pontos: pontosFinais, mensagem: "Finalizado manualmente" };
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "forcarResultado", type: "object", default: "null" }
            ]
        },
        {
            name: "ganhar_recompensa",
            description: "Distribuir recompensas do minigame",
            code: `function ganhar_recompensa(tipoRecompensa, multiplicador) {
    // Distribuir recompensas por completar objetivos/minigames
    console.log("Distribuindo recompensa: " + tipoRecompensa);
    
    const recompensas = {
        diaria: { moedas: 50, experiencia: 20, itens: ['fertilizante'] },
        missao: { moedas: 100, experiencia: 50, itens: ['semente_rara'] },
        conquista: { moedas: 200, experiencia: 100, itens: ['fertilizante_especial'] },
        minigame_facil: { moedas: 50, experiencia: 30, itens: [] },
        minigame_medio: { moedas: 100, experiencia: 60, itens: ['fertilizante'] },
        minigame_dificil: { moedas: 200, experiencia: 120, itens: ['semente_rara', 'fertilizante_especial'] }
    };
    
    const recompensaBase = recompensas[tipoRecompensa] || recompensas.missao;
    const multiplicadorFinal = multiplicador || 1;
    
    // Calcular valores finais
    const moedas = Math.floor(recompensaBase.moedas * multiplicadorFinal);
    const experiencia = Math.floor(recompensaBase.experiencia * multiplicadorFinal);
    
    // Adicionar ao invent√°rio
    const inventario = JSON.parse(localStorage.getItem('inventario_fazenda') || '{}');
    
    // Moedas
    if (!inventario.moedas) inventario.moedas = 0;
    inventario.moedas += moedas;
    
    // Experi√™ncia
    if (!inventario.experiencia) inventario.experiencia = 0;
    inventario.experiencia += experiencia;
    
    // Itens
    recompensaBase.itens.forEach(item => {
        if (!inventario.itens) inventario.itens = {};
        if (!inventario.itens[item]) {
            inventario.itens[item] = { quantidade: 0, qualidade: [] };
        }
        inventario.itens[item].quantidade += 1;
        inventario.itens[item].qualidade.push("recompensa");
    });
    
    // Salvar invent√°rio
    localStorage.setItem('inventario_fazenda', JSON.stringify(inventario));
    
    // Mostrar recompensa
    mostrarRecompensaVisual(moedas, experiencia, recompensaBase.itens);
    
    return {
        tipo: tipoRecompensa,
        moedas: moedas,
        experiencia: experiencia,
        itens: recompensaBase.itens,
        inventarioAtual: inventario
    };
    
    function mostrarRecompensaVisual(moedas, exp, itens) {
        const container = document.createElement('div');
        container.id = 'recompensa-visual';
        container.style.cssText = \`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            color: white;
            text-align: center;
            z-index: 10002;
            min-width: 300px;
            animation: popIn 0.5s ease;
        \`;
        
        const titulo = document.createElement('h2');
        titulo.textContent = "üéÅ Recompensa!";
        titulo.style.cssText = \`
            color: #FFD700;
            margin-bottom: 20px;
        \`;
        
        const lista = document.createElement('div');
        lista.style.cssText = \`
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 18px;
        \`;
        
        if (moedas > 0) {
            const itemMoedas = document.createElement('div');
            itemMoedas.textContent = "üí∞ " + moedas + " moedas";
            itemMoedas.style.color = '#FFD700';
            lista.appendChild(itemMoedas);
        }
        
        if (exp > 0) {
            const itemExp = document.createElement('div');
            itemExp.textContent = "‚≠ê " + exp + " experi√™ncia";
            itemExp.style.color = '#4CAF50';
            lista.appendChild(itemExp);
        }
        
        itens.forEach(item => {
            const itemElem = document.createElement('div');
            itemElem.textContent = "üéÅ " + item;
            itemElem.style.color = '#9C27B0';
            lista.appendChild(itemElem);
        });
        
        const botao = document.createElement('button');
        botao.textContent = "OK";
        botao.style.cssText = \`
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        \`;
        
        botao.addEventListener('click', function() {
            document.body.removeChild(container);
        });
        
        container.appendChild(titulo);
        container.appendChild(lista);
        container.appendChild(botao);
        document.body.appendChild(container);
        
        // Remover automaticamente ap√≥s 5 segundos
        setTimeout(() => {
            if (document.body.contains(container)) {
                document.body.removeChild(container);
            }
        }, 5000);
    }
}`,
            type: "minigame",
            color: "#FFD700",
            parameters: [
                { name: "tipoRecompensa", type: "string", default: "'missao'" },
                { name: "multiplicador", type: "number", default: "1" }
            ]
        }
    ]
};

// Fun√ß√£o auxiliar para mostrar feedback (usada por v√°rias fun√ß√µes)
function mostrarFeedback(mensagem, tipo) {
    const feedback = document.createElement('div');
    feedback.textContent = mensagem;
    feedback.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        background-color: ${tipo === 'success' ? '#4CAF50' : 
                          tipo === 'error' ? '#F44336' : 
                          tipo === 'warning' ? '#FF9800' : 
                          tipo === 'info' ? '#2196F3' : '#9C27B0'};
        color: white;
        border-radius: 5px;
        z-index: 10000;
        animation: slideInRight 0.3s ease, fadeOut 3s ease 2.7s;
    `;
    
    document.body.appendChild(feedback);
    
    setTimeout(() => {
        if (feedback.parentNode) {
            feedback.parentNode.removeChild(feedback);
        }
    }, 3000);
}

// Fun√ß√£o para adicionar todos os comandos ao sistema de bolhas personalizadas
function adicionarComandosFlowStory() {
    console.log("Adicionando comandos FlowStory ao sistema...");
    
    // Combinar todos os comandos em um array
    const todosComandos = [
        ...flowCommands.organizar,
        ...flowCommands.ativacao,
        ...flowCommands.interface,
        ...flowCommands.navegacao,
        ...flowCommands.minigame
    ];
    
    // Adicionar cada comando como bolha personalizada
    todosComandos.forEach(comando => {
        // Verificar se j√° existe
        const existe = customBubbles.some(b => b.name === comando.name);
        if (!existe) {
            customBubbles.push({
                id: Date.now() + Math.random(),
                name: comando.name,
                description: comando.description,
                code: comando.code,
                type: comando.type,
                color: comando.color,
                parameters: comando.parameters,
                createdAt: new Date().toISOString()
            });
        }
    });
    
    // Salvar no localStorage
    localStorage.setItem('customBubbles', JSON.stringify(customBubbles));
    
    console.log("Comandos adicionados: " + todosComandos.length);
    alert(`‚úÖ ${todosComandos.length} comandos FlowStory foram adicionados ao sistema!`);
    
    // Recarregar a lista de bolhas criadas
    if (typeof loadCreatedBubbles === 'function') {
        loadCreatedBubbles();
    }
}

// Adicionar bot√£o para carregar comandos no sistema de novas bolhas
document.addEventListener('DOMContentLoaded', function() {
    // Verificar se o sistema de novas bolhas existe
    const newBubblesSidebar = document.querySelector('.new-bubbles-sidebar');
    
    if (newBubblesSidebar) {
        // Criar bot√£o para adicionar comandos FlowStory
        const botaoComandos = document.createElement('button');
        botaoComandos.className = 'add-param';
        botaoComandos.id = 'adicionar-comandos-flowstory';
        botaoComandos.textContent = 'üì• Carregar Comandos FlowStory';
        botaoComandos.style.cssText = `
            background-color: #9C27B0;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            width: 100%;
        `;
        
        botaoComandos.addEventListener('click', function() {
            if (confirm('Deseja adicionar todos os comandos FlowStory ao sistema? Isso adicionar√° novas bolhas personalizadas.')) {
                adicionarComandosFlowStory();
            }
        });
        
        newBubblesSidebar.appendChild(botaoComandos);
        
        // Adicionar automaticamente quando o sistema de novas bolhas for aberto
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    const display = newBubblesSystem.style.display;
                    if (display === 'block') {
                        // Sistema aberto, verificar se comandos j√° foram adicionados
                        const comandosAdicionados = localStorage.getItem('flowstory_comandos_adicionados');
                        if (!comandosAdicionados) {
                            console.log("Primeira vez abrindo sistema de novas bolhas - comandos dispon√≠veis");
                        }
                    }
                }
            });
        });
        
        observer.observe(newBubblesSystem, { attributes: true });
    }
    
    // Adicionar CSS para anima√ß√µes
    if (!document.querySelector('#animacoes-flowstory')) {
        const style = document.createElement('style');
        style.id = 'animacoes-flowstory';
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            
            @keyframes popIn {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                70% { transform: translate(-50%, -50%) scale(1.1); }
                100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    }
    
    // Marcar que comandos est√£o dispon√≠veis
    localStorage.setItem('flowstory_comandos_disponiveis', 'true');
});

// Adicionar ao objeto global para acesso via console
window.FlowStoryComandos = flowCommands;
window.adicionarComandosFlowStory = adicionarComandosFlowStory;
		
    </script>
</body>
</html>
<!-- Adicionar na se√ß√£o HTML, antes do fechamento </body> -->
<!-- Sistema de Preview Avan√ßado -->
<div class="preview-advanced" id="preview-advanced">
    <div class="preview-advanced-header">
        <h2>Preview Avan√ßado</h2>
        <div class="preview-tools">
            <button class="preview-tool-btn" id="preview-add-character">+ Personagem</button>
            <button class="preview-tool-btn" id="preview-add-dialog">+ Di√°logo</button>
            <button class="preview-tool-btn" id="preview-add-thought">+ Pensamento</button>
            <button class="preview-tool-btn" id="preview-add-background">+ Fundo</button>
            <button class="preview-tool-btn" id="preview-save-scene">üíæ Salvar Cena</button>
            <button class="close-btn" id="close-preview-advanced">√ó</button>
        </div>
    </div>
    
    <div class="preview-advanced-content">
        <!-- Painel de Controles -->
        <div class="preview-controls">
            <div class="control-section">
                <h3>üìÅ Biblioteca de Cenas</h3>
                <div class="scene-library" id="scene-library">
                    <div class="scene-item" data-scene="default">
                        <div class="scene-thumbnail">üé¨</div>
                        <div class="scene-info">
                            <div class="scene-name">Cena Inicial</div>
                            <div class="scene-stats">2 personagens, 3 di√°logos</div>
                        </div>
                    </div>
                </div>
                <button class="preview-btn" id="load-scene">üìÇ Carregar Cena</button>
                <button class="preview-btn" id="new-scene">üÜï Nova Cena</button>
            </div>
            
            <div class="control-section">
                <h3>üë• Personagens</h3>
                <div class="characters-list" id="characters-list">
                    <!-- Personagens ser√£o adicionados aqui -->
                </div>
                <div class="character-form" id="character-form" style="display: none;">
                    <input type="text" id="character-name" placeholder="Nome do personagem">
                    <input type="color" id="character-color" value="#ff6b6b">
                    <select id="character-position">
                        <option value="left">Esquerda</option>
                        <option value="center">Centro</option>
                        <option value="right">Direita</option>
                    </select>
                    <button class="preview-btn" id="save-character">Salvar</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>üé≠ Express√µes</h3>
                <div class="expressions-grid">
                    <div class="expression-btn" data-expression="normal">üòê Normal</div>
                    <div class="expression-btn" data-expression="happy">üòä Feliz</div>
                    <div class="expression-btn" data-expression="sad">üò¢ Triste</div>
                    <div class="expression-btn" data-expression="angry">üò† Bravo</div>
                    <div class="expression-btn" data-expression="surprised">üòÆ Surpreso</div>
                    <div class="expression-btn" data-expression="thinking">ü§î Pensando</div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>üé® Fundos</h3>
                <div class="backgrounds-grid" id="backgrounds-grid">
                    <div class="background-item" data-bg="room" style="background-color: #8B4513;">üè† Sala</div>
                    <div class="background-item" data-bg="forest" style="background-color: #228B22;">üå≥ Floresta</div>
                    <div class="background-item" data-bg="city" style="background-color: #4682B4;">üèôÔ∏è Cidade</div>
                    <div class="background-item" data-bg="beach" style="background-color: #87CEEB;">üèñÔ∏è Praia</div>
                    <div class="background-item" data-bg="castle" style="background-color: #B0C4DE;">üè∞ Castelo</div>
                    <div class="background-item" data-bg="custom">üé® Personalizado</div>
                </div>
            </div>
        </div>
        
        <!-- √Årea de Preview -->
        <div class="preview-stage">
            <!-- Fundo da Cena -->
            <div class="scene-background" id="scene-background">
                <!-- Personagens ser√£o adicionados aqui -->
            </div>
            
            <!-- Sistema de Di√°logo -->
            <div class="dialogue-system" id="dialogue-system">
                <!-- Cabe√ßalho do Di√°logo -->
                <div class="dialogue-header">
                    <div class="character-portrait" id="speaking-character">
                        <div class="portrait-image">üë§</div>
                        <div class="character-name">Personagem</div>
                        <div class="character-expression">üòê</div>
                    </div>
                    <div class="dialogue-controls">
                        <button class="dialogue-btn" id="auto-play">‚ñ∂Ô∏è Auto</button>
                        <button class="dialogue-btn" id="skip-dialogue">‚è≠Ô∏è Pular</button>
                        <button class="dialogue-btn" id="log-dialogue">üìú Log</button>
                    </div>
                </div>
                
                <!-- Caixa de Di√°logo -->
                <div class="dialogue-box" id="dialogue-box">
                    <div class="dialogue-content" id="dialogue-content">
                        <p>Clique em "Adicionar Di√°logo" para come√ßar...</p>
                    </div>
                    <div class="dialogue-options" id="dialogue-options">
                        <!-- Op√ß√µes de di√°logo aparecer√£o aqui -->
                    </div>
                </div>
                
                <!-- Controles de Di√°logo -->
                <div class="dialogue-footer">
                    <button class="dialogue-nav-btn" id="prev-dialogue">‚óÄÔ∏è Anterior</button>
                    <div class="dialogue-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="dialogue-progress"></div>
                        </div>
                        <span id="dialogue-counter">0/0</span>
                    </div>
                    <button class="dialogue-nav-btn" id="next-dialogue">Pr√≥ximo ‚ñ∂Ô∏è</button>
                </div>
                
                <!-- Editor de Di√°logo -->
                <div class="dialogue-editor" id="dialogue-editor" style="display: none;">
                    <div class="editor-header">
                        <h4>Editor de Di√°logo</h4>
                        <button class="close-editor" id="close-editor">√ó</button>
                    </div>
                    <div class="editor-body">
                        <div class="form-group">
                            <label>Personagem:</label>
                            <select id="dialog-character">
                                <option value="narrator">üé≠ Narrador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo:</label>
                            <select id="dialog-type">
                                <option value="speech">üí¨ Fala</option>
                                <option value="thought">üí≠ Pensamento</option>
                                <option value="shout">üì¢ Grito</option>
                                <option value="whisper">üîà Sussurro</option>
                                <option value="action">üé¨ A√ß√£o</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Express√£o:</label>
                            <select id="dialog-expression">
                                <option value="normal">üòê Normal</option>
                                <option value="happy">üòä Feliz</option>
                                <option value="sad">üò¢ Triste</option>
                                <option value="angry">üò† Bravo</option>
                                <option value="surprised">üòÆ Surpreso</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Texto:</label>
                            <textarea id="dialog-text" placeholder="Digite o di√°logo aqui..." rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Op√ß√µes:</label>
                            <div class="options-list" id="options-list">
                                <!-- Op√ß√µes ser√£o adicionadas aqui -->
                            </div>
                            <button class="add-option-btn" id="add-option">+ Adicionar Op√ß√£o</button>
                        </div>
                        <div class="editor-actions">
                            <button class="preview-btn" id="save-dialog">üíæ Salvar Di√°logo</button>
                            <button class="preview-btn" id="test-dialog">üé¨ Testar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Log de Di√°logos -->
            <div class="dialogue-log" id="dialogue-log" style="display: none;">
                <div class="log-header">
                    <h4>üìú Hist√≥rico de Di√°logos</h4>
                    <button class="close-log" id="close-log">√ó</button>
                </div>
                <div class="log-content" id="log-content">
                    <!-- Di√°logos anteriores aparecer√£o aqui -->
                </div>
            </div>
        </div>
        
        <!-- Painel de Timeline -->
        <div class="preview-timeline">
            <div class="timeline-header">
                <h3>‚è±Ô∏è Timeline da Cena</h3>
                <div class="timeline-controls">
                    <button class="timeline-btn" id="play-timeline">‚ñ∂Ô∏è</button>
                    <button class="timeline-btn" id="pause-timeline">‚è∏Ô∏è</button>
                    <button class="timeline-btn" id="stop-timeline">‚èπÔ∏è</button>
                </div>
            </div>
            <div class="timeline-track" id="timeline-track">
                <!-- Eventos da timeline ser√£o adicionados aqui -->
            </div>
            <div class="timeline-events">
                <h4>Eventos da Cena</h4>
                <div class="events-list" id="events-list">
                    <!-- Lista de eventos -->
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Sistema de Preview Avan√ßado */
    .preview-advanced {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: white;
        z-index: 1000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .preview-advanced-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .preview-tools {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .preview-tool-btn {
        padding: 8px 15px;
        background-color: rgba(255,255,255,0.2);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .preview-tool-btn:hover {
        background-color: rgba(255,255,255,0.3);
    }
    
    .preview-advanced-content {
        display: grid;
        grid-template-columns: 250px 1fr 300px;
        height: calc(100vh - 70px);
    }
    
    /* Painel de Controles */
    .preview-controls {
        background-color: #f8f9fa;
        border-right: 1px solid #e9ecef;
        padding: 15px;
        overflow-y: auto;
    }
    
    .control-section {
        margin-bottom: 25px;
    }
    
    .control-section h3 {
        font-size: 14px;
        color: #495057;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .scene-library {
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 10px;
    }
    
    .scene-item {
        display: flex;
        align-items: center;
        padding: 8px;
        background-color: white;
        border-radius: 5px;
        margin-bottom: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
        border: 1px solid #dee2e6;
    }
    
    .scene-item:hover {
        background-color: #e9ecef;
    }
    
    .scene-thumbnail {
        width: 40px;
        height: 40px;
        background-color: #6c757d;
        color: white;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-size: 20px;
    }
    
    .scene-info {
        flex: 1;
    }
    
    .scene-name {
        font-weight: bold;
        font-size: 13px;
    }
    
    .scene-stats {
        font-size: 11px;
        color: #6c757d;
    }
    
    .preview-btn {
        width: 100%;
        padding: 8px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        margin-bottom: 5px;
        transition: background-color 0.3s;
    }
    
    .preview-btn:hover {
        background-color: #5a6268;
    }
    
    .characters-list {
        max-height: 150px;
        overflow-y: auto;
        margin-bottom: 10px;
    }
    
    .character-item {
        display: flex;
        align-items: center;
        padding: 6px;
        background-color: white;
        border-radius: 3px;
        margin-bottom: 3px;
        font-size: 13px;
    }
    
    .character-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }
    
    .character-form {
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #dee2e6;
    }
    
    .character-form input,
    .character-form select {
        width: 100%;
        padding: 5px;
        margin-bottom: 5px;
        border: 1px solid #ced4da;
        border-radius: 3px;
        font-size: 13px;
    }
    
    .expressions-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
    }
    
    .expression-btn {
        padding: 8px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        text-align: center;
        transition: background-color 0.2s;
    }
    
    .expression-btn:hover {
        background-color: #f8f9fa;
    }
    
    .backgrounds-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
    }
    
    .background-item {
        padding: 10px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        text-align: center;
        color: white;
        font-weight: bold;
        transition: transform 0.2s;
    }
    
    .background-item:hover {
        transform: scale(1.05);
    }
    
    /* √Årea de Preview */
    .preview-stage {
        position: relative;
        background-color: #2c3e50;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .scene-background {
        flex: 1;
        position: relative;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        overflow: hidden;
    }
    
    .character-on-stage {
        position: absolute;
        bottom: 0;
        width: 150px;
        height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.5s ease;
    }
    
    .character-on-stage.left {
        left: 50px;
    }
    
    .character-on-stage.center {
        left: 50%;
        transform: translateX(-50%);
    }
    
    .character-on-stage.right {
        right: 50px;
    }
    
    .character-sprite {
        width: 120px;
        height: 200px;
        background-color: #95a5a6;
        border-radius: 10px;
        margin-bottom: 10px;
        position: relative;
        overflow: hidden;
    }
    
    .character-name-tag {
        background-color: rgba(0,0,0,0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 14px;
        font-weight: bold;
    }
    
    .character-expression-tag {
        position: absolute;
        top: -25px;
        font-size: 24px;
        background-color: rgba(0,0,0,0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Sistema de Di√°logo */
    .dialogue-system {
        background-color: white;
        border-top: 3px solid #667eea;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }
    
    .dialogue-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
    }
    
    .character-portrait {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .portrait-image {
        width: 50px;
        height: 50px;
        background-color: #6c757d;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }
    
    .character-name {
        font-weight: bold;
        font-size: 16px;
    }
    
    .character-expression {
        font-size: 24px;
    }
    
    .dialogue-controls {
        display: flex;
        gap: 5px;
    }
    
    .dialogue-btn {
        padding: 5px 10px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
    }
    
    .dialogue-box {
        padding: 20px;
        min-height: 120px;
    }
    
    .dialogue-content {
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 15px;
        min-height: 60px;
    }
    
    .dialogue-content.speech {
        border-left: 4px solid #667eea;
        padding-left: 15px;
    }
    
    .dialogue-content.thought {
        border-left: 4px solid #6c757d;
        padding-left: 15px;
        font-style: italic;
        color: #495057;
    }
    
    .dialogue-content.shout {
        border-left: 4px solid #dc3545;
        padding-left: 15px;
        font-weight: bold;
        color: #dc3545;
    }
    
    .dialogue-content.whisper {
        border-left: 4px solid #17a2b8;
        padding-left: 15px;
        color: #17a2b8;
    }
    
    .dialogue-content.action {
        border-left: 4px solid #28a745;
        padding-left: 15px;
        color: #28a745;
        font-style: italic;
    }
    
    .dialogue-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 15px;
    }
    
    .dialogue-option {
        padding: 10px 15px;
        background-color: #f8f9fa;
        border: 2px solid #dee2e6;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .dialogue-option:hover {
        background-color: #e9ecef;
        border-color: #667eea;
    }
    
    .dialogue-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: #f8f9fa;
        border-top: 1px solid #e9ecef;
    }
    
    .dialogue-nav-btn {
        padding: 8px 15px;
        background-color: #667eea;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .dialogue-progress {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
        justify-content: center;
    }
    
    .progress-bar {
        width: 200px;
        height: 8px;
        background-color: #dee2e6;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background-color: #667eea;
        width: 0%;
        transition: width 0.3s;
    }
    
    /* Editor de Di√°logo */
    .dialogue-editor {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 500px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 1001;
    }
    
    .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background-color: #667eea;
        color: white;
        border-radius: 10px 10px 0 0;
    }
    
    .close-editor {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
    }
    
    .editor-body {
        padding: 20px;
    }
    
    .editor-body .form-group {
        margin-bottom: 15px;
    }
    
    .editor-body label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #495057;
    }
    
    .editor-body select,
    .editor-body textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .editor-body textarea {
        resize: vertical;
    }
    
    .options-list {
        max-height: 150px;
        overflow-y: auto;
        margin-bottom: 10px;
    }
    
    .option-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    
    .option-item input {
        flex: 1;
        padding: 5px;
        border: 1px solid #ced4da;
        border-radius: 3px;
        font-size: 13px;
    }
    
    .remove-option {
        background: none;
        border: none;
        color: #dc3545;
        cursor: pointer;
        font-size: 18px;
        margin-left: 5px;
    }
    
    .add-option-btn {
        padding: 5px 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 13px;
    }
    
    .editor-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    /* Log de Di√°logos */
    .dialogue-log {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 300px;
        max-height: 400px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 1001;
        overflow: hidden;
    }
    
    .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: #6c757d;
        color: white;
    }
    
    .close-log {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
    }
    
    .log-content {
        padding: 10px;
        overflow-y: auto;
        max-height: 350px;
    }
    
    .log-entry {
        padding: 8px;
        margin-bottom: 5px;
        background-color: #f8f9fa;
        border-radius: 3px;
        border-left: 3px solid #6c757d;
        font-size: 13px;
    }
    
    .log-entry.speech { border-left-color: #667eea; }
    .log-entry.thought { border-left-color: #6c757d; }
    .log-entry.shout { border-left-color: #dc3545; }
    .log-entry.whisper { border-left-color: #17a2b8; }
    .log-entry.action { border-left-color: #28a745; }
    
    /* Painel de Timeline */
    .preview-timeline {
        background-color: #f8f9fa;
        border-left: 1px solid #e9ecef;
        padding: 15px;
        overflow-y: auto;
    }
    
    .timeline-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .timeline-controls {
        display: flex;
        gap: 5px;
    }
    
    .timeline-btn {
        padding: 5px 10px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
    }
    
    .timeline-track {
        height: 60px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        margin-bottom: 15px;
        position: relative;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
    }
    
    .timeline-event {
        display: inline-block;
        height: 100%;
        padding: 5px 10px;
        background-color: #667eea;
        color: white;
        border-radius: 3px;
        margin-right: 2px;
        font-size: 11px;
        cursor: pointer;
        position: relative;
        vertical-align: top;
    }
    
    .timeline-event.dialogue { background-color: #667eea; }
    .timeline-event.character { background-color: #28a745; }
    .timeline-event.background { background-color: #ffc107; color: #000; }
    .timeline-event.effect { background-color: #17a2b8; }
    
    .events-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .event-item {
        padding: 8px;
        background-color: white;
        border-radius: 3px;
        margin-bottom: 5px;
        font-size: 13px;
        border-left: 3px solid #6c757d;
    }
    
    /* Bolhas de Pensamento e Fala */
    .thought-bubble {
        position: absolute;
        top: -60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: white;
        padding: 10px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        max-width: 200px;
        font-size: 14px;
        z-index: 10;
    }
    
    .thought-bubble::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 10px 10px 0;
        border-style: solid;
        border-color: white transparent transparent;
    }
    
    .speech-bubble {
        position: absolute;
        top: -80px;
        left: 50%;
        transform: translateX(-50%);
        background-color: white;
        padding: 12px 18px;
        border-radius: 15px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.2);
        max-width: 250px;
        font-size: 14px;
        z-index: 10;
    }
    
    .speech-bubble::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        border-width: 10px 10px 0;
        border-style: solid;
        border-color: white transparent transparent;
    }
    
    /* Anima√ß√µes */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .character-on-stage.active {
        animation: pulse 2s infinite;
    }
    
    .dialogue-content.new {
        animation: fadeIn 0.5s ease;
    }
</style>

<script>
// Sistema de Preview Avan√ßado
const previewAdvanced = document.getElementById('preview-advanced');
let currentScene = {
    id: 'default',
    name: 'Cena Inicial',
    background: 'room',
    characters: [],
    dialogues: [],
    currentDialogue: 0
};

let characters = [];
let dialogues = [];
let isAutoPlaying = false;
let autoPlayInterval = null;
let timelineEvents = [];

// Fun√ß√µes auxiliares
function showPreviewAdvanced() {
    previewAdvanced.style.display = 'block';
    loadScene('default');
    loadCharacters();
    updateTimeline();
}

function closePreviewAdvanced() {
    previewAdvanced.style.display = 'none';
    stopAutoPlay();
}

// Carregar cena
function loadScene(sceneId) {
    const savedScene = localStorage.getItem(`scene_${sceneId}`);
    if (savedScene) {
        currentScene = JSON.parse(savedScene);
    } else {
        // Cena padr√£o
        currentScene = {
            id: sceneId,
            name: 'Cena ' + sceneId,
            background: 'room',
            characters: [
                { id: 'char1', name: 'Protagonista', color: '#ff6b6b', position: 'left', expression: 'normal' },
                { id: 'char2', name: 'Amigo', color: '#4ecdc4', position: 'right', expression: 'normal' }
            ],
            dialogues: [
                {
                    id: 1,
                    character: 'Protagonista',
                    type: 'speech',
                    expression: 'normal',
                    text: 'Ol√°! Como voc√™ est√°?',
                    options: []
                },
                {
                    id: 2,
                    character: 'Amigo',
                    type: 'speech',
                    expression: 'happy',
                    text: 'Estou bem, obrigado! E voc√™?',
                    options: []
                }
            ],
            currentDialogue: 0
        };
    }
    
    updateSceneDisplay();
    updateDialogueDisplay();
    updateCharactersList();
}

function saveScene() {
    localStorage.setItem(`scene_${currentScene.id}`, JSON.stringify(currentScene));
    showNotification('Cena salva com sucesso!', 'success');
}

// Atualizar exibi√ß√£o da cena
function updateSceneDisplay() {
    const background = document.getElementById('scene-background');
    background.innerHTML = '';
    
    // Aplicar fundo
    background.style.background = getBackgroundStyle(currentScene.background);
    
    // Adicionar personagens
    currentScene.characters.forEach(char => {
        const characterDiv = document.createElement('div');
        characterDiv.className = `character-on-stage ${char.position} ${char.id === getCurrentCharacter() ? 'active' : ''}`;
        characterDiv.dataset.id = char.id;
        
        characterDiv.innerHTML = `
            <div class="character-expression-tag">${getExpressionEmoji(char.expression)}</div>
            <div class="character-sprite" style="background-color: ${char.color};">
                <div class="sprite-content">${char.name.charAt(0)}</div>
            </div>
            <div class="character-name-tag">${char.name}</div>
        `;
        
        background.appendChild(characterDiv);
    });
}

function getBackgroundStyle(bgType) {
    const backgrounds = {
        room: 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)',
        forest: 'linear-gradient(135deg, #228B22 0%, #32CD32 100%)',
        city: 'linear-gradient(135deg, #4682B4 0%, #87CEEB 100%)',
        beach: 'linear-gradient(135deg, #87CEEB 0%, #F0E68C 100%)',
        castle: 'linear-gradient(135deg, #B0C4DE 0%, #DDA0DD 100%)',
        custom: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
    };
    
    return backgrounds[bgType] || backgrounds.room;
}

function getExpressionEmoji(expression) {
    const emojis = {
        normal: 'üòê',
        happy: 'üòä',
        sad: 'üò¢',
        angry: 'üò†',
        surprised: 'üòÆ',
        thinking: 'ü§î'
    };
    
    return emojis[expression] || 'üòê';
}

// Sistema de Di√°logo
function updateDialogueDisplay() {
    if (currentScene.dialogues.length === 0) {
        document.getElementById('dialogue-content').innerHTML = '<p>Nenhum di√°logo adicionado. Clique em "+ Di√°logo" para come√ßar.</p>';
        document.getElementById('dialogue-progress').style.width = '0%';
        document.getElementById('dialogue-counter').textContent = '0/0';
        return;
    }
    
    const currentDialogue = currentScene.dialogues[currentScene.currentDialogue];
    
    // Atualizar personagem falando
    document.getElementById('speaking-character').innerHTML = `
        <div class="portrait-image" style="background-color: ${getCharacterColor(currentDialogue.character)};">
            ${currentDialogue.character.charAt(0)}
        </div>
        <div class="character-name">${currentDialogue.character}</div>
        <div class="character-expression">${getExpressionEmoji(currentDialogue.expression)}</div>
    `;
    
    // Atualizar conte√∫do do di√°logo
    const dialogueContent = document.getElementById('dialogue-content');
    dialogueContent.className = `dialogue-content ${currentDialogue.type} new`;
    dialogueContent.innerHTML = `<p>${currentDialogue.text}</p>`;
    
    // Atualizar op√ß√µes
    const optionsContainer = document.getElementById('dialogue-options');
    optionsContainer.innerHTML = '';
    
    if (currentDialogue.options && currentDialogue.options.length > 0) {
        currentDialogue.options.forEach((option, index) => {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'dialogue-option';
            optionDiv.textContent = option.text;
            optionDiv.addEventListener('click', () => selectOption(option));
            optionsContainer.appendChild(optionDiv);
        });
    }
    
    // Atualizar progresso
    const progress = ((currentScene.currentDialogue + 1) / currentScene.dialogues.length) * 100;
    document.getElementById('dialogue-progress').style.width = `${progress}%`;
    document.getElementById('dialogue-counter').textContent = 
        `${currentScene.currentDialogue + 1}/${currentScene.dialogues.length}`;
    
    // Atualizar personagem ativo
    updateActiveCharacter(currentDialogue.character);
    
    // Adicionar ao log
    addToDialogueLog(currentDialogue);
}

function getCharacterColor(characterName) {
    const character = currentScene.characters.find(c => c.name === characterName);
    return character ? character.color : '#6c757d';
}

function getCurrentCharacter() {
    if (currentScene.dialogues.length === 0) return null;
    const currentDialogue = currentScene.dialogues[currentScene.currentDialogue];
    const character = currentScene.characters.find(c => c.name === currentDialogue.character);
    return character ? character.id : null;
}

function updateActiveCharacter(characterName) {
    // Remover classe active de todos
    document.querySelectorAll('.character-on-stage').forEach(el => {
        el.classList.remove('active');
    });
    
    // Adicionar ao personagem atual
    const character = currentScene.characters.find(c => c.name === characterName);
    if (character) {
        const characterEl = document.querySelector(`.character-on-stage[data-id="${character.id}"]`);
        if (characterEl) {
            characterEl.classList.add('active');
        }
    }
}

function nextDialogue() {
    if (currentScene.currentDialogue < currentScene.dialogues.length - 1) {
        currentScene.currentDialogue++;
        updateDialogueDisplay();
        addTimelineEvent('dialogue', `Di√°logo ${currentScene.currentDialogue + 1}`);
    }
}

function prevDialogue() {
    if (currentScene.currentDialogue > 0) {
        currentScene.currentDialogue--;
        updateDialogueDisplay();
    }
}

// Adicionar Di√°logo
function addDialogue() {
    const editor = document.getElementById('dialogue-editor');
    editor.style.display = 'block';
    
    // Preencher select de personagens
    const characterSelect = document.getElementById('dialog-character');
    characterSelect.innerHTML = '<option value="narrator">üé≠ Narrador</option>';
    currentScene.characters.forEach(char => {
        const option = document.createElement('option');
        option.value = char.name;
        option.textContent = `${char.name}`;
        characterSelect.appendChild(option);
    });
}

function saveDialog() {
    const character = document.getElementById('dialog-character').value;
    const type = document.getElementById('dialog-type').value;
    const expression = document.getElementById('dialog-expression').value;
    const text = document.getElementById('dialog-text').value;
    
    // Coletar op√ß√µes
    const options = [];
    document.querySelectorAll('#options-list input').forEach(input => {
        if (input.value.trim()) {
            options.push({
                text: input.value.trim(),
                nextDialogue: currentScene.dialogues.length + 1
            });
        }
    });
    
    const newDialogue = {
        id: currentScene.dialogues.length + 1,
        character: character === 'narrator' ? 'Narrador' : character,
        type: type,
        expression: expression,
        text: text,
        options: options
    };
    
    currentScene.dialogues.push(newDialogue);
    currentScene.currentDialogue = currentScene.dialogues.length - 1;
    
    updateDialogueDisplay();
    closeDialogEditor();
    addTimelineEvent('dialogue', `Novo di√°logo: ${character}`);
    
    showNotification('Di√°logo adicionado!', 'success');
}

function closeDialogEditor() {
    document.getElementById('dialogue-editor').style.display = 'none';
    document.getElementById('dialog-text').value = '';
    document.getElementById('options-list').innerHTML = '';
}

// Sistema de Log
function addToDialogueLog(dialogue) {
    const logContent = document.getElementById('log-content');
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${dialogue.type}`;
    
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    logEntry.innerHTML = `
        <strong>${dialogue.character}</strong> [${time}]
        <p>${dialogue.text}</p>
        ${dialogue.options.length > 0 ? `<small>${dialogue.options.length} op√ß√£o(√µes)</small>` : ''}
    `;
    
    logContent.appendChild(logEntry);
    logContent.scrollTop = logContent.scrollHeight;
}

function showDialogueLog() {
    document.getElementById('dialogue-log').style.display = 'block';
}

function closeDialogueLog() {
    document.getElementById('dialogue-log').style.display = 'none';
}

// Sistema de Auto Play
function toggleAutoPlay() {
    if (isAutoPlaying) {
        stopAutoPlay();
    } else {
        startAutoPlay();
    }
}

function startAutoPlay() {
    isAutoPlaying = true;
    document.getElementById('auto-play').textContent = '‚è∏Ô∏è Parar';
    
    autoPlayInterval = setInterval(() => {
        if (currentScene.currentDialogue < currentScene.dialogues.length - 1) {
            nextDialogue();
        } else {
            stopAutoPlay();
        }
    }, 3000); // 3 segundos por di√°logo
}

function stopAutoPlay() {
    isAutoPlaying = false;
    document.getElementById('auto-play').textContent = '‚ñ∂Ô∏è Auto';
    
    if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
        autoPlayInterval = null;
    }
}

// Sistema de Personagens
function loadCharacters() {
    const charactersList = document.getElementById('characters-list');
    charactersList.innerHTML = '';
    
    currentScene.characters.forEach(char => {
        const charDiv = document.createElement('div');
        charDiv.className = 'character-item';
        charDiv.innerHTML = `
            <div class="character-color" style="background-color: ${char.color};"></div>
            <div class="character-name">${char.name}</div>
        `;
        charactersList.appendChild(charDiv);
    });
}

function addCharacter() {
    document.getElementById('character-form').style.display = 'block';
}

function saveCharacter() {
    const name = document.getElementById('character-name').value;
    const color = document.getElementById('character-color').value;
    const position = document.getElementById('character-position').value;
    
    if (!name.trim()) {
        showNotification('Digite um nome para o personagem!', 'error');
        return;
    }
    
    const newCharacter = {
        id: 'char_' + Date.now(),
        name: name,
        color: color,
        position: position,
        expression: 'normal'
    };
    
    currentScene.characters.push(newCharacter);
    updateCharactersList();
    updateSceneDisplay();
    
    document.getElementById('character-form').style.display = 'none';
    document.getElementById('character-name').value = '';
    
    addTimelineEvent('character', `Novo personagem: ${name}`);
    showNotification('Personagem adicionado!', 'success');
}

function updateCharactersList() {
    loadCharacters(); // Reutiliza a fun√ß√£o existente
}

// Sistema de Timeline
function addTimelineEvent(type, description) {
    const event = {
        id: Date.now(),
        type: type,
        description: description,
        time: new Date().toLocaleTimeString()
    };
    
    timelineEvents.push(event);
    updateTimeline();
}

function updateTimeline() {
    const timelineTrack = document.getElementById('timeline-track');
    const eventsList = document.getElementById('events-list');
    
    timelineTrack.innerHTML = '';
    eventsList.innerHTML = '';
    
    timelineEvents.forEach((event, index) => {
        // Timeline track
        const eventDiv = document.createElement('div');
        eventDiv.className = `timeline-event ${event.type}`;
        eventDiv.style.width = '80px';
        eventDiv.title = event.description;
        eventDiv.textContent = `${index + 1}`;
        
        timelineTrack.appendChild(eventDiv);
        
        // Events list
        const eventItem = document.createElement('div');
        eventItem.className = 'event-item';
        eventItem.innerHTML = `
            <strong>${event.type.toUpperCase()}</strong>
            <div>${event.description}</div>
            <small>${event.time}</small>
        `;
        
        eventsList.appendChild(eventItem);
    });
}

// Sistema de Fundos
function changeBackground(bgType) {
    currentScene.background = bgType;
    updateSceneDisplay();
    addTimelineEvent('background', `Fundo alterado: ${bgType}`);
    showNotification('Fundo alterado!', 'success');
}

// Sistema de Express√µes
function changeExpression(expression) {
    const currentCharacterId = getCurrentCharacter();
    if (currentCharacterId) {
        const character = currentScene.characters.find(c => c.id === currentCharacterId);
        if (character) {
            character.expression = expression;
            updateSceneDisplay();
            showNotification(`Express√£o alterada para: ${expression}`, 'success');
        }
    }
}

// Sistema de Op√ß√µes
function addOption() {
    const optionsList = document.getElementById('options-list');
    const optionDiv = document.createElement('div');
    optionDiv.className = 'option-item';
    
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Texto da op√ß√£o';
    
    const removeBtn = document.createElement('button');
    removeBtn.className = 'remove-option';
    removeBtn.textContent = '√ó';
    removeBtn.onclick = function() {
        optionsList.removeChild(optionDiv);
    };
    
    optionDiv.appendChild(input);
    optionDiv.appendChild(removeBtn);
    optionsList.appendChild(optionDiv);
}

// Sistema de Notifica√ß√µes
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        background-color: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
        color: white;
        border-radius: 5px;
        z-index: 10000;
        animation: fadeIn 0.3s ease, fadeOut 0.3s ease 2.7s;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    // Bot√µes principais
    document.getElementById('close-preview-advanced').addEventListener('click', closePreviewAdvanced);
    
    // Bot√µes de ferramentas
    document.getElementById('preview-add-character').addEventListener('click', addCharacter);
    document.getElementById('preview-add-dialog').addEventListener('click', addDialogue);
    document.getElementById('preview-add-thought').addEventListener('click', () => {
        addDialogue();
        document.getElementById('dialog-type').value = 'thought';
    });
    document.getElementById('preview-add-background').addEventListener('click', () => {
        document.querySelector('.background-item[data-bg="custom"]').click();
    });
    document.getElementById('preview-save-scene').addEventListener('click', saveScene);
    
    // Bot√µes de di√°logo
    document.getElementById('next-dialogue').addEventListener('click', nextDialogue);
    document.getElementById('prev-dialogue').addEventListener('click', prevDialogue);
    document.getElementById('auto-play').addEventListener('click', toggleAutoPlay);
    document.getElementById('skip-dialogue').addEventListener('click', () => {
        currentScene.currentDialogue = currentScene.dialogues.length - 1;
        updateDialogueDisplay();
    });
    document.getElementById('log-dialogue').addEventListener('click', showDialogueLog);
    document.getElementById('close-log').addEventListener('click', closeDialogueLog);
    
    // Editor de di√°logo
    document.getElementById('save-dialog').addEventListener('click', saveDialog);
    document.getElementById('close-editor').addEventListener('click', closeDialogEditor);
    document.getElementById('add-option').addEventListener('click', addOption);
    
    // Personagens
    document.getElementById('save-character').addEventListener('click', saveCharacter);
    
    // Express√µes
    document.querySelectorAll('.expression-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            changeExpression(this.dataset.expression);
        });
    });
    
    // Fundos
    document.querySelectorAll('.background-item').forEach(item => {
        item.addEventListener('click', function() {
            changeBackground(this.dataset.bg);
        });
    });
    
    // Timeline
    document.getElementById('play-timeline').addEventListener('click', startAutoPlay);
    document.getElementById('pause-timeline').addEventListener('click', stopAutoPlay);
    document.getElementById('stop-timeline').addEventListener('click', () => {
        stopAutoPlay();
        currentScene.currentDialogue = 0;
        updateDialogueDisplay();
    });
    
    // Carregar cena
    document.getElementById('load-scene').addEventListener('click', () => {
        const sceneId = prompt('Digite o ID da cena:');
        if (sceneId) {
            loadScene(sceneId);
        }
    });
    
    document.getElementById('new-scene').addEventListener('click', () => {
        const sceneId = prompt('Digite o ID para a nova cena:');
        if (sceneId) {
            loadScene(sceneId);
            showNotification('Nova cena criada!', 'success');
        }
    });
    
    // Bot√£o de adicionar op√ß√£o (no editor)
    document.getElementById('add-option').addEventListener('click', addOption);
});

// Integrar com o bot√£o Preview existente
const originalPreviewBtn = document.getElementById('preview-btn');
if (originalPreviewBtn) {
    originalPreviewBtn.addEventListener('click', showPreviewAdvanced);
} else {
    // Criar bot√£o alternativo se n√£o existir
    const menuButtons = document.querySelector('.menu-buttons');
    if (menuButtons) {
        const advancedPreviewBtn = document.createElement('button');
        advancedPreviewBtn.className = 'menu-btn';
        advancedPreviewBtn.id = 'advanced-preview-btn';
        advancedPreviewBtn.textContent = 'Preview Avan√ßado';
        advancedPreviewBtn.addEventListener('click', showPreviewAdvanced);
        menuButtons.appendChild(advancedPreviewBtn);
    }
}

// Adicionar CSS para notifica√ß√µes
if (!document.querySelector('#preview-styles')) {
    const style = document.createElement('style');
    style.id = 'preview-styles';
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
        
        .notification {
            animation: fadeIn 0.3s ease, fadeOut 0.3s ease 2.7s;
        }
        
        .sprite-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: white;
            font-weight: bold;
        }
    `;
    document.head.appendChild(style);
}

// Exportar fun√ß√µes globais
window.showPreviewAdvanced = showPreviewAdvanced;
window.closePreviewAdvanced = closePreviewAdvanced;
window.currentPreviewScene = currentScene;
</script>
<!-- Adicionar na se√ß√£o HTML, antes do fechamento </body> -->
<!-- Sistema de Exporta√ß√£o -->
<div class="export-system" id="export-system">
    <div class="export-header">
        <h2>üîÑ Sistema de Exporta√ß√£o SaveRote</h2>
        <button class="close-btn" id="close-export">√ó</button>
    </div>
    
    <div class="export-content">
        <!-- Painel de Op√ß√µes de Exporta√ß√£o -->
        <div class="export-options-panel">
            <div class="export-section">
                <h3>üì¶ Formato de Exporta√ß√£o</h3>
                <div class="format-options">
                    <div class="format-option selected" data-format="web">
                        <div class="format-icon">üåê</div>
                        <div class="format-info">
                            <h4>Web (HTML/CSS/JS)</h4>
                            <p>P√°gina web completa com todos os recursos</p>
                        </div>
                    </div>
                    <div class="format-option" data-format="apk">
                        <div class="format-icon">üì±</div>
                        <div class="format-info">
                            <h4>APK Android</h4>
                            <p>Aplicativo Android instal√°vel</p>
                        </div>
                    </div>
                    <div class="format-option" data-format="exe">
                        <div class="format-icon">üñ•Ô∏è</div>
                        <div class="format-info">
                            <h4>EXE Windows</h4>
                            <p>Execut√°vel para Windows</p>
                        </div>
                    </div>
                    <div class="format-option" data-format="json">
                        <div class="format-icon">üìä</div>
                        <div class="format-info">
                            <h4>JSON de Dados</h4>
                            <p>Exportar apenas os dados da hist√≥ria</p>
                        </div>
                    </div>
                    <div class="format-option" data-format="github">
                        <div class="format-icon">üêô</div>
                        <div class="format-info">
                            <h4>GitHub Pages</h4>
                            <p>Publicar direto no GitHub</p>
                        </div>
                    </div>
                    <div class="format-option" data-format="itchio">
                        <div class="format-icon">üéÆ</div>
                        <div class="format-info">
                            <h4>itch.io</h4>
                            <p>Publicar na plataforma itch.io</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="export-section">
                <h3>‚öôÔ∏è Configura√ß√µes</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="include-images" checked>
                            Incluir imagens
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="include-audio" checked>
                            Incluir √°udio
                        </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="minify-code" checked>
                            Minificar c√≥digo
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="compress-files" checked>
                            Comprimir arquivos
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="add-watermark">
                            Adicionar marca d'√°gua
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="export-sources">
                            Exportar c√≥digo fonte
                        </label>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label for="export-quality">Qualidade:</label>
                    <select id="export-quality">
                        <option value="high">Alta (Recomendado)</option>
                        <option value="medium">M√©dia</option>
                        <option value="low">Baixa</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="export-version">Vers√£o:</label>
                    <input type="text" id="export-version" value="1.0.0" placeholder="ex: 1.0.0">
                </div>
            </div>
        </div>
        
        <!-- Painel de Visualiza√ß√£o e Controles -->
        <div class="export-preview-panel">
            <div class="preview-header">
                <h3>üëÅÔ∏è Pr√©-visualiza√ß√£o</h3>
                <div class="preview-controls">
                    <button class="preview-btn" id="refresh-preview">üîÑ Atualizar</button>
                    <button class="preview-btn" id="fullscreen-preview">üì∫ Tela Cheia</button>
                </div>
            </div>
            
            <div class="preview-container" id="export-preview">
                <div class="preview-placeholder">
                    <div class="placeholder-icon">üëÅÔ∏è</div>
                    <p>Pr√©-visualiza√ß√£o da exporta√ß√£o aparecer√° aqui</p>
                </div>
            </div>
            
            <div class="export-info">
                <div class="info-item">
                    <span class="info-label">Tamanho estimado:</span>
                    <span class="info-value" id="estimated-size">0 MB</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tempo estimado:</span>
                    <span class="info-value" id="estimated-time">0 segundos</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Arquivos:</span>
                    <span class="info-value" id="file-count">0 arquivos</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status:</span>
                    <span class="info-value status-ready" id="export-status">Pronto</span>
                </div>
            </div>
            
            <div class="export-progress">
                <div class="progress-label">Progresso da Exporta√ß√£o</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="export-progress-fill"></div>
                </div>
                <div class="progress-text" id="export-progress-text">0%</div>
            </div>
            
            <div class="export-actions">
                <button class="export-btn secondary" id="test-export">
                    üß™ Testar Local
                </button>
                <button class="export-btn" id="start-export">
                    üöÄ Iniciar Exporta√ß√£o
                </button>
                <button class="export-btn success" id="save-export">
                    üíæ Salvar Configura√ß√£o
                </button>
            </div>
            
            <div class="export-history">
                <h4>üìú Hist√≥rico de Exporta√ß√µes</h4>
                <div class="history-list" id="export-history-list">
                    <!-- Hist√≥rico ser√° preenchido aqui -->
                </div>
            </div>
        </div>
        
        <!-- Painel de Plataformas -->
        <div class="export-platforms-panel">
            <div class="platforms-section">
                <h3>üì§ Plataformas de Publica√ß√£o</h3>
                
                <div class="platform-option" data-platform="github">
                    <div class="platform-icon">üêô</div>
                    <div class="platform-info">
                        <h4>GitHub Pages</h4>
                        <p>Publicar gratuitamente no GitHub</p>
                        <div class="platform-status" id="github-status">
                            <span class="status-dot offline"></span>
                            N√£o conectado
                        </div>
                    </div>
                    <button class="platform-btn" data-platform="github">Conectar</button>
                </div>
                
                <div class="platform-option" data-platform="itchio">
                    <div class="platform-icon">üéÆ</div>
                    <div class="platform-info">
                        <h4>itch.io</h4>
                        <p>Plataforma de jogos independentes</p>
                        <div class="platform-status" id="itchio-status">
                            <span class="status-dot offline"></span>
                            N√£o conectado
                        </div>
                    </div>
                    <button class="platform-btn" data-platform="itchio">Conectar</button>
                </div>
                
                <div class="platform-option" data-platform="gamejolt">
                    <div class="platform-icon">üéØ</div>
                    <div class="platform-info">
                        <h4>Game Jolt</h4>
                        <p>Comunidade de jogos independentes</p>
                        <div class="platform-status" id="gamejolt-status">
                            <span class="status-dot offline"></span>
                            N√£o conectado
                        </div>
                    </div>
                    <button class="platform-btn" data-platform="gamejolt">Conectar</button>
                </div>
                
                <div class="platform-option" data-platform="google-play">
                    <div class="platform-icon">üì±</div>
                    <div class="platform-info">
                        <h4>Google Play</h4>
                        <p>Loja oficial Android (requer conta desenvolvedor)</p>
                        <div class="platform-status" id="google-play-status">
                            <span class="status-dot offline"></span>
                            N√£o conectado
                        </div>
                    </div>
                    <button class="platform-btn" data-platform="google-play">Conectar</button>
                </div>
            </div>
            
            <div class="platforms-section">
                <h3>üîó Compartilhamento R√°pido</h3>
                
                <div class="share-options">
                    <button class="share-btn" data-share="link">
                        üîó Gerar Link
                    </button>
                    <button class="share-btn" data-share="qr">
                        üì± Gerar QR Code
                    </button>
                    <button class="share-btn" data-share="embed">
                        üìÑ C√≥digo Embed
                    </button>
                    <button class="share-btn" data-share="social">
                        üì¢ Compartilhar
                    </button>
                </div>
                
                <div class="share-link" id="share-link-container" style="display: none;">
                    <input type="text" id="share-link-input" readonly>
                    <button class="copy-btn" data-copy="share-link">üìã Copiar</button>
                </div>
                
                <div class="qr-container" id="qr-container" style="display: none;">
                    <canvas id="qr-code"></canvas>
                    <button class="download-btn" data-download="qr">‚¨áÔ∏è Download QR</button>
                </div>
            </div>
            
            <div class="platforms-section">
                <h3>üìä Estat√≠sticas</h3>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="stat-scenes">0</div>
                        <div class="stat-label">Cenas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-dialogues">0</div>
                        <div class="stat-label">Di√°logos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-characters">0</div>
                        <div class="stat-label">Personagens</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-choices">0</div>
                        <div class="stat-label">Escolhas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-images">0</div>
                        <div class="stat-label">Imagens</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-audio">0</div>
                        <div class="stat-label">√Åudios</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Configura√ß√£o Avan√ßada -->
    <div class="export-modal" id="advanced-settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Configura√ß√µes Avan√ßadas</h3>
                <button class="close-modal" data-modal="advanced">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4>üîß Otimiza√ß√£o</h4>
                    <div class="setting-row">
                        <label for="optimization-level">N√≠vel de Otimiza√ß√£o:</label>
                        <select id="optimization-level">
                            <option value="max">M√°xima</option>
                            <option value="balanced" selected>Balanceada</option>
                            <option value="min">M√≠nima</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="cache-strategy">Estrat√©gia de Cache:</label>
                        <select id="cache-strategy">
                            <option value="aggressive">Agressiva</option>
                            <option value="moderate" selected>Moderada</option>
                            <option value="none">Nenhuma</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4>üîí Seguran√ßa</h4>
                    <div class="setting-row">
                        <label for="encryption-level">N√≠vel de Criptografia:</label>
                        <select id="encryption-level">
                            <option value="none">Nenhuma</option>
                            <option value="basic" selected>B√°sica</option>
                            <option value="advanced">Avan√ßada</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>
                            <input type="checkbox" id="prevent-debugging">
                            Prevenir depura√ß√£o
                        </label>
                    </div>
                    <div class="setting-row">
                        <label>
                            <input type="checkbox" id="obfuscate-code">
                            Ofuscar c√≥digo
                        </label>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4>üì± Build Mobile</h4>
                    <div class="setting-row">
                        <label for="target-sdk">SDK Alvo:</label>
                        <input type="number" id="target-sdk" value="30" min="21" max="33">
                    </div>
                    <div class="setting-row">
                        <label for="min-sdk">SDK M√≠nimo:</label>
                        <input type="number" id="min-sdk" value="21" min="16" max="30">
                    </div>
                    <div class="setting-row">
                        <label>
                            <input type="checkbox" id="enable-permissions" checked>
                            Solicitar permiss√µes
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" data-modal="advanced">Cancelar</button>
                <button class="modal-btn" id="save-advanced-settings">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Conex√£o com Plataforma -->
    <div class="export-modal" id="platform-auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="platform-modal-title">Conectar Plataforma</h3>
                <button class="close-modal" data-modal="platform">√ó</button>
            </div>
            <div class="modal-body" id="platform-modal-body">
                <!-- Conte√∫do din√¢mico baseado na plataforma -->
            </div>
        </div>
    </div>
</div>

<style>
    /* Sistema de Exporta√ß√£o */
    .export-system {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: white;
        z-index: 1000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .export-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .export-content {
        display: grid;
        grid-template-columns: 350px 1fr 300px;
        height: calc(100vh - 70px);
    }
    
    /* Painel de Op√ß√µes */
    .export-options-panel {
        background-color: #f8f9fa;
        border-right: 1px solid #e9ecef;
        padding: 20px;
        overflow-y: auto;
    }
    
    .export-section {
        margin-bottom: 30px;
    }
    
    .export-section h3 {
        font-size: 16px;
        color: #495057;
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .format-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .format-option {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: white;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .format-option:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .format-option.selected {
        border-color: #667eea;
        background-color: #eef2ff;
    }
    
    .format-icon {
        font-size: 32px;
        margin-right: 15px;
    }
    
    .format-info h4 {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #495057;
    }
    
    .format-info p {
        margin: 0;
        font-size: 12px;
        color: #6c757d;
    }
    
    .settings-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .setting-item {
        display: flex;
        align-items: center;
    }
    
    .setting-item label {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #495057;
        cursor: pointer;
    }
    
    .setting-item input {
        margin-right: 8px;
    }
    
    .setting-group {
        margin-bottom: 15px;
    }
    
    .setting-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
        color: #495057;
        font-weight: 500;
    }
    
    .setting-group select,
    .setting-group input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 14px;
    }
    
    /* Painel de Visualiza√ß√£o */
    .export-preview-panel {
        padding: 20px;
        display: flex;
        flex-direction: column;
        background-color: white;
    }
    
    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .preview-controls {
        display: flex;
        gap: 10px;
    }
    
    .preview-btn {
        padding: 8px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .preview-btn:hover {
        background-color: #5a6268;
    }
    
    .preview-container {
        flex: 1;
        background-color: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: auto;
    }
    
    .preview-placeholder {
        text-align: center;
        color: #6c757d;
    }
    
    .placeholder-icon {
        font-size: 48px;
        margin-bottom: 10px;
    }
    
    .export-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .info-label {
        font-size: 14px;
        color: #495057;
    }
    
    .info-value {
        font-size: 14px;
        font-weight: 600;
        color: #495057;
    }
    
    .status-ready { color: #28a745; }
    .status-processing { color: #ffc107; }
    .status-error { color: #dc3545; }
    
    .export-progress {
        margin-bottom: 20px;
    }
    
    .progress-label {
        font-size: 14px;
        color: #495057;
        margin-bottom: 8px;
    }
    
    .progress-bar {
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 5px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.3s ease;
    }
    
    .progress-text {
        text-align: center;
        font-size: 12px;
        color: #6c757d;
    }
    
    .export-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .export-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s ease;
    }
    
    .export-btn:not(.secondary):not(.success) {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .export-btn.secondary {
        background-color: #6c757d;
        color: white;
    }
    
    .export-btn.success {
        background-color: #28a745;
        color: white;
    }
    
    .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .export-history {
        flex: 1;
        overflow-y: auto;
    }
    
    .history-list {
        max-height: 200px;
        overflow-y: auto;
    }
    
    .history-item {
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 5px;
        margin-bottom: 5px;
        font-size: 13px;
    }
    
    /* Painel de Plataformas */
    .export-platforms-panel {
        background-color: #f8f9fa;
        border-left: 1px solid #e9ecef;
        padding: 20px;
        overflow-y: auto;
    }
    
    .platforms-section {
        margin-bottom: 30px;
    }
    
    .platform-option {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .platform-icon {
        font-size: 32px;
        margin-right: 15px;
    }
    
    .platform-info {
        flex: 1;
    }
    
    .platform-info h4 {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #495057;
    }
    
    .platform-info p {
        margin: 0;
        font-size: 12px;
        color: #6c757d;
    }
    
    .platform-status {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 12px;
        margin-top: 5px;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .status-dot.online {
        background-color: #28a745;
    }
    
    .status-dot.offline {
        background-color: #dc3545;
    }
    
    .platform-btn {
        padding: 8px 15px;
        background-color: #667eea;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
    }
    
    .share-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .share-btn {
        padding: 10px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        cursor: pointer;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }
    
    .share-btn:hover {
        background-color: #f8f9fa;
        border-color: #667eea;
    }
    
    .share-link {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    #share-link-input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 13px;
    }
    
    .copy-btn {
        padding: 8px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .qr-container {
        text-align: center;
    }
    
    #qr-code {
        width: 150px;
        height: 150px;
        margin-bottom: 10px;
    }
    
    .download-btn {
        padding: 8px 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .stat-item {
        text-align: center;
        padding: 10px;
        background-color: white;
        border-radius: 8px;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
    }
    
    .stat-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
    }
    
    /* Modais */
    .export-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1001;
        align-items: center;
        justify-content: center;
    }
    
    .export-modal .modal-content {
        background-color: white;
        border-radius: 10px;
        width: 500px;
        max-width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .modal-header h3 {
        margin: 0;
        color: #495057;
    }
    
    .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6c757d;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-section {
        margin-bottom: 20px;
    }
    
    .modal-section h4 {
        margin: 0 0 15px 0;
        color: #495057;
        font-size: 16px;
    }
    
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .setting-row label {
        flex: 1;
        font-size: 14px;
        color: #495057;
    }
    
    .setting-row select,
    .setting-row input {
        width: 200px;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 5px;
    }
    
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 20px;
        border-top: 1px solid #e9ecef;
    }
    
    .modal-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .modal-btn.secondary {
        background-color: #6c757d;
        color: white;
    }
    
    .modal-btn:not(.secondary) {
        background-color: #667eea;
        color: white;
    }
    
    /* Anima√ß√µes */
    @keyframes progressPulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
    
    .progress-fill.processing {
        animation: progressPulse 1s infinite;
    }
    
    /* Responsividade */
    @media (max-width: 1200px) {
        .export-content {
            grid-template-columns: 300px 1fr;
        }
        .export-platforms-panel {
            display: none;
        }
    }
    
    @media (max-width: 768px) {
        .export-content {
            grid-template-columns: 1fr;
        }
        .export-options-panel {
            display: none;
        }
    }
</style>

<script>
// Sistema de Exporta√ß√£o SaveRote
const exportSystem = document.getElementById('export-system');
let currentExportFormat = 'web';
let exportSettings = {
    includeImages: true,
    includeAudio: true,
    minifyCode: true,
    compressFiles: true,
    addWatermark: false,
    exportSources: false,
    quality: 'high',
    version: '1.0.0',
    optimizationLevel: 'balanced',
    cacheStrategy: 'moderate',
    encryptionLevel: 'basic',
    preventDebugging: false,
    obfuscateCode: false,
    targetSdk: 30,
    minSdk: 21,
    enablePermissions: true
};

let exportHistory = JSON.parse(localStorage.getItem('exportHistory') || '[]');
let isExporting = false;
let exportProgress = 0;

// Dados da hist√≥ria atual
let storyData = {
    scenes: [],
    characters: [],
    dialogues: [],
    choices: [],
    images: [],
    audio: []
};

// Inicializar
function initExportSystem() {
    loadStoryData();
    updateStatistics();
    loadExportHistory();
    setupEventListeners();
}

// Carregar dados da hist√≥ria
function loadStoryData() {
    // Carregar cenas do preview avan√ßado
    if (window.currentPreviewScene) {
        storyData.scenes = [window.currentPreviewScene];
        storyData.characters = window.currentPreviewScene.characters || [];
        storyData.dialogues = window.currentPreviewScene.dialogues || [];
    }
    
    // Carregar bolhas da mesa de trabalho
    if (window.bubbles) {
        storyData.choices = window.bubbles.filter(b => 
            b.getAttribute('data-type') === 'escolha' || 
            b.textContent.includes('Escolha')
        ).length;
    }
    
    // Carregar arquivos uploadados
    if (window.uploadedFiles) {
        storyData.images = window.uploadedFiles.filter(f => 
            f.type.startsWith('image/')
        ).length;
        storyData.audio = window.uploadedFiles.filter(f => 
            f.type.startsWith('audio/')
        ).length;
    }
    
    updateStatistics();
}

// Atualizar estat√≠sticas
function updateStatistics() {
    document.getElementById('stat-scenes').textContent = storyData.scenes.length;
    document.getElementById('stat-dialogues').textContent = storyData.dialogues.length;
    document.getElementById('stat-characters').textContent = storyData.characters.length;
    document.getElementById('stat-choices').textContent = storyData.choices;
    document.getElementById('stat-images').textContent = storyData.images;
    document.getElementById('stat-audio').textContent = storyData.audio;
    
    // Calcular tamanho estimado
    calculateEstimatedSize();
}

// Calcular tamanho estimado
function calculateEstimatedSize() {
    let totalSize = 0;
    
    // Tamanho base do c√≥digo
    totalSize += 500; // KB base
    
    // Adicionar tamanho das imagens (estimado)
    totalSize += storyData.images * 200; // 200KB por imagem
    
    // Adicionar tamanho dos √°udios (estimado)
    totalSize += storyData.audio * 1000; // 1MB por √°udio
    
    // Converter para MB
    const sizeInMB = (totalSize / 1024).toFixed(1);
    document.getElementById('estimated-size').textContent = `${sizeInMB} MB`;
    
    // Calcular tempo estimado
    const timeInSeconds = Math.max(5, Math.floor(totalSize / 100));
    document.getElementById('estimated-time').textContent = `${timeInSeconds} segundos`;
    
    // Contar arquivos
    const fileCount = 5 + storyData.images + storyData.audio; // 5 arquivos base + recursos
    document.getElementById('file-count').textContent = `${fileCount} arquivos`;
}

// Atualizar hist√≥rico de exporta√ß√µes
function loadExportHistory() {
    const historyList = document.getElementById('export-history-list');
    historyList.innerHTML = '';
    
    if (exportHistory.length === 0) {
        historyList.innerHTML = '<div class="history-item">Nenhuma exporta√ß√£o realizada ainda</div>';
        return;
    }
    
    exportHistory.slice(-5).reverse().forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
            <strong>${item.format.toUpperCase()}</strong> - ${item.date}
            <div style="font-size: 11px; color: #6c757d;">
                ${item.size} ‚Ä¢ ${item.status}
            </div>
        `;
        historyList.appendChild(historyItem);
    });
}

function addToExportHistory(format, size, status) {
    const exportRecord = {
        id: Date.now(),
        format: format,
        date: new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR'),
        size: size,
        status: status
    };
    
    exportHistory.push(exportRecord);
    
    // Manter apenas as √∫ltimas 50 exporta√ß√µes
    if (exportHistory.length > 50) {
        exportHistory = exportHistory.slice(-50);
    }
    
    localStorage.setItem('exportHistory', JSON.stringify(exportHistory));
    loadExportHistory();
}

// Configurar event listeners
function setupEventListeners() {
    // Fechar sistema de exporta√ß√£o
    document.getElementById('close-export').addEventListener('click', closeExportSystem);
    
    // Sele√ß√£o de formato
    document.querySelectorAll('.format-option').forEach(option => {
        option.addEventListener('click', function() {
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Adicionar sele√ß√£o atual
            this.classList.add('selected');
            currentExportFormat = this.dataset.format;
            
            // Atualizar pr√©-visualiza√ß√£o
            updatePreview();
        });
    });
    
    // Configura√ß√µes
    document.getElementById('include-images').addEventListener('change', function() {
        exportSettings.includeImages = this.checked;
        calculateEstimatedSize();
    });
    
    document.getElementById('include-audio').addEventListener('change', function() {
        exportSettings.includeAudio = this.checked;
        calculateEstimatedSize();
    });
    
    document.getElementById('minify-code').addEventListener('change', function() {
        exportSettings.minifyCode = this.checked;
    });
    
    document.getElementById('compress-files').addEventListener('change', function() {
        exportSettings.compressFiles = this.checked;
    });
    
    document.getElementById('add-watermark').addEventListener('change', function() {
        exportSettings.addWatermark = this.checked;
    });
    
    document.getElementById('export-sources').addEventListener('change', function() {
        exportSettings.exportSources = this.checked;
    });
    
    document.getElementById('export-quality').addEventListener('change', function() {
        exportSettings.quality = this.value;
        calculateEstimatedSize();
    });
    
    document.getElementById('export-version').addEventListener('input', function() {
        exportSettings.version = this.value;
    });
    
    // Bot√µes de a√ß√£o
    document.getElementById('refresh-preview').addEventListener('click', updatePreview);
    document.getElementById('fullscreen-preview').addEventListener('click', toggleFullscreenPreview);
    document.getElementById('test-export').addEventListener('click', testExport);
    document.getElementById('start-export').addEventListener('click', startExport);
    document.getElementById('save-export').addEventListener('click', saveExportSettings);
    
    // Plataformas
    document.querySelectorAll('.platform-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const platform = this.dataset.platform;
            connectToPlatform(platform);
        });
    });
    
    // Compartilhamento
    document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.dataset.share;
            handleShareAction(action);
        });
    });
    
    // Modais
    document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = this.dataset.modal;
            closeModal(modal);
        });
    });
    
    document.getElementById('save-advanced-settings').addEventListener('click', saveAdvancedSettings);
    
    // Configura√ß√µes avan√ßadas
    document.getElementById('optimization-level').addEventListener('change', function() {
        exportSettings.optimizationLevel = this.value;
    });
    
    document.getElementById('cache-strategy').addEventListener('change', function() {
        exportSettings.cacheStrategy = this.value;
    });
    
    document.getElementById('encryption-level').addEventListener('change', function() {
        exportSettings.encryptionLevel = this.value;
    });
    
    document.getElementById('prevent-debugging').addEventListener('change', function() {
        exportSettings.preventDebugging = this.checked;
    });
    
    document.getElementById('obfuscate-code').addEventListener('change', function() {
        exportSettings.obfuscateCode = this.checked;
    });
    
    document.getElementById('target-sdk').addEventListener('change', function() {
        exportSettings.targetSdk = parseInt(this.value);
    });
    
    document.getElementById('min-sdk').addEventListener('change', function() {
        exportSettings.minSdk = parseInt(this.value);
    });
    
    document.getElementById('enable-permissions').addEventListener('change', function() {
        exportSettings.enablePermissions = this.checked;
    });
}

// Atualizar pr√©-visualiza√ß√£o
function updatePreview() {
    const previewContainer = document.getElementById('export-preview');
    
    switch(currentExportFormat) {
        case 'web':
            previewContainer.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üåê</div>
                    <h3>Web Export</h3>
                    <p>Estrutura de arquivos:</p>
                    <div style="text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        üìÅ index.html<br>
                        üìÅ css/<br>
                        &nbsp;&nbsp;üìÑ style.css<br>
                        üìÅ js/<br>
                        &nbsp;&nbsp;üìÑ game.js<br>
                        &nbsp;&nbsp;üìÑ engine.js<br>
                        üìÅ assets/<br>
                        &nbsp;&nbsp;üìÅ images/<br>
                        &nbsp;&nbsp;üìÅ audio/<br>
                        üìÑ README.md
                    </div>
                </div>
            `;
            break;
            
        case 'apk':
            previewContainer.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üì±</div>
                    <h3>APK Android</h3>
                    <p>Configura√ß√µes do APK:</p>
                    <div style="text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        üì¶ package: com.flowstory.game<br>
                        üì± version: ${exportSettings.version}<br>
                        üéØ minSdk: ${exportSettings.minSdk}<br>
                        üöÄ targetSdk: ${exportSettings.targetSdk}<br>
                        üîí permissions: ${exportSettings.enablePermissions ? 'Sim' : 'N√£o'}<br>
                        üìä size: ${document.getElementById('estimated-size').textContent}
                    </div>
                </div>
            `;
            break;
            
        case 'exe':
            previewContainer.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üñ•Ô∏è</div>
                    <h3>EXE Windows</h3>
                    <p>Execut√°vel Windows</p>
                    <div style="text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ü™ü Windows 10/11<br>
                        üíæ ${document.getElementById('estimated-size').textContent}<br>
                        üöÄ Auto-execut√°vel<br>
                        üì¶ Instalador inclu√≠do<br>
                        üîß Configura√ß√µes otimizadas
                    </div>
                </div>
            `;
            break;
            
        default:
            previewContainer.innerHTML = `
                <div class="preview-placeholder">
                    <div class="placeholder-icon">üëÅÔ∏è</div>
                    <p>Pr√©-visualiza√ß√£o para ${currentExportFormat}</p>
                </div>
            `;
    }
}

// Alternar tela cheia
function toggleFullscreenPreview() {
    const previewContainer = document.getElementById('export-preview');
    
    if (!document.fullscreenElement) {
        if (previewContainer.requestFullscreen) {
            previewContainer.requestFullscreen();
        }
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
    }
}

// Testar exporta√ß√£o local
function testExport() {
    showExportStatus('Processando...', 'processing');
    updateExportProgress(10);
    
    // Simular processamento
    setTimeout(() => {
        updateExportProgress(50);
        
        setTimeout(() => {
            updateExportProgress(100);
            showExportStatus('Teste conclu√≠do!', 'ready');
            
            // Mostrar resultado do teste
            alert(`‚úÖ Teste de exporta√ß√£o conclu√≠do com sucesso!\n\nFormato: ${currentExportFormat}\nTamanho: ${document.getElementById('estimated-size').textContent}\nArquivos: ${document.getElementById('file-count').textContent}`);
            
            addToExportHistory(currentExportFormat, document.getElementById('estimated-size').textContent, 'Teste');
            
        }, 1000);
    }, 1000);
}

// Iniciar exporta√ß√£o real
async function startExport() {
    if (isExporting) {
        alert('Exporta√ß√£o j√° em andamento!');
        return;
    }
    
    if (!confirm(`Iniciar exporta√ß√£o no formato ${currentExportFormat}?`)) {
        return;
    }
    
    isExporting = true;
    exportProgress = 0;
    showExportStatus('Iniciando exporta√ß√£o...', 'processing');
    
    // Atualizar progresso
    const progressInterval = setInterval(() => {
        if (exportProgress < 90) {
            exportProgress += 10;
            updateExportProgress(exportProgress);
        }
    }, 500);
    
    try {
        // Exportar baseado no formato
        const exportResult = await performExport(currentExportFormat);
        
        clearInterval(progressInterval);
        exportProgress = 100;
        updateExportProgress(exportProgress);
        
        showExportStatus('Exporta√ß√£o conclu√≠da!', 'ready');
        
        // Adicionar ao hist√≥rico
        addToExportHistory(
            currentExportFormat,
            exportResult.size,
            'Conclu√≠do'
        );
        
        // Oferecer download
        offerDownload(exportResult);
        
    } catch (error) {
        clearInterval(progressInterval);
        showExportStatus('Erro na exporta√ß√£o!', 'error');
        console.error('Erro na exporta√ß√£o:', error);
        alert(`‚ùå Erro na exporta√ß√£o: ${error.message}`);
    } finally {
        isExporting = false;
    }
}

// Realizar exporta√ß√£o baseada no formato
async function performExport(format) {
    showExportStatus(`Exportando como ${format}...`, 'processing');
    
    switch(format) {
        case 'web':
            return await exportAsWeb();
        case 'apk':
            return await exportAsAPK();
        case 'exe':
            return await exportAsEXE();
        case 'json':
            return await exportAsJSON();
        case 'github':
            return await exportToGitHub();
        case 'itchio':
            return await exportToItchIO();
        default:
            throw new Error(`Formato n√£o suportado: ${format}`);
    }
}

// Exportar como Web
async function exportAsWeb() {
    // Coletar todos os dados
    const exportData = collectExportData();
    
    // Criar estrutura de arquivos
    const files = {
        'index.html': generateHTML(exportData),
        'css/style.css': generateCSS(exportData),
        'js/game.js': generateGameJS(exportData),
        'js/engine.js': generateEngineJS(),
        'README.md': generateReadme(exportData)
    };
    
    // Adicionar recursos se necess√°rio
    if (exportSettings.includeImages && window.uploadedFiles) {
        window.uploadedFiles.forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                files[`assets/images/${file.name}`] = file.data;
            }
        });
    }
    
    // Minificar se necess√°rio
    if (exportSettings.minifyCode) {
        files['js/game.js'] = minifyCode(files['js/game.js']);
        files['js/engine.js'] = minifyCode(files['js/engine.js']);
        files['css/style.css'] = minifyCSS(files['css/style.css']);
    }
    
    // Comprimir se necess√°rio
    if (exportSettings.compressFiles) {
        // Simular compress√£o
        console.log('Comprimindo arquivos...');
    }
    
    // Criar arquivo ZIP
    const zip = new JSZip();
    
    Object.keys(files).forEach(filename => {
        zip.file(filename, files[filename]);
    });
    
    const zipContent = await zip.generateAsync({type: 'blob'});
    
    return {
        blob: zipContent,
        size: formatFileSize(zipContent.size),
        filename: `flowstory_export_${Date.now()}.zip`
    };
}

// Exportar como APK
async function exportAsAPK() {
    // Esta seria uma implementa√ß√£o complexa que requer ferramentas espec√≠ficas
    // Aqui est√° uma simula√ß√£o
    
    const exportData = collectExportData();
    
    // Para uma implementa√ß√£o real, voc√™ precisaria:
    // 1. Criar estrutura Android
    // 2. Compilar com Cordova/PhoneGap
    // 3. Gerar APK
    
    // Simula√ß√£o de APK
    const simulatedAPK = {
        name: `flowstory_${exportSettings.version}.apk`,
        size: '15-50 MB',
        requirements: `Android ${exportSettings.minSdk}+`
    };
    
    // Criar arquivo dummy para demonstra√ß√£o
    const dummyContent = `Este √© um APK simulado. Para uma exporta√ß√£o real de APK, √© necess√°rio configurar o ambiente Android SDK e usar ferramentas como Cordova ou React Native.`;
    
    return {
        blob: new Blob([dummyContent], {type: 'application/vnd.android.package-archive'}),
        size: simulatedAPK.size,
        filename: simulatedAPK.name
    };
}

// Exportar como EXE
async function exportAsEXE() {
    // Simula√ß√£o de exporta√ß√£o EXE
    const exportData = collectExportData();
    
    // Para uma implementa√ß√£o real, voc√™ poderia usar:
    // - Electron para desktop apps
    // - NW.js
    // - Compiladores espec√≠ficos
    
    const htmlContent = generateHTML(exportData);
    const cssContent = generateCSS(exportData);
    const jsContent = generateGameJS(exportData);
    
    // Em um cen√°rio real, isso seria empacotado com Electron
    const electronConfig = {
        name: "FlowStory Game",
        version: exportSettings.version,
        main: "main.js",
        dependencies: {
            "electron": "^latest"
        }
    };
    
    const dummyContent = `Execut√°vel Windows simulado. Para exporta√ß√£o real, √© necess√°rio usar Electron ou similar.`;
    
    return {
        blob: new Blob([dummyContent], {type: 'application/x-msdownload'}),
        size: '20-100 MB',
        filename: `flowstory_${exportSettings.version}.exe`
    };
}

// Exportar como JSON
async function exportAsJSON() {
    const exportData = collectExportData();
    
    // Adicionar metadados
    const fullData = {
        metadata: {
            exportedAt: new Date().toISOString(),
            version: exportSettings.version,
            format: 'flowstory-json',
            generator: 'FlowStory SaveRote'
        },
        settings: exportSettings,
        story: exportData
    };
    
    // Ofuscar se necess√°rio
    let jsonString = JSON.stringify(fullData, null, 2);
    
    if (exportSettings.obfuscateCode) {
        jsonString = obfuscateJSON(jsonString);
    }
    
    if (exportSettings.encryptionLevel !== 'none') {
        jsonString = encryptData(jsonString, exportSettings.encryptionLevel);
    }
    
    const blob = new Blob([jsonString], {type: 'application/json'});
    
    return {
        blob: blob,
        size: formatFileSize(blob.size),
        filename: `flowstory_data_${Date.now()}.json`
    };
}

// Exportar para GitHub
async function exportToGitHub() {
    if (!confirm('Esta a√ß√£o publicar√° seu jogo no GitHub Pages. Continuar?')) {
        return;
    }
    
    showExportStatus('Conectando ao GitHub...', 'processing');
    
    // Verificar se est√° autenticado
    const isAuthenticated = checkGitHubAuth();
    
    if (!isAuthenticated) {
        // Solicitar autentica√ß√£o
        const token = prompt('Por favor, insira seu token de acesso pessoal do GitHub:');
        if (!token) {
            showExportStatus('Autentica√ß√£o cancelada', 'error');
            return;
        }
        
        // Salvar token (em um cen√°rio real, use armazenamento seguro)
        localStorage.setItem('github_token', token);
    }
    
    // Preparar dados
    const exportData = await exportAsWeb();
    
    showExportStatus('Criando reposit√≥rio...', 'processing');
    
    // Em um cen√°rio real, voc√™ faria:
    // 1. Criar reposit√≥rio via API GitHub
    // 2. Fazer commit dos arquivos
    // 3. Ativar GitHub Pages
    
    // Simula√ß√£o
    setTimeout(() => {
        const repoUrl = `https://github.com/user/flowstory-game-${Date.now()}`;
        const pagesUrl = `https://user.github.io/flowstory-game-${Date.now()}/`;
        
        showExportStatus('Publicado!', 'ready');
        
        alert(`‚úÖ Publicado no GitHub!\n\nReposit√≥rio: ${repoUrl}\nGitHub Pages: ${pagesUrl}\n\nO jogo estar√° dispon√≠vel em alguns minutos.`);
        
        // Abrir URL
        window.open(pagesUrl, '_blank');
        
    }, 2000);
}

// Exportar para itch.io
async function exportToItchIO() {
    if (!confirm('Esta a√ß√£o enviar√° seu jogo para o itch.io. Continuar?')) {
        return;
    }
    
    showExportStatus('Preparando para itch.io...', 'processing');
    
    // Verificar autentica√ß√£o
    const isAuthenticated = checkItchIOAuth();
    
    if (!isAuthenticated) {
        // Solicitar credenciais
        const apiKey = prompt('Por favor, insira sua API Key do itch.io:');
        if (!apiKey) {
            showExportStatus('Autentica√ß√£o cancelada', 'error');
            return;
        }
        
        localStorage.setItem('itchio_api_key', apiKey);
    }
    
    // Preparar build
    const exportData = await exportAsWeb();
    
    showExportStatus('Enviando para itch.io...', 'processing');
    
    // Simula√ß√£o de upload
    setTimeout(() => {
        const gameUrl = `https://user.itch.io/flowstory-${Date.now()}`;
        
        showExportStatus('Enviado!', 'ready');
        
        alert(`‚úÖ Jogo enviado para itch.io!\n\nURL: ${gameUrl}\n\nO jogo estar√° dispon√≠vel ap√≥s aprova√ß√£o.`);
        
        window.open(gameUrl, '_blank');
        
    }, 2000);
}

// Coletar dados para exporta√ß√£o
function collectExportData() {
    const data = {
        scenes: storyData.scenes,
        characters: storyData.characters,
        dialogues: storyData.dialogues,
        settings: exportSettings,
        metadata: {
            exportDate: new Date().toISOString(),
            totalScenes: storyData.scenes.length,
            totalDialogues: storyData.dialogues.length,
            totalCharacters: storyData.characters.length
        }
    };
    
    // Adicionar bolhas se dispon√≠vel
    if (window.bubbles) {
        data.bubbles = Array.from(window.bubbles).map(bubble => ({
            type: bubble.getAttribute('data-type'),
            content: bubble.querySelector('.bubble-content')?.textContent || '',
            position: {
                x: parseInt(bubble.style.left) || 0,
                y: parseInt(bubble.style.top) || 0
            }
        }));
    }
    
    // Adicionar arquivos se necess√°rio
    if (exportSettings.includeImages || exportSettings.includeAudio) {
        data.resources = {
            images: exportSettings.includeImages ? storyData.images : 0,
            audio: exportSettings.includeAudio ? storyData.audio : 0
        };
    }
    
    return data;
}

// Gerar HTML
function generateHTML(data) {
    return `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.scenes[0]?.name || 'FlowStory Game'}</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>
    <div id="game-container">
        <div id="scene-container"></div>
        <div id="dialogue-container"></div>
        <div id="choices-container"></div>
    </div>
    
    <script src="js/engine.js"></script>
    <script src="js/game.js"></script>
    <script>
        // Inicializar jogo
        window.addEventListener('DOMContentLoaded', () => {
            FlowStoryEngine.init(${JSON.stringify(data)});
        });
    </script>
</body>
</html>`;
}

// Gerar CSS
function generateCSS(data) {
    return `
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

#game-container {
    width: 100%;
    max-width: 1200px;
    height: 90vh;
    background-color: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

#scene-container {
    flex: 1;
    background: #2c3e50;
    position: relative;
    overflow: hidden;
}

#dialogue-container {
    height: 200px;
    background: white;
    border-top: 3px solid #667eea;
    padding: 20px;
    overflow-y: auto;
}

#choices-container {
    padding: 15px;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.character {
    position: absolute;
    bottom: 0;
    transition: all 0.5s ease;
}

.dialogue {
    font-size: 18px;
    line-height: 1.6;
    margin-bottom: 10px;
}

.choice-button {
    padding: 15px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

.choice-button:hover {
    background: #5a67d8;
}

/* Responsividade */
@media (max-width: 768px) {
    #game-container {
        height: 100vh;
        border-radius: 0;
    }
    
    #dialogue-container {
        height: 150px;
        padding: 15px;
    }
    
    .dialogue {
        font-size: 16px;
    }
}`;
}

// Gerar JavaScript do jogo
function generateGameJS(data) {
    return `
class FlowStoryGame {
    constructor(engine, data) {
        this.engine = engine;
        this.data = data;
        this.currentScene = 0;
        this.currentDialogue = 0;
        this.playerChoices = {};
    }
    
    start() {
        this.loadScene(this.currentScene);
        this.showDialogue(this.currentDialogue);
    }
    
    loadScene(sceneIndex) {
        const scene = this.data.scenes[sceneIndex];
        if (!scene) return;
        
        // Atualizar fundo
        this.engine.setBackground(scene.background);
        
        // Posicionar personagens
        scene.characters.forEach(character => {
            this.engine.addCharacter(character);
        });
        
        this.currentScene = sceneIndex;
    }
    
    showDialogue(dialogueIndex) {
        const scene = this.data.scenes[this.currentScene];
        if (!scene || !scene.dialogues[dialogueIndex]) return;
        
        const dialogue = scene.dialogues[dialogueIndex];
        
        // Mostrar di√°logo
        this.engine.showDialogue(dialogue);
        
        // Atualizar personagem ativo
        if (dialogue.character && dialogue.character !== 'Narrador') {
            this.engine.setActiveCharacter(dialogue.character);
        }
        
        this.currentDialogue = dialogueIndex;
        
        // Mostrar op√ß√µes se existirem
        if (dialogue.options && dialogue.options.length > 0) {
            this.showOptions(dialogue.options);
        }
    }
    
    showOptions(options) {
        this.engine.showOptions(options, (selectedOption) => {
            // Registrar escolha
            this.playerChoices[this.currentScene] = this.playerChoices[this.currentScene] || {};
            this.playerChoices[this.currentScene][this.currentDialogue] = selectedOption;
            
            // Avan√ßar para pr√≥ximo di√°logo
            this.nextDialogue();
        });
    }
    
    nextDialogue() {
        const scene = this.data.scenes[this.currentScene];
        if (this.currentDialogue < scene.dialogues.length - 1) {
            this.currentDialogue++;
            this.showDialogue(this.currentDialogue);
        } else {
            // Fim da cena
            this.endScene();
        }
    }
    
    prevDialogue() {
        if (this.currentDialogue > 0) {
            this.currentDialogue--;
            this.showDialogue(this.currentDialogue);
        }
    }
    
    endScene() {
        this.engine.showEndScene(this.currentScene);
        
        // Verificar se h√° pr√≥xima cena
        if (this.currentScene < this.data.scenes.length - 1) {
            setTimeout(() => {
                this.currentScene++;
                this.currentDialogue = 0;
                this.loadScene(this.currentScene);
                this.showDialogue(this.currentDialogue);
            }, 2000);
        } else {
            this.engine.showGameOver();
        }
    }
    
    save() {
        const saveData = {
            scene: this.currentScene,
            dialogue: this.currentDialogue,
            choices: this.playerChoices,
            timestamp: Date.now()
        };
        
        localStorage.setItem('flowstory_save', JSON.stringify(saveData));
        return saveData;
    }
    
    load(saveData) {
        if (saveData.scene !== undefined) this.currentScene = saveData.scene;
        if (saveData.dialogue !== undefined) this.currentDialogue = saveData.dialogue;
        if (saveData.choices) this.playerChoices = saveData.choices;
        
        this.loadScene(this.currentScene);
        this.showDialogue(this.currentDialogue);
    }
}

// Instanciar jogo
const game = new FlowStoryGame(FlowStoryEngine, gameData);
game.start();

// Expor para console
window.FlowStoryGame = game;`;
}

// Gerar engine JavaScript
function generateEngineJS() {
    return `
class FlowStoryEngine {
    static init(gameData) {
        this.gameData = gameData;
        this.sceneContainer = document.getElementById('scene-container');
        this.dialogueContainer = document.getElementById('dialogue-container');
        this.choicesContainer = document.getElementById('choices-container');
        
        // Inicializar eventos
        this.initEvents();
    }
    
    static initEvents() {
        // Evento para pr√≥xima fala
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                window.FlowStoryGame.nextDialogue();
            }
        });
        
        // Clique para pr√≥xima fala
        this.dialogueContainer.addEventListener('click', () => {
            window.FlowStoryGame.nextDialogue();
        });
    }
    
    static setBackground(backgroundType) {
        const backgrounds = {
            room: 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)',
            forest: 'linear-gradient(135deg, #228B22 0%, #32CD32 100%)',
            city: 'linear-gradient(135deg, #4682B4 0%, #87CEEB 100%)',
            beach: 'linear-gradient(135deg, #87CEEB 0%, #F0E68C 100%)',
            castle: 'linear-gradient(135deg, #B0C4DE 0%, #DDA0DD 100%)'
        };
        
        this.sceneContainer.style.background = backgrounds[backgroundType] || backgrounds.room;
    }
    
    static addCharacter(character) {
        const charDiv = document.createElement('div');
        charDiv.className = 'character';
        charDiv.id = \`character-\${character.id}\`;
        charDiv.style.cssText = \`
            left: \${this.getPosition(character.position)};
            width: 150px;
            height: 300px;
            background-color: \${character.color};
            border-radius: 10px;
        \`;
        
        const nameTag = document.createElement('div');
        nameTag.textContent = character.name;
        nameTag.style.cssText = \`
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-weight: bold;
            background: rgba(0,0,0,0.7);
            padding: 5px;
            border-radius: 10px;
        \`;
        
        charDiv.appendChild(nameTag);
        this.sceneContainer.appendChild(charDiv);
    }
    
    static getPosition(pos) {
        const positions = {
            left: '50px',
            center: 'calc(50% - 75px)',
            right: 'calc(100% - 200px)'
        };
        return positions[pos] || positions.center;
    }
    
    static setActiveCharacter(characterName) {
        // Remover active de todos
        document.querySelectorAll('.character').forEach(char => {
            char.style.transform = 'scale(1)';
        });
        
        // Encontrar e ativar personagem
        const character = document.querySelector(\`[id^="character-"]\`);
        if (character) {
            character.style.transform = 'scale(1.1)';
            character.style.zIndex = '10';
        }
    }
    
    static showDialogue(dialogue) {
        this.dialogueContainer.innerHTML = '';
        
        const dialogueDiv = document.createElement('div');
        dialogueDiv.className = 'dialogue';
        
        const characterSpan = document.createElement('span');
        characterSpan.style.fontWeight = 'bold';
        characterSpan.style.color = '#667eea';
        characterSpan.textContent = \`\${dialogue.character}: \`;
        
        const textSpan = document.createElement('span');
        textSpan.textContent = dialogue.text;
        
        dialogueDiv.appendChild(characterSpan);
        dialogueDiv.appendChild(textSpan);
        this.dialogueContainer.appendChild(dialogueDiv);
        
        // Scroll para baixo
        this.dialogueContainer.scrollTop = this.dialogueContainer.scrollHeight;
    }
    
    static showOptions(options, callback) {
        this.choicesContainer.innerHTML = '';
        
        options.forEach((option, index) => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            button.textContent = option.text;
            button.onclick = () => callback(option);
            
            this.choicesContainer.appendChild(button);
        });
    }
    
    static showEndScene(sceneIndex) {
        this.dialogueContainer.innerHTML = \`
            <div class="dialogue" style="text-align: center; color: #28a745;">
                <h3>üéâ Cena Conclu√≠da!</h3>
                <p>Cena \${sceneIndex + 1} finalizada com sucesso.</p>
            </div>
        \`;
    }
    
    static showGameOver() {
        this.dialogueContainer.innerHTML = \`
            <div class="dialogue" style="text-align: center;">
                <h2>üèÜ Fim do Jogo!</h2>
                <p>Obrigado por jogar!</p>
                <button onclick="location.reload()" style="
                    padding: 10px 20px;
                    background: #667eea;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                    margin-top: 20px;
                ">Jogar Novamente</button>
            </div>
        \`;
    }
}

// Expor engine globalmente
window.FlowStoryEngine = FlowStoryEngine;`;
}

// Gerar README
function generateReadme(data) {
    return `
# FlowStory Game

Hist√≥ria interativa criada com FlowStory.

## Informa√ß√µes do Jogo
- **T√≠tulo:** ${data.scenes[0]?.name || 'Hist√≥ria Interativa'}
- **Vers√£o:** ${exportSettings.version}
- **Cenas:** ${data.scenes.length}
- **Di√°logos:** ${data.dialogues.length}
- **Personagens:** ${data.characters.length}

## Como Jogar
1. Abra o arquivo \`index.html\` em seu navegador
2. Use:
   - **Enter** ou **Espa√ßo** para avan√ßar di√°logos
   - **Clique** nas op√ß√µes para fazer escolhas
   - O jogo salva automaticamente seu progresso

## Controles
- **Pr√≥ximo Di√°logo:** Enter, Espa√ßo ou Clique
- **Salvar:** Automaticamente no localStorage
- **Carregar:** Recarrega automaticamente

## Recursos
- Hist√≥ria interativa com m√∫ltiplas cenas
- Sistema de escolhas que afetam a narrativa
- Personagens com express√µes
- Sistema de salvamento autom√°tico

## Desenvolvido com
- FlowStory Engine
- HTML5, CSS3, JavaScript

## Licen√ßa
Este jogo foi criado com FlowStory. Todos os direitos reservados.

---

Criado em: ${new Date().toLocaleDateString('pt-BR')}
FlowStory SaveRote Export System`;
}

// Fun√ß√µes auxiliares
function minifyCode(code) {
    // Simula√ß√£o de minifica√ß√£o
    return code
        .replace(/\/\/.*$/gm, '') // Remove coment√°rios de linha
        .replace(/\/\*[\s\S]*?\*\//g, '') // Remove coment√°rios de bloco
        .replace(/\s+/g, ' ') // Remove espa√ßos em branco extras
        .replace(/\s*([{}();:,])\s*/g, '$1') // Remove espa√ßos desnecess√°rios
        .trim();
}

function minifyCSS(css) {
    return css
        .replace(/\/\*[\s\S]*?\*\//g, '')
        .replace(/\s+/g, ' ')
        .replace(/\s*([{}:;,])\s*/g, '$1')
        .replace(/;}/g, '}')
        .trim();
}

function obfuscateJSON(json) {
    // Simula√ß√£o de ofusca√ß√£o b√°sica
    return btoa(json); // Base64 encoding
}

function encryptData(data, level) {
    // Simula√ß√£o de criptografia
    if (level === 'basic') {
        // Criptografia simples para demonstra√ß√£o
        let result = '';
        for (let i = 0; i < data.length; i++) {
            result += String.fromCharCode(data.charCodeAt(i) + 1);
        }
        return btoa(result);
    }
    return data;
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Mostrar status da exporta√ß√£o
function showExportStatus(message, type) {
    const statusElement = document.getElementById('export-status');
    statusElement.textContent = message;
    statusElement.className = `info-value status-${type}`;
}

// Atualizar progresso da exporta√ß√£o
function updateExportProgress(percent) {
    const progressFill = document.getElementById('export-progress-fill');
    const progressText = document.getElementById('export-progress-text');
    
    progressFill.style.width = `${percent}%`;
    progressText.textContent = `${percent}%`;
    
    if (percent < 100) {
        progressFill.classList.add('processing');
    } else {
        progressFill.classList.remove('processing');
    }
}

// Oferecer download
function offerDownload(exportResult) {
    const url = URL.createObjectURL(exportResult.blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = exportResult.filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert(`‚úÖ Download iniciado!\n\nArquivo: ${exportResult.filename}\nTamanho: ${exportResult.size}`);
}

// Conectar a plataforma
function connectToPlatform(platform) {
    const modal = document.getElementById('platform-auth-modal');
    const title = document.getElementById('platform-modal-title');
    const body = document.getElementById('platform-modal-body');
    
    title.textContent = `Conectar ${platform}`;
    
    switch(platform) {
        case 'github':
            body.innerHTML = `
                <p>Para conectar ao GitHub, voc√™ precisa de um token de acesso pessoal.</p>
                <div style="margin: 15px 0;">
                    <label>GitHub Token:</label>
                    <input type="password" id="github-token" style="width: 100%; padding: 8px; margin-top: 5px;" 
                           placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                </div>
                <p style="font-size: 12px; color: #666;">
                    ‚ìò Crie um token em: <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings</a><br>
                    Necess√°rias permiss√µes: repo, workflow
                </p>
                <button onclick="authenticateGitHub()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                    margin-top: 10px;
                ">Conectar</button>
            `;
            break;
            
        case 'itchio':
            body.innerHTML = `
                <p>Para conectar ao itch.io, voc√™ precisa da API Key da sua conta.</p>
                <div style="margin: 15px 0;">
                    <label>itch.io API Key:</label>
                    <input type="password" id="itchio-key" style="width: 100%; padding: 8px; margin-top: 5px;" 
                           placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                <p style="font-size: 12px; color: #666;">
                    ‚ìò Obtenha sua API Key em: <a href="https://itch.io/user/settings/api-keys" target="_blank">itch.io Settings</a>
                </p>
                <button onclick="authenticateItchIO()" style="
                    padding: 10px 20px;
                    background: #fa5c5c;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                    margin-top: 10px;
                ">Conectar</button>
            `;
            break;
    }
    
    modal.style.display = 'flex';
}

// Autentica√ß√£o GitHub
function authenticateGitHub() {
    const token = document.getElementById('github-token').value;
    if (!token) {
        alert('Por favor, insira um token v√°lido.');
        return;
    }
    
    // Simular autentica√ß√£o
    localStorage.setItem('github_token', token);
    
    // Atualizar status
    document.getElementById('github-status').innerHTML = `
        <span class="status-dot online"></span>
        Conectado
    `;
    
    closeModal('platform');
    alert('‚úÖ Conectado ao GitHub com sucesso!');
}

// Autentica√ß√£o itch.io
function authenticateItchIO() {
    const key = document.getElementById('itchio-key').value;
    if (!key) {
        alert('Por favor, insira uma API Key v√°lida.');
        return;
    }
    
    localStorage.setItem('itchio_api_key', key);
    
    document.getElementById('itchio-status').innerHTML = `
        <span class="status-dot online"></span>
        Conectado
    `;
    
    closeModal('platform');
    alert('‚úÖ Conectado ao itch.io com sucesso!');
}

// Verificar autentica√ß√£o GitHub
function checkGitHubAuth() {
    return !!localStorage.getItem('github_token');
}

// Verificar autentica√ß√£o itch.io
function checkItchIOAuth() {
    return !!localStorage.getItem('itchio_api_key');
}

// A√ß√µes de compartilhamento
function handleShareAction(action) {
    switch(action) {
        case 'link':
            generateShareLink();
            break;
        case 'qr':
            generateQRCode();
            break;
        case 'embed':
            generateEmbedCode();
            break;
        case 'social':
            shareOnSocial();
            break;
    }
}

function generateShareLink() {
    // Em um cen√°rio real, isso faria upload e geraria um link
    const mockLink = `https://flowstory.app/share/${Date.now()}`;
    
    const container = document.getElementById('share-link-container');
    const input = document.getElementById('share-link-input');
    
    input.value = mockLink;
    container.style.display = 'flex';
    
    // Esconder QR se estiver vis√≠vel
    document.getElementById('qr-container').style.display = 'none';
}

function generateQRCode() {
    const container = document.getElementById('qr-container');
    const canvas = document.getElementById('qr-code');
    
    // Simular gera√ß√£o de QR Code
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, 150, 150);
    
    ctx.fillStyle = '#000000';
    ctx.font = '12px Arial';
    ctx.fillText('QR Code Preview', 20, 75);
    
    container.style.display = 'block';
    document.getElementById('share-link-container').style.display = 'none';
}

function generateEmbedCode() {
    const embedCode = `<iframe src="https://flowstory.app/embed/${Date.now()}" width="800" height="600" frameborder="0"></iframe>`;
    
    const container = document.getElementById('share-link-container');
    const input = document.getElementById('share-link-input');
    
    input.value = embedCode;
    container.style.display = 'flex';
    
    alert('C√≥digo embed copiado para a √°rea de transfer√™ncia!');
    
    // Copiar automaticamente
    navigator.clipboard.writeText(embedCode);
}

function shareOnSocial() {
    const shareData = {
        title: 'Minha Hist√≥ria FlowStory',
        text: 'Confira minha hist√≥ria interativa criada com FlowStory!',
        url: window.location.href
    };
    
    if (navigator.share) {
        navigator.share(shareData);
    } else {
        // Fallback para copiar link
        navigator.clipboard.writeText(shareData.url);
        alert('Link copiado para a √°rea de transfer√™ncia! Compartilhe onde quiser.');
    }
}

// Salvar configura√ß√µes de exporta√ß√£o
function saveExportSettings() {
    const settings = {
        format: currentExportFormat,
        settings: exportSettings,
        timestamp: Date.now()
    };
    
    localStorage.setItem('flowstory_export_settings', JSON.stringify(settings));
    alert('‚úÖ Configura√ß√µes de exporta√ß√£o salvas!');
}

// Salvar configura√ß√µes avan√ßadas
function saveAdvancedSettings() {
    // As configura√ß√µes j√° foram atualizadas pelos event listeners
    closeModal('advanced');
    alert('‚úÖ Configura√ß√µes avan√ßadas salvas!');
}

// Fechar modal
function closeModal(modalType) {
    document.getElementById(`${modalType}-settings-modal`).style.display = 'none';
    document.getElementById('platform-auth-modal').style.display = 'none';
}

// Fechar sistema de exporta√ß√£o
function closeExportSystem() {
    exportSystem.style.display = 'none';
}

// Abrir sistema de exporta√ß√£o
function openExportSystem() {
    exportSystem.style.display = 'block';
    initExportSystem();
    updatePreview();
    
    // Verificar status das plataformas
    updatePlatformStatus();
}

// Atualizar status das plataformas
function updatePlatformStatus() {
    // GitHub
    if (checkGitHubAuth()) {
        document.getElementById('github-status').innerHTML = `
            <span class="status-dot online"></span>
            Conectado
        `;
    }
    
    // itch.io
    if (checkItchIOAuth()) {
        document.getElementById('itchio-status').innerHTML = `
            <span class="status-dot online"></span>
            Conectado
        `;
    }
}

// Integrar com SaveRote existente
function integrateWithSaveRote() {
    // Substituir fun√ß√£o SaveRote original
    const originalSaveRote = window.showSaveRoteOptions || function() {
        alert('Op√ß√µes de exporta√ß√£o:\n- HTML com CSS, JavaScript, JSON\n- APK\n- EXE\n- GitHub\n- Itch.io');
    };
    
    window.showSaveRoteOptions = function() {
        openExportSystem();
    };
    
    // Substituir atalho Enter
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.ctrlKey && !e.altKey && !e.shiftKey) {
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                openExportSystem();
                
                // Mostrar dica de atalho
                if (window.showShortcutHint) {
                    window.showShortcutHint('Enter: SaveRote Export System');
                }
            }
        }
    });
    
    console.log('‚úÖ Sistema de exporta√ß√£o integrado com SaveRote!');
}

// Inicializar quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', function() {
    // Adicionar bot√£o de exporta√ß√£o no menu
    const menuButtons = document.querySelector('.menu-buttons');
    if (menuButtons) {
        const exportBtn = document.createElement('button');
        exportBtn.className = 'menu-btn';
        exportBtn.id = 'export-btn';
        exportBtn.innerHTML = 'üöÄ SaveRote Export';
        exportBtn.addEventListener('click', openExportSystem);
        
        // Inserir antes do bot√£o de configura√ß√µes
        const settingsBtn = document.getElementById('settings-btn');
        if (settingsBtn) {
            menuButtons.insertBefore(exportBtn, settingsBtn);
        } else {
            menuButtons.appendChild(exportBtn);
        }
    }
    
    // Integrar com SaveRote
    integrateWithSaveRote();
    
    // Carregar configura√ß√µes salvas
    const savedSettings = localStorage.getItem('flowstory_export_settings');
    if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        currentExportFormat = settings.format;
        exportSettings = { ...exportSettings, ...settings.settings };
        
        // Atualizar UI
        document.querySelectorAll('.format-option').forEach(opt => {
            if (opt.dataset.format === currentExportFormat) {
                opt.classList.add('selected');
            }
        });
        
        document.getElementById('include-images').checked = exportSettings.includeImages;
        document.getElementById('include-audio').checked = exportSettings.includeAudio;
        document.getElementById('minify-code').checked = exportSettings.minifyCode;
        document.getElementById('compress-files').checked = exportSettings.compressFiles;
        document.getElementById('add-watermark').checked = exportSettings.addWatermark;
        document.getElementById('export-sources').checked = exportSettings.exportSources;
        document.getElementById('export-quality').value = exportSettings.quality;
        document.getElementById('export-version').value = exportSettings.version;
    }
});

// Adicionar depend√™ncia JSZip se n√£o existir
if (typeof JSZip === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
    document.head.appendChild(script);
}

// Exportar fun√ß√µes globais
window.openExportSystem = openExportSystem;
window.closeExportSystem = closeExportSystem;
window.FlowStoryExport = {
    settings: exportSettings,
    format: currentExportFormat,
    exportHistory: exportHistory,
    initExportSystem: initExportSystem
};
</script>